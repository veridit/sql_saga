log_id,event,label,queryid,calls,total_exec_time,rows,shared_blks_hit,shared_blks_read,temp_blks_read,temp_blks_written,total_plan_time,wal_records,wal_bytes,query
d5a,Child INSERT (No Index),,2751195442669386938,1,33.114748999999996,1000,21044,4,0,0,0,8024,755384,"INSERT INTO establishment (id, valid_range, legal_unit_id, postal_place) SELECT i, daterange('2015-01-01', 'infinity', '[)'), i, 'New Shop ' || i FROM generate_series(10001, 11000) i"
dc0,Child INSERT (No Index),,3801168477474623637,1000,6.668569999999996,1000,5000,0,0,0,0,1000,54000,"SELECT 1 FROM (SELECT ""valid_range"" AS r FROM ONLY ""public"".""legal_unit"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 AND ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.&&) $2::pg_catalog.anyrange FOR KEY SHARE OF x) x1 HAVING   $2::pg_catalog.anyrange OPERATOR(pg_catalog.<@) pg_catalog.range_agg(x1.r)"
299,Child INSERT (Plain),,2751195442669386938,1,11.361457999999999,1000,6028,0,0,0,0,3009,326528,"INSERT INTO establishment (id, valid_range, legal_unit_id, postal_place) SELECT i, daterange('2015-01-01', 'infinity', '[)'), i, 'New Shop ' || i FROM generate_series(10001, 11000) i"
9b2,Child INSERT (With Index),,2751195442669386938,1,38.446875,1000,23025,1,0,0,0,10033,987832,"INSERT INTO establishment (id, valid_range, legal_unit_id, postal_place) SELECT i, daterange('2015-01-01', 'infinity', '[)'), i, 'New Shop ' || i FROM generate_series(11001, 12000) i"
da8,Child INSERT (With Index),,3801168477474623637,1000,7.12008299999999,1000,5000,0,0,0,0,1000,54000,"SELECT 1 FROM (SELECT ""valid_range"" AS r FROM ONLY ""public"".""legal_unit"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 AND ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.&&) $2::pg_catalog.anyrange FOR KEY SHARE OF x) x1 HAVING   $2::pg_catalog.anyrange OPERATOR(pg_catalog.<@) pg_catalog.range_agg(x1.r)"
324,Child UPDATE Key (No Index),,2480189997267991601,1,26.917333000000003,1000,28072,9,0,0,0,7059,640289,"UPDATE establishment SET valid_range = daterange('2014-01-01', upper(valid_range), '[)') WHERE id BETWEEN 1 AND 1000"
20f,Child UPDATE Key (No Index),,3801168477474623637,681,3.7827550000000048,681,4089,0,0,0,0,686,38388,"SELECT 1 FROM (SELECT ""valid_range"" AS r FROM ONLY ""public"".""legal_unit"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 AND ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.&&) $2::pg_catalog.anyrange FOR KEY SHARE OF x) x1 HAVING   $2::pg_catalog.anyrange OPERATOR(pg_catalog.<@) pg_catalog.range_agg(x1.r)"
519,Child UPDATE Key (No Index),,3801168477474623637,319,1.9252450000000008,319,1915,0,0,0,0,323,18352,"SELECT 1 FROM (SELECT ""valid_range"" AS r FROM ONLY ""public"".""legal_unit"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 AND ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.&&) $2::pg_catalog.anyrange FOR KEY SHARE OF x) x1 HAVING   $2::pg_catalog.anyrange OPERATOR(pg_catalog.<@) pg_catalog.range_agg(x1.r)"
246,Child UPDATE Key (With Index),,2480189997267991601,1,31.608292000000002,1000,29880,8,0,0,0,8034,805707,"UPDATE establishment SET valid_range = daterange('2013-01-01', upper(valid_range), '[)') WHERE id BETWEEN 2001 AND 3000"
6e6,Child UPDATE Key (With Index),,3801168477474623637,1000,6.029448999999992,1000,5964,0,0,0,0,1009,56682,"SELECT 1 FROM (SELECT ""valid_range"" AS r FROM ONLY ""public"".""legal_unit"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 AND ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.&&) $2::pg_catalog.anyrange FOR KEY SHARE OF x) x1 HAVING   $2::pg_catalog.anyrange OPERATOR(pg_catalog.<@) pg_catalog.range_agg(x1.r)"
722,Child UPDATE Non-Key (No Index),,-6603853390843512690,1,16.206083,1000,19615,8,0,0,0,5896,557861,UPDATE establishment SET postal_place = 'New Place' WHERE id BETWEEN 1001 AND 2000
31a,Child UPDATE Non-Key (With Index),,-6603853390843512690,1,20.695541000000002,1000,21859,11,0,0,0,6970,714210,UPDATE establishment SET postal_place = 'New Place Again' WHERE id BETWEEN 3001 AND 4000
974,"Parent DELETE (Check Only, No Index)",,-2355103134172566288,1,918.158291,1000,136022,0,0,0,0,1000,54000,DELETE FROM legal_unit WHERE id BETWEEN 20001 AND 21000
6e3,"Parent DELETE (Check Only, No Index)",,476854885423386359,1000,900.1591710000001,0,130000,0,0,0,0,0,0,"SELECT 1 FROM ONLY ""public"".""establishment"" x WHERE $1 OPERATOR(pg_catalog.=) ""legal_unit_id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange AND NOT coalesce(  (  ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.*) $2::pg_catalog.anyrange)::pg_catalog.anyrange OPERATOR(pg_catalog.<@) (SELECT pg_catalog.range_agg(r) FROM (SELECT y.""valid_range"" r FROM ONLY ""public"".""legal_unit"" y WHERE $1 OPERATOR(pg_catalog.=) ""id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange FOR KEY SHARE OF y) y2), false) FOR KEY SHARE OF x"
c00,"Parent DELETE (Check Only, No Index)",,-6873348994332248717,1000,1.0502559999999943,1000,2000,0,0,0,0,0,0,SELECT EXISTS (SELECT 1 FROM public.projects AS fk WHERE fk.legal_unit_id = $1)
33f,"Parent DELETE (Check Only, With Index)",,-2355103134172566288,1,14.21275,1000,7014,0,0,0,0,1000,54000,DELETE FROM legal_unit WHERE id BETWEEN 21001 AND 22000
ed8,"Parent DELETE (Check Only, With Index)",,476854885423386359,1000,1.541523999999996,0,1000,0,0,0,0,0,0,"SELECT 1 FROM ONLY ""public"".""establishment"" x WHERE $1 OPERATOR(pg_catalog.=) ""legal_unit_id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange AND NOT coalesce(  (  ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.*) $2::pg_catalog.anyrange)::pg_catalog.anyrange OPERATOR(pg_catalog.<@) (SELECT pg_catalog.range_agg(r) FROM (SELECT y.""valid_range"" r FROM ONLY ""public"".""legal_unit"" y WHERE $1 OPERATOR(pg_catalog.=) ""id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange FOR KEY SHARE OF y) y2), false) FOR KEY SHARE OF x"
b55,"Parent DELETE (Check Only, With Index)",,-6873348994332248717,1000,0.6447159999999933,1000,2000,0,0,0,0,0,0,SELECT EXISTS (SELECT 1 FROM public.projects AS fk WHERE fk.legal_unit_id = $1)
856,Parent DELETE (No Index),,-2355103134172566288,1,905.136458,1000,135866,4,0,0,0,1002,54138,DELETE FROM legal_unit WHERE id BETWEEN 15001 AND 16000
13e,Parent DELETE (No Index),,476854885423386359,1000,888.2433929999994,0,129770,0,0,0,0,0,0,"SELECT 1 FROM ONLY ""public"".""establishment"" x WHERE $1 OPERATOR(pg_catalog.=) ""legal_unit_id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange AND NOT coalesce(  (  ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.*) $2::pg_catalog.anyrange)::pg_catalog.anyrange OPERATOR(pg_catalog.<@) (SELECT pg_catalog.range_agg(r) FROM (SELECT y.""valid_range"" r FROM ONLY ""public"".""legal_unit"" y WHERE $1 OPERATOR(pg_catalog.=) ""id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange FOR KEY SHARE OF y) y2), false) FOR KEY SHARE OF x"
805,Parent DELETE (No Index),,-6873348994332248717,1000,0.9132159999999958,1000,2000,0,0,0,0,0,0,SELECT EXISTS (SELECT 1 FROM public.projects AS fk WHERE fk.legal_unit_id = $1)
80a,Parent DELETE (With Index),,-2355103134172566288,1,14.463001,1000,7017,3,0,0,0,1001,54230,DELETE FROM legal_unit WHERE id BETWEEN 16001 AND 17000
189,Parent DELETE (With Index),,476854885423386359,1000,1.551800999999994,0,1000,0,0,0,0,0,0,"SELECT 1 FROM ONLY ""public"".""establishment"" x WHERE $1 OPERATOR(pg_catalog.=) ""legal_unit_id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange AND NOT coalesce(  (  ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.*) $2::pg_catalog.anyrange)::pg_catalog.anyrange OPERATOR(pg_catalog.<@) (SELECT pg_catalog.range_agg(r) FROM (SELECT y.""valid_range"" r FROM ONLY ""public"".""legal_unit"" y WHERE $1 OPERATOR(pg_catalog.=) ""id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange FOR KEY SHARE OF y) y2), false) FOR KEY SHARE OF x"
5d1,Parent DELETE (With Index),,-6873348994332248717,1000,0.6602079999999927,1000,2000,0,0,0,0,0,0,SELECT EXISTS (SELECT 1 FROM public.projects AS fk WHERE fk.legal_unit_id = $1)
531,Parent INSERT (No Index),,-6962160005659942149,1,29.143709,1000,15036,3,0,0,0,7025,699144,"INSERT INTO legal_unit (id, valid_range, name) SELECT i, daterange('2015-01-01', 'infinity', '[)'), 'New Company ' || i FROM generate_series(20001, 21000) i"
075,Parent INSERT (Plain),,-6962160005659942149,1,17.478625,1000,6028,0,0,0,0,3009,323528,"INSERT INTO legal_unit (id, valid_range, name) SELECT i, daterange('2015-01-01', 'infinity', '[)'), 'New Company ' || i FROM generate_series(20001, 21000) i"
5a2,Parent INSERT (With Index),,-6962160005659942149,1,30.840083,1000,15025,0,0,0,0,7025,705776,"INSERT INTO legal_unit (id, valid_range, name) SELECT i, daterange('2015-01-01', 'infinity', '[)'), 'New Company ' || i FROM generate_series(21001, 22000) i"
e0d,Parent UPDATE Key (No Index),,-5008329604151558703,1,923.211125,1000,156921,11,0,0,0,7051,642790,"UPDATE legal_unit SET valid_range = daterange('2014-01-01', upper(valid_range), '[)') WHERE id BETWEEN 1 AND 1000"
718,Parent UPDATE Key (No Index),,476854885423386359,1000,892.9236740000015,0,134774,0,0,0,0,1000,54000,"SELECT 1 FROM ONLY ""public"".""establishment"" x WHERE $1 OPERATOR(pg_catalog.=) ""legal_unit_id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange AND NOT coalesce(  (  ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.*) $2::pg_catalog.anyrange)::pg_catalog.anyrange OPERATOR(pg_catalog.<@) (SELECT pg_catalog.range_agg(r) FROM (SELECT y.""valid_range"" r FROM ONLY ""public"".""legal_unit"" y WHERE $1 OPERATOR(pg_catalog.=) ""id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange FOR KEY SHARE OF y) y2), false) FOR KEY SHARE OF x"
3e4,Parent UPDATE Key (With Index),,-5008329604151558703,1,42.271875,1000,29942,15,0,0,0,7017,644774,"UPDATE legal_unit SET valid_range = daterange('2013-01-01', upper(valid_range), '[)') WHERE id BETWEEN 2001 AND 3000"
c19,Parent UPDATE Key (With Index),,476854885423386359,1000,11.609136999999953,0,7957,7,0,0,0,1001,54192,"SELECT 1 FROM ONLY ""public"".""establishment"" x WHERE $1 OPERATOR(pg_catalog.=) ""legal_unit_id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange AND NOT coalesce(  (  ""valid_range""::pg_catalog.anyrange OPERATOR(pg_catalog.*) $2::pg_catalog.anyrange)::pg_catalog.anyrange OPERATOR(pg_catalog.<@) (SELECT pg_catalog.range_agg(r) FROM (SELECT y.""valid_range"" r FROM ONLY ""public"".""legal_unit"" y WHERE $1 OPERATOR(pg_catalog.=) ""id"" AND $2::pg_catalog.anyrange OPERATOR(pg_catalog.&&) ""valid_range""::pg_catalog.anyrange FOR KEY SHARE OF y) y2), false) FOR KEY SHARE OF x"
6e8,Parent UPDATE Non-Key (No Index),,4340914437108901275,1,18.140375,1000,19431,8,0,0,0,5836,553456,UPDATE legal_unit SET name = 'Updated Company' WHERE id BETWEEN 1001 AND 2000
bab,Parent UPDATE Non-Key (With Index),,4340914437108901275,1,21.247708,1000,19966,7,0,0,0,5998,575770,UPDATE legal_unit SET name = 'Updated Again Company' WHERE id BETWEEN 3001 AND 4000
982,Regular INSERT (No Index),,-8805169522762314890,1,10.660834,1000,9049,0,0,0,0,3034,217010,"INSERT INTO projects (name, legal_unit_id) SELECT 'New Project ' || i, i FROM generate_series(10001, 11000) i"
8da,Regular INSERT (No Index),,-1640871935848111309,1000,5.469323999999961,1000,3000,0,0,0,0,0,0,SELECT EXISTS (SELECT 1 FROM public.legal_unit AS uk WHERE uk.id = $1)
3d0,Regular INSERT (With Index),,-8805169522762314890,1,10.925499,1000,9020,0,0,0,0,3036,218530,"INSERT INTO projects (name, legal_unit_id) SELECT 'New Project ' || i, i FROM generate_series(11001, 12000) i"
e57,Regular INSERT (With Index),,-1640871935848111309,1000,5.9121099999999895,1000,3000,0,0,0,0,0,0,                 SELECT EXISTS (SELECT 1 FROM public.legal_unit AS uk WHERE uk.id = $1);             
5e7,temporal_merge Child (With Index),,5062940541704792473,1,195.949125,0,44452,41,0,0,0,13353,1531084,"CALL sql_saga.temporal_merge('establishment'::regclass, 'establishment_source'::regclass, ARRAY['id'])"
16c,temporal_merge Child (With Index),,5193864790941588433,1,152.59441700000002,1000,15731,1,0,0,0,3979,491138,"INSERT INTO temporal_merge_plan     SELECT * FROM sql_saga.temporal_merge_plan(         target_table => temporal_merge.target_table,         source_table => temporal_merge.source_table,         mode => temporal_merge.mode,         era_name => temporal_merge.era_name,         identity_columns => v_identity_cols_discovered,         row_id_column => temporal_merge.row_id_column,         founding_id_column => temporal_merge.founding_id_column,         delete_mode => temporal_merge.delete_mode,         lookup_keys => v_natural_identity_keys_discovered,         ephemeral_columns => temporal_merge.ephemeral_columns,         p_log_trace => v_log_trace,         p_log_sql => v_log_sql     )"
ab4,temporal_merge Child (With Index),,-6751165780132234575,1,41.220125,0,27848,40,0,0,0,9196,1020606,"CALL sql_saga.temporal_merge_execute(         target_table => temporal_merge.target_table,         source_table => temporal_merge.source_table,         identity_columns => v_identity_cols_discovered,         mode => temporal_merge.mode,         era_name => temporal_merge.era_name,         row_id_column => temporal_merge.row_id_column,         founding_id_column => temporal_merge.founding_id_column,         update_source_with_identity => temporal_merge.update_source_with_identity,         lookup_columns => v_natural_identity_cols_discovered,         delete_mode => temporal_merge.delete_mode,         update_source_with_feedback => temporal_merge.update_source_with_feedback,         feedback_status_column => temporal_merge.feedback_status_column,         feedback_status_key => temporal_merge.feedback_status_key,         feedback_error_column => temporal_merge.feedback_error_column,         feedback_error_key => temporal_merge.feedback_error_key,         ephemeral_columns => temporal_merge.ephemeral_columns,         delay_constraints => temporal_merge.delay_constraints     )"
d7d,temporal_merge Child (With Index),,7243520755711534891,1,33.220417,1000,491,0,0,0,0,117,13117,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT                     s1.*,                     eclipse_info.is_eclipsed,                     eclipse_info.eclipsed_by                 FROM source_initial s1                 CROSS JOIN LATERAL (                     SELECT                         -- OPTIMIZATION: Use pre-computed valid_range instead of repeated daterange() calls                         -- Combined with composite index, this provides 30-40 percent total performance improvement                         COALESCE(sql_saga.covers_without_gaps(s2.valid_range, s1.valid_range ORDER BY s2.valid_from), false) as is_eclipsed,                         array_agg(s2.source_row_id) as eclipsed_by                     FROM source_initial s2                     WHERE                         (                             (NOT s1.lookup_columns_unavailable AND (s1.id IS NOT DISTINCT FROM s2.id))                             OR                             (s1.lookup_columns_unavailable AND s1.causal_id = s2.causal_id)                         )                         AND                         -- Only consider newer rows (higher row_id) as potential eclipsers.                         s2.source_row_id > s1.source_row_id                 ) eclipse_info"
ae9,temporal_merge Child (With Index),,5618979676333803494,1,32.738834000000004,1000,296,0,0,0,0,116,13061,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT                     s1.*,                     eclipse_info.is_eclipsed,                     eclipse_info.eclipsed_by                 FROM source_initial s1                 CROSS JOIN LATERAL (                     SELECT                         -- OPTIMIZATION: Use pre-computed valid_range instead of repeated daterange() calls                         -- Combined with composite index, this provides 30-40 percent total performance improvement                         COALESCE(sql_saga.covers_without_gaps(s2.valid_range, s1.valid_range ORDER BY s2.valid_from), false) as is_eclipsed,                         array_agg(s2.source_row_id) as eclipsed_by                     FROM source_initial s2                     WHERE                         (                             (NOT s1.lookup_columns_unavailable AND (s1.id IS NOT DISTINCT FROM s2.id))                             OR                             (s1.lookup_columns_unavailable AND s1.causal_id = s2.causal_id)                         )                         AND                         -- Only consider newer rows (higher row_id) as potential eclipsers.                         s2.source_row_id > s1.source_row_id                 ) eclipse_info;"
0e4,temporal_merge Child (With Index),,525722707074953065,1,27.747041,1000,25695,40,0,0,0,8876,973496,"UPDATE establishment t SET valid_range = p.new_valid_range::daterange, legal_unit_id = CASE WHEN p.data ? 'legal_unit_id' THEN (p.data->>'legal_unit_id')::integer ELSE t.legal_unit_id END, postal_place = CASE WHEN p.data ? 'postal_place' THEN (p.data->>'postal_place')::text ELSE t.postal_place END                                 FROM (SELECT *, (entity_keys->>'id')::integer AS id_ek FROM temporal_merge_plan WHERE operation = 'UPDATE' AND statement_seq = 1 ORDER BY plan_op_seq) p                                 WHERE t.id = p.id_ek AND t.valid_range = p.old_valid_range::daterange"
683,temporal_merge Parent (With Index),,5062940541704792473,1,366.582666,0,41475,37,0,0,0,12382,1386443,"CALL sql_saga.temporal_merge('legal_unit'::regclass, 'legal_unit_source'::regclass, ARRAY['id'])"
915,temporal_merge Parent (With Index),,5193864790941588433,1,317.89666700000004,1000,15427,1,0,0,0,4111,509387,"INSERT INTO temporal_merge_plan     SELECT * FROM sql_saga.temporal_merge_plan(         target_table => temporal_merge.target_table,         source_table => temporal_merge.source_table,         mode => temporal_merge.mode,         era_name => temporal_merge.era_name,         identity_columns => v_identity_cols_discovered,         row_id_column => temporal_merge.row_id_column,         founding_id_column => temporal_merge.founding_id_column,         delete_mode => temporal_merge.delete_mode,         lookup_keys => v_natural_identity_keys_discovered,         ephemeral_columns => temporal_merge.ephemeral_columns,         p_log_trace => v_log_trace,         p_log_sql => v_log_sql     )"
288,temporal_merge Parent (With Index),,7519140057750260584,1,173.063791,1000,488,0,0,0,0,140,16671,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     with_base_payload.*,                     with_base_payload.stable_pk_payload as propagated_stable_pk_payload                 FROM (                     SELECT                         seg.*, source_payloads.source_row_id, source_payloads.contributing_row_ids,                          source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                         source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until                     FROM all_segments seg                                              LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE                  ((seg.is_new_entity AND source_row.grouping_key = seg.grouping_key)                 OR                 (NOT seg.is_new_entity AND (source_row.id = seg.id OR (source_row.id IS NULL AND seg.id IS NULL))))              -- v_lateral_join_sr_to_seg                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_until)                             ),                             running_payload AS (                                 SELECT rn, source_row_id, data_payload, ephemeral_payload, valid_from, val"
ee8,temporal_merge Parent (With Index),,1120644662951873463,1,172.32508399999998,1000,344,0,0,0,0,140,16671,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     with_base_payload.*,                     with_base_payload.stable_pk_payload as propagated_stable_pk_payload                 FROM (                     SELECT                         seg.*, source_payloads.source_row_id, source_payloads.contributing_row_ids,                          source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                         source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until                     FROM all_segments seg                                              LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE                  ((seg.is_new_entity AND source_row.grouping_key = seg.grouping_key)                 OR                 (NOT seg.is_new_entity AND (source_row.id = seg.id OR (source_row.id IS NULL AND seg.id IS NULL))))              -- v_lateral_join_sr_to_seg                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_until)                             ),                             running_payload AS (                                 SELECT rn, source_row_id, data_payload, ephemeral_payload, valid_from, val"
8d5,temporal_merge Parent (With Index),,-6751165780132234575,1,45.804,0,25279,36,0,0,0,8093,856758,"CALL sql_saga.temporal_merge_execute(         target_table => temporal_merge.target_table,         source_table => temporal_merge.source_table,         identity_columns => v_identity_cols_discovered,         mode => temporal_merge.mode,         era_name => temporal_merge.era_name,         row_id_column => temporal_merge.row_id_column,         founding_id_column => temporal_merge.founding_id_column,         update_source_with_identity => temporal_merge.update_source_with_identity,         lookup_columns => v_natural_identity_cols_discovered,         delete_mode => temporal_merge.delete_mode,         update_source_with_feedback => temporal_merge.update_source_with_feedback,         feedback_status_column => temporal_merge.feedback_status_column,         feedback_status_key => temporal_merge.feedback_status_key,         feedback_error_column => temporal_merge.feedback_error_column,         feedback_error_key => temporal_merge.feedback_error_key,         ephemeral_columns => temporal_merge.ephemeral_columns,         delay_constraints => temporal_merge.delay_constraints     )"
5ea,temporal_merge Parent (With Index),,7243520755711534891,1,33.413542,1000,467,0,0,0,0,119,13339,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT                     s1.*,                     eclipse_info.is_eclipsed,                     eclipse_info.eclipsed_by                 FROM source_initial s1                 CROSS JOIN LATERAL (                     SELECT                         -- OPTIMIZATION: Use pre-computed valid_range instead of repeated daterange() calls                         -- Combined with composite index, this provides 30-40 percent total performance improvement                         COALESCE(sql_saga.covers_without_gaps(s2.valid_range, s1.valid_range ORDER BY s2.valid_from), false) as is_eclipsed,                         array_agg(s2.source_row_id) as eclipsed_by                     FROM source_initial s2                     WHERE                         (                             (NOT s1.lookup_columns_unavailable AND (s1.id IS NOT DISTINCT FROM s2.id))                             OR                             (s1.lookup_columns_unavailable AND s1.causal_id = s2.causal_id)                         )                         AND                         -- Only consider newer rows (higher row_id) as potential eclipsers.                         s2.source_row_id > s1.source_row_id                 ) eclipse_info"
cd2,temporal_merge Parent (With Index),,5618979676333803494,1,32.915958,1000,294,0,0,0,0,118,13273,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT                     s1.*,                     eclipse_info.is_eclipsed,                     eclipse_info.eclipsed_by                 FROM source_initial s1                 CROSS JOIN LATERAL (                     SELECT                         -- OPTIMIZATION: Use pre-computed valid_range instead of repeated daterange() calls                         -- Combined with composite index, this provides 30-40 percent total performance improvement                         COALESCE(sql_saga.covers_without_gaps(s2.valid_range, s1.valid_range ORDER BY s2.valid_from), false) as is_eclipsed,                         array_agg(s2.source_row_id) as eclipsed_by                     FROM source_initial s2                     WHERE                         (                             (NOT s1.lookup_columns_unavailable AND (s1.id IS NOT DISTINCT FROM s2.id))                             OR                             (s1.lookup_columns_unavailable AND s1.causal_id = s2.causal_id)                         )                         AND                         -- Only consider newer rows (higher row_id) as potential eclipsers.                         s2.source_row_id > s1.source_row_id                 ) eclipse_info;"
401,temporal_merge Parent (With Index),,600389111002972566,1,30.073583,1000,23388,36,0,0,0,7772,812121,"UPDATE legal_unit t SET valid_range = p.new_valid_range::daterange, name = CASE WHEN p.data ? 'name' THEN (p.data->>'name')::character varying ELSE t.name END                                 FROM (SELECT *, (entity_keys->>'id')::integer AS id_ek FROM temporal_merge_plan WHERE operation = 'UPDATE' AND statement_seq = 1 ORDER BY plan_op_seq) p                                 WHERE t.id = p.id_ek AND t.valid_range = p.old_valid_range::daterange"
