log_id,event,label,queryid,calls,total_exec_time,rows,shared_blks_hit,shared_blks_read,temp_blks_read,temp_blks_written,total_plan_time,wal_records,wal_bytes,query
b5f,Generate Test Data - 10000 entities,,-5355742373523934002,1,3297.647542,1,1421463,4,0,0,0,755401,73295389,"SELECT etl_bench.generate_test_data(v_dataset_size, 3, 5)"
74a,Generate Test Data - 10000 entities,,1750016048022143304,1,3118.447458,150000,1418285,4,0,0,0,755299,73274647,"INSERT INTO etl_bench.data_table (         row_id, batch, identity_correlation, comment,         tax_ident, lu_name, physical_address, postal_address,         activity_code, employees, turnover, valid_from, valid_until     )     SELECT          row_number() OVER () as row_id,         batch_num,         entity_num as identity_correlation,         format('Entity %s batch %s row %s', entity_num, batch_num, row_in_batch_num) as comment,         CASE WHEN row_in_batch_num = 1 THEN format('TAX%s', entity_num) END as tax_ident,         CASE WHEN row_in_batch_num = 1 THEN format('Company-%s', entity_num) END as lu_name,         CASE WHEN row_in_batch_num <= 2 THEN format('%s Main St, City %s', entity_num, entity_num) END as physical_address,         CASE WHEN row_in_batch_num <= 3 THEN format('PO Box %s', entity_num) END as postal_address,         CASE WHEN row_in_batch_num <= 4 THEN (CASE WHEN entity_num % 2 = 0 THEN 'manufacturing' ELSE 'retail' END) END as activity_code,         CASE WHEN row_in_batch_num <= 4 THEN (entity_num % 100) + 10 END as employees,         CASE WHEN row_in_batch_num <= 5 THEN (entity_num % 1000) * 1000 + 50000 END as turnover,         ('2024-01-01'::date + ((batch_num - 1) * 90 + (row_in_batch_num - 1) * 30)) as valid_from,         'infinity'::date as valid_until     FROM          generate_series(1, p_total_entities) as entity_num,         generate_series(1, p_batches_per_entity) as batch_num,         generate_series(1, p_rows_per_entity_per_batch) as row_in_batch_num"
af1,Generate Test Data - 10000 entities,,760596586349204572,1,175.825584,0,2680,0,0,0,0,41,16269,ANALYZE etl_bench.data_table
bf2,Process Legal Units - Batch 1,,3443075950889914394,1,6123.480584,0,2702689,7,0,0,0,1072494,103077887,CALL etl_bench.process_legal_units(v_batch_id)
232,Process Legal Units - Batch 1,,-3169870935594387745,1,3932.178959,140000,2112476,0,0,0,0,846525,80903647,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
c79,Process Legal Units - Batch 1,,-1695124423541234323,1,2144.710083,0,527750,6,0,0,0,195869,20355021,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
4fd,Process Legal Units - Batch 1,,7921083691356368490,1,1216.039167,0,508125,3,0,0,0,191418,19797648,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
163,Process Legal Units - Batch 1,,3348120163733767422,1,923.144458,10000,18845,3,0,0,0,4269,533923,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
c77,Process Legal Units - Batch 1,,6902716109280737617,1,503.08058300000005,10000,148692,3,0,0,0,70372,7471053,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
55e,Process Legal Units - Batch 1,,-6251707813684716315,1,347.012376,10000,163534,0,0,0,0,60482,6326166,"UPDATE source_view_lu s             SET merge_statuses = COALESCE(s.merge_statuses, '{}'::jsonb) || jsonb_build_object('legal_unit', f.status), merge_errors = CASE WHEN f.error_message IS NOT NULL THEN COALESCE(s.merge_errors, '{}'::jsonb) || jsonb_build_object('legal_unit', f.error_message) ELSE COALESCE(s.merge_errors, '{}'::jsonb) - 'legal_unit' END             FROM pg_temp.temporal_merge_feedback f             WHERE s.row_id = f.source_row_id"
bdd,Process Legal Units - Batch 1,,-6678590435897699211,1,255.15658299999998,10000,190375,0,0,0,0,60075,5935712,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
9fe,Process Legal Units - Batch 1,,-7186451687768528831,1,75.386417,10000,496,0,0,0,0,153,19457,"CREATE TEMP TABLE resolved_atomic_segments_with_propagated_ids ON COMMIT DROP AS                 SELECT                     *,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY grouping_key ORDER BY valid_from) as unified_canonical_nk_json,                     COALESCE(                         contributing_row_ids,                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as causal_source_row_ids,                     COALESCE(                         s_valid_from,                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_from,                     COALESCE(                         s_valid_until,                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_until                 FROM (                     SELECT                         *,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from) AS look_behind_grp,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from DESC) AS look_ahead_grp                     FROM resolved_atomic_segments_with_payloads /* v_resolver_from */                 ) with_grp"
521,Process Legal Units - Batch 1,,7218594984218514853,1,74.74562499999999,10000,367,0,0,0,0,153,19457,"CREATE TEMP TABLE resolved_atomic_segments_with_propagated_ids ON COMMIT DROP AS                 SELECT                     *,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY grouping_key ORDER BY valid_from) as unified_canonical_nk_json,                     COALESCE(                         contributing_row_ids,                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as causal_source_row_ids,                     COALESCE(                         s_valid_from,                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_from,                     COALESCE(                         s_valid_until,                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_until                 FROM (                     SELECT                         *,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from) AS look_behind_grp,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from DESC) AS look_ahead_grp                     FROM resolved_atomic_segments_with_payloads /* v_resolver_from */                 ) with_grp"
ba9,Process Legal Units - Batch 1,,6446111097803510451,1,69.65275,10000,375,0,0,0,0,136,15697,"CREATE TEMP TABLE new_segments_no_target ON COMMIT DROP AS                 SELECT                     seg.grouping_key, seg.canonical_nk_json, seg.id, seg.causal_id, seg.is_new_entity, seg.is_identifiable, seg.is_ambiguous, seg.conflicting_ids, seg.stable_identity_columns_are_null, seg.lookup_columns_unavailable, seg.valid_from, seg.valid_until,                     NULL::date as t_valid_from, NULL::date as t_valid_until,                     NULL::jsonb as t_data_payload, NULL::jsonb as t_ephemeral_payload, seg.stable_pk_payload,                     NULL::jsonb as target_stable_pk_payload,                     source_payloads.source_row_id, source_payloads.contributing_row_ids,                     source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                     source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until,                     NULL::jsonb as trace                 FROM atomic_segments seg                                          LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE source_row.grouping_key = seg.grouping_key                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_until)                             ),                             running_payload AS (                                 SELECT rn, source_row_id, data_payload, ephemeral_payload, valid_from, valid_until, causal_id, ARRAY[source_row_id::BIGINT] as contributing_row_ids                 "
676,Process Legal Units - Batch 1,,-1988355907103003074,1,69.03704099999999,10000,334,0,0,0,0,136,15697,"CREATE TEMP TABLE new_segments_no_target ON COMMIT DROP AS                 SELECT                     seg.grouping_key, seg.canonical_nk_json, seg.id, seg.causal_id, seg.is_new_entity, seg.is_identifiable, seg.is_ambiguous, seg.conflicting_ids, seg.stable_identity_columns_are_null, seg.lookup_columns_unavailable, seg.valid_from, seg.valid_until,                     NULL::date as t_valid_from, NULL::date as t_valid_until,                     NULL::jsonb as t_data_payload, NULL::jsonb as t_ephemeral_payload, seg.stable_pk_payload,                     NULL::jsonb as target_stable_pk_payload,                     source_payloads.source_row_id, source_payloads.contributing_row_ids,                     source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                     source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until,                     NULL::jsonb as trace                 FROM atomic_segments seg                                          LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE source_row.grouping_key = seg.grouping_key                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_until)                             ),                             running_payload AS (                                 SELECT rn, source_row_id, data_payload, ephemeral_payload, valid_from, valid_until, causal_id, ARRAY[source_row_id::BIGINT] as contributing_row_ids                 "
27e,Process Legal Units - Batch 1,,-4462245821754466351,1,68.323209,10000,438,0,0,0,0,129,14446,"CREATE TEMP TABLE coalesced_final_segments ON COMMIT DROP AS                 SELECT                     grouping_key, max(id) as id,                     sql_saga.first(causal_id ORDER BY valid_from) as causal_id,                     sql_saga.first(stable_identity_columns_are_null ORDER BY valid_from) as stable_identity_columns_are_null,                     sql_saga.first(lookup_columns_unavailable ORDER BY valid_from) as lookup_columns_unavailable,                     sql_saga.first(is_new_entity ORDER BY valid_from) as is_new_entity,                     sql_saga.first(is_identifiable ORDER BY valid_from) as is_identifiable,                     sql_saga.first(is_ambiguous ORDER BY valid_from) as is_ambiguous,                     sql_saga.first(conflicting_ids ORDER BY valid_from) as conflicting_ids,                     sql_saga.first(unified_canonical_nk_json ORDER BY valid_from) as canonical_nk_json,                     sql_saga.first(orig_source_target_relation ORDER BY valid_from) as orig_source_target_relation,                     sql_saga.first(t_valid_from ORDER BY valid_from) as ancestor_valid_from,                     MIN(valid_from) as valid_from,                     MAX(valid_until) as valid_until,                     (sql_saga.first(data_payload ORDER BY valid_from DESC) || sql_saga.first(ephemeral_payload ORDER BY valid_from DESC)) as final_payload,                     sql_saga.first(stable_pk_payload ORDER BY valid_from DESC) as stable_pk_payload,                     bool_and(unaffected_target_only_segment) as unaffected_target_only_segment,                     (SELECT array_agg(DISTINCT e) FROM unnest(array_concat_agg(causal_source_row_ids)) e WHERE e IS NOT NULL) as row_ids,                     CASE WHEN 'f'::boolean                         THEN jsonb_build_object( 'cte', 'coalesced', 'island_group_id', island_group_id, 'coalesced_stable_pk', sql_saga.first(stable_pk_payload ORDER BY valid_from DESC), 'final_payload', sql_saga.first(data_payload ORDER BY valid_from DESC), 'final_payload_sans_epheme"
a46,Process Legal Units - Batch 1,,-6040831410118454259,1,67.760417,10000,320,0,0,0,0,129,14446,"CREATE TEMP TABLE coalesced_final_segments ON COMMIT DROP AS                 SELECT                     grouping_key, max(id) as id,                     sql_saga.first(causal_id ORDER BY valid_from) as causal_id,                     sql_saga.first(stable_identity_columns_are_null ORDER BY valid_from) as stable_identity_columns_are_null,                     sql_saga.first(lookup_columns_unavailable ORDER BY valid_from) as lookup_columns_unavailable,                     sql_saga.first(is_new_entity ORDER BY valid_from) as is_new_entity,                     sql_saga.first(is_identifiable ORDER BY valid_from) as is_identifiable,                     sql_saga.first(is_ambiguous ORDER BY valid_from) as is_ambiguous,                     sql_saga.first(conflicting_ids ORDER BY valid_from) as conflicting_ids,                     sql_saga.first(unified_canonical_nk_json ORDER BY valid_from) as canonical_nk_json,                     sql_saga.first(orig_source_target_relation ORDER BY valid_from) as orig_source_target_relation,                     sql_saga.first(t_valid_from ORDER BY valid_from) as ancestor_valid_from,                     MIN(valid_from) as valid_from,                     MAX(valid_until) as valid_until,                     (sql_saga.first(data_payload ORDER BY valid_from DESC) || sql_saga.first(ephemeral_payload ORDER BY valid_from DESC)) as final_payload,                     sql_saga.first(stable_pk_payload ORDER BY valid_from DESC) as stable_pk_payload,                     bool_and(unaffected_target_only_segment) as unaffected_target_only_segment,                     (SELECT array_agg(DISTINCT e) FROM unnest(array_concat_agg(causal_source_row_ids)) e WHERE e IS NOT NULL) as row_ids,                     CASE WHEN 'f'::boolean                         THEN jsonb_build_object( 'cte', 'coalesced', 'island_group_id', island_group_id, 'coalesced_stable_pk', sql_saga.first(stable_pk_payload ORDER BY valid_from DESC), 'final_payload', sql_saga.first(data_payload ORDER BY valid_from DESC), 'final_payload_sans_epheme"
e07,Process Legal Units - Batch 1,,8679993553546922744,1,53.235708,20000,352,0,0,0,0,116,13077,"CREATE TEMP TABLE time_points_unified ON COMMIT DROP AS                 SELECT                     *,                     CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END AS grouping_key,                     CASE                         WHEN is_new_entity THEN causal_id                         ELSE FIRST_VALUE(causal_id) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS LAST)                     END as unified_causal_id,                     FIRST_VALUE(stable_pk_payload) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_stable_pk_payload,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_canonical_nk_json                 FROM time_points_raw"
ec7,Process Legal Units - Batch 1,,2335399437257891460,1,52.735792,20000,292,0,0,0,0,116,13077,"CREATE TEMP TABLE time_points_unified ON COMMIT DROP AS                 SELECT                     *,                     CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END AS grouping_key,                     CASE                         WHEN is_new_entity THEN causal_id                         ELSE FIRST_VALUE(causal_id) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS LAST)                     END as unified_causal_id,                     FIRST_VALUE(stable_pk_payload) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_stable_pk_payload,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_canonical_nk_json                 FROM time_points_raw"
366,Process Legal Units - Batch 1,,5432145740772416088,1,51.504333,0,209,0,0,0,0,48,10084,ANALYZE active_source_rows
85b,Process Legal Units - Batch 1,,7295163325594009324,1,43.972876,10000,62234,1,0,0,0,30028,1810660,"INSERT INTO etl_bench.identity_resolution (identity_correlation, legal_unit_id, resolved_batch)     SELECT DISTINCT          identity_correlation,         legal_unit_id,         p_batch_id     FROM etl_bench.data_table     WHERE batch = p_batch_id AND legal_unit_id IS NOT NULL     ON CONFLICT (identity_correlation) DO UPDATE SET         legal_unit_id = EXCLUDED.legal_unit_id,         resolved_batch = EXCLUDED.resolved_batch"
690,Process Legal Units - Batch 1,,-518691661278450688,1,40.922459,0,269,0,0,0,0,40,7674,ANALYZE source_rows_with_nk_json
3c0,Process Legal Units - Batch 1,,2568094112886783045,1,36.619208,10000,0,0,0,0,0,0,0,"WITH RECURSIVE ordered_plan AS (                     SELECT                         row_number() OVER ( ORDER BY p.grouping_key, p.id, CASE p.operation WHEN 'DELETE' THEN 1 WHEN 'UPDATE' THEN 2 WHEN 'INSERT' THEN 3 ELSE 4 END, p.update_effect NULLS FIRST, CASE WHEN p.update_effect = 'MOVE' THEN 1 ELSE 0 END, CASE WHEN p.update_effect = 'MOVE' THEN COALESCE(p.old_valid_from, p.new_valid_from) END DESC NULLS LAST, COALESCE(p.old_valid_from, p.new_valid_from), (p.row_ids[1]) )::BIGINT as plan_op_seq,                         p.*                     FROM plan p                 ),                 -- For MOVE operations, group into the largest possible batches that can execute together.                 -- Within a single UPDATE statement, all rows see the pre-update state (MVCC snapshot).                 -- So if MOVE A's new_range overlaps MOVE B's old_range, they cannot be in the same statement.                 --                 -- Algorithm: Process MOVEs in plan_op_seq order (which is old_valid_from DESC).                 -- Track a multirange of old_ranges in the current batch. For each MOVE:                 -- - If new_range overlaps the batch's multirange, start a new batch                 -- - Add this MOVE's old_range to the batch's multirange                 --                 -- We use a recursive CTE to accumulate the multirange with reset-on-conflict logic.                 moves_ordered AS (                     SELECT                         o.plan_op_seq,                         o.grouping_key,                         o.old_valid_from,                         o.old_valid_until,                         o.new_valid_from,                         o.new_valid_until,                         row_number() OVER (PARTITION BY o.grouping_key ORDER BY o.plan_op_seq) AS move_seq                     FROM ordered_plan o                     WHERE o.operation = 'UPDATE' AND o.update_effect = 'MOVE'                 ),                 moves_with_batch AS (                     -- Base case: first MOVE in each entity starts b"
b9e,Process Legal Units - Batch 1,,5039860120774769872,1,35.070333,0,163,0,0,0,0,26,6246,ANALYZE source_initial
18e,Process Legal Units - Batch 1,,-1407412071598267173,1,31.590874999999997,10000,2665,0,0,0,0,0,0,"WITH             all_source_rows AS (                 SELECT t.row_id AS source_row_id FROM source_view_lu t             ),             plan_unnested AS (                 SELECT unnest(p.row_ids) as source_row_id, p.plan_op_seq, p.entity_keys, p.operation, p.data, p.feedback                 FROM temporal_merge_plan p             ),             feedback_groups AS (                 SELECT                     asr.source_row_id,                     -- Aggregate all distinct operations for this source row.                     array_agg(DISTINCT pu.operation) FILTER (WHERE pu.operation IS NOT NULL) as operations,                     -- Aggregate all distinct entity IDs this source row touched.                     COALESCE(jsonb_agg(DISTINCT pu.entity_keys) FILTER (WHERE pu.entity_keys IS NOT NULL), '[]'::jsonb) AS target_entity_keys,                     -- Extract the specific error message from the plan's feedback payload if present.                     (array_agg(pu.feedback->>'error') FILTER (WHERE pu.operation = 'ERROR' AND pu.feedback ? 'error'))[1] as error_message_from_plan                 FROM all_source_rows asr                 LEFT JOIN plan_unnested pu ON asr.source_row_id = pu.source_row_id                 GROUP BY asr.source_row_id             )             INSERT INTO temporal_merge_feedback                 SELECT                     fg.source_row_id,                     fg.target_entity_keys,                     CASE                         -- This CASE statement must be ordered from most to least specific to correctly classify outcomes.                         -- This CASE statement directly translates the plan's actions into a final feedback status.                         -- It is ordered from most to least specific to ensure correctness.                         WHEN 'ERROR'::sql_saga.temporal_merge_plan_action = ANY(fg.operations) THEN 'ERROR'                         WHEN 'INSERT'::sql_saga.temporal_merge_plan_action = ANY(fg.operations)                           OR 'UPDATE'::sql_saga.temporal_merge_"
855,Process Legal Units - Batch 1,,-1239421672540476202,1,31.353542,0,245,0,0,0,0,55,13917,ANALYZE new_segments_no_target
734,Process Legal Units - Batch 1,,-5465740686636543570,1,26.447125,10000,0,0,0,0,0,0,0,UPDATE temporal_merge_plan p                                 SET entity_keys = p.entity_keys || m.new_entity_keys                                 FROM temporal_merge_entity_id_map m                                 WHERE p.grouping_key = m.grouping_key
fcc,Process Legal Units - Batch 1,,8021558608045147396,1,25.64425,10000,454,0,0,0,0,141,15373,"CREATE TEMP TABLE plan ON COMMIT DROP AS                 SELECT                     p.row_ids, p.operation, p.causal_id, p.is_new_entity,                     p.id,                     p.entity_keys_json as entity_keys,                     p.identity_keys, p.lookup_keys,                     p.orig_source_target_relation, p.b_a_relation, p.old_valid_from, p.old_valid_until,                     p.new_valid_from, p.new_valid_until, p.data, p.feedback, p.trace,                     p.grouping_key,                     CASE                         WHEN p.operation <> 'UPDATE' THEN NULL::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from = p.old_valid_from AND p.new_valid_until = p.old_valid_until THEN 'NONE'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from <= p.old_valid_from AND p.new_valid_until >= p.old_valid_until THEN 'GROW'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from >= p.old_valid_from AND p.new_valid_until <= p.old_valid_until THEN 'SHRINK'::sql_saga.temporal_merge_update_effect                         ELSE 'MOVE'::sql_saga.temporal_merge_update_effect                     END AS update_effect                 FROM plan_with_op p                 LEFT JOIN source_rows_with_new_flag source_row ON source_row.source_row_id = p.row_ids[1]"
94d,Process Legal Units - Batch 1,,1965474688105448427,1,25.478875,10000,2792,0,0,0,0,113,12592,"CREATE TEMP TABLE source_initial ON COMMIT DROP AS                 WITH source_data AS (                     SELECT                         source_table.row_id /* row_id_column */ as source_row_id,                         COALESCE(source_table.founding_id, source_table.row_id::integer) /* v_causal_select_expr */ as causal_id,                         source_table.id,  -- v_non_temporal_lookup_cols_select_list_prefix                         source_table.valid_from as valid_from, source_table.valid_until as valid_until, /* v_source_temporal_cols_expr */                         jsonb_strip_nulls(jsonb_build_object('name', source_table.name)) /* v_source_data_payload_expr */ AS data_payload,                         jsonb_strip_nulls(jsonb_build_object('comment', source_table.comment)) /* v_source_ephemeral_payload_expr */ AS ephemeral_payload,                         jsonb_build_object('id', source_table.id) /* v_stable_pk_cols_jsonb_build_source */ as stable_pk_payload,                         source_table.id IS NULL /* v_entity_id_check_is_null_expr */ as stable_identity_columns_are_null,                         (true) /* v_lookup_cols_are_null_expr */ as lookup_columns_unavailable,                         true /* v_is_identifiable_expr */ as is_identifiable,                         true /* v_consistency_check_expr */ as temporal_columns_are_consistent                     FROM source_view_lu /* v_source_table_ident */ source_table                 )                 SELECT                      *,                     -- OPTIMIZATION: Pre-compute range column to avoid repeated daterange() calls                     -- This provides ~10-15% performance improvement in eclipse detection                     daterange(valid_from, valid_until) as valid_range                 FROM source_data"
997,Process Legal Units - Batch 1,,8010399271587590855,1,25.161583,10000,350,0,0,0,0,141,15373,"CREATE TEMP TABLE plan ON COMMIT DROP AS                 SELECT                     p.row_ids, p.operation, p.causal_id, p.is_new_entity,                     p.id,                     p.entity_keys_json as entity_keys,                     p.identity_keys, p.lookup_keys,                     p.orig_source_target_relation, p.b_a_relation, p.old_valid_from, p.old_valid_until,                     p.new_valid_from, p.new_valid_until, p.data, p.feedback, p.trace,                     p.grouping_key,                     CASE                         WHEN p.operation <> 'UPDATE' THEN NULL::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from = p.old_valid_from AND p.new_valid_until = p.old_valid_until THEN 'NONE'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from <= p.old_valid_from AND p.new_valid_until >= p.old_valid_until THEN 'GROW'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from >= p.old_valid_from AND p.new_valid_until <= p.old_valid_until THEN 'SHRINK'::sql_saga.temporal_merge_update_effect                         ELSE 'MOVE'::sql_saga.temporal_merge_update_effect                     END AS update_effect                 FROM plan_with_op p                 LEFT JOIN source_rows_with_new_flag source_row ON source_row.source_row_id = p.row_ids[1]"
617,Process Legal Units - Batch 1,,2115514670139824758,1,25.0225,10000,2740,0,0,0,0,113,12592,"CREATE TEMP TABLE source_initial ON COMMIT DROP AS                 WITH source_data AS (                     SELECT                         source_table.row_id /* row_id_column */ as source_row_id,                         COALESCE(source_table.founding_id, source_table.row_id::integer) /* v_causal_select_expr */ as causal_id,                         source_table.id,  -- v_non_temporal_lookup_cols_select_list_prefix                         source_table.valid_from as valid_from, source_table.valid_until as valid_until, /* v_source_temporal_cols_expr */                         jsonb_strip_nulls(jsonb_build_object('name', source_table.name)) /* v_source_data_payload_expr */ AS data_payload,                         jsonb_strip_nulls(jsonb_build_object('comment', source_table.comment)) /* v_source_ephemeral_payload_expr */ AS ephemeral_payload,                         jsonb_build_object('id', source_table.id) /* v_stable_pk_cols_jsonb_build_source */ as stable_pk_payload,                         source_table.id IS NULL /* v_entity_id_check_is_null_expr */ as stable_identity_columns_are_null,                         (true) /* v_lookup_cols_are_null_expr */ as lookup_columns_unavailable,                         true /* v_is_identifiable_expr */ as is_identifiable,                         true /* v_consistency_check_expr */ as temporal_columns_are_consistent                     FROM source_view_lu /* v_source_table_ident */ source_table                 )                 SELECT                      *,                     -- OPTIMIZATION: Pre-compute range column to avoid repeated daterange() calls                     -- This provides ~10-15% performance improvement in eclipse detection                     daterange(valid_from, valid_until) as valid_range                 FROM source_data;"
656,Process Legal Units - Batch 1,,5509065722832958482,1,24.411,10000,479,0,0,0,0,141,16208,"CREATE TEMP TABLE resolved_atomic_segments ON COMMIT DROP AS                 SELECT                     grouping_key, id,  stable_identity_columns_are_null, lookup_columns_unavailable, is_new_entity, is_identifiable, is_ambiguous, conflicting_ids, unified_canonical_nk_json,                     valid_from, valid_until, t_valid_from, t_valid_until, propagated_s_valid_from, propagated_s_valid_until, causal_source_row_ids, causal_id, propagated_stable_pk_payload as stable_pk_payload,                     causal_source_row_ids IS NULL AS unaffected_target_only_segment,                     s_data_payload, t_data_payload,                     sql_saga.get_allen_relation(propagated_s_valid_from, propagated_s_valid_until, t_valid_from, t_valid_until) AS orig_source_target_relation,                     COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb) as data_payload,                     md5((jsonb_strip_nulls(COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb)))::text) as data_hash,                     CASE                          WHEN s_data_payload IS NULL THEN t_ephemeral_payload                         ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb)                     END as ephemeral_payload,                     CASE WHEN 'f'::boolean                         THEN trace || jsonb_build_object( 'cte', 'ras', 'segment_stable_pk', propagated_stable_pk_payload, 'final_data_payload', COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb), 'final_ephemeral_payload', CASE WHEN s_data_payload IS NULL THEN t_ephemeral_payload ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb) END )                         ELSE NULL                     END as trace                 FROM resolved_atomic_segments_with_propagated_ids"
095,Process Legal Units - Batch 1,,-2930989428870476669,1,23.83825,10000,343,0,0,0,0,141,16208,"CREATE TEMP TABLE resolved_atomic_segments ON COMMIT DROP AS                 SELECT                     grouping_key, id,  stable_identity_columns_are_null, lookup_columns_unavailable, is_new_entity, is_identifiable, is_ambiguous, conflicting_ids, unified_canonical_nk_json,                     valid_from, valid_until, t_valid_from, t_valid_until, propagated_s_valid_from, propagated_s_valid_until, causal_source_row_ids, causal_id, propagated_stable_pk_payload as stable_pk_payload,                     causal_source_row_ids IS NULL AS unaffected_target_only_segment,                     s_data_payload, t_data_payload,                     sql_saga.get_allen_relation(propagated_s_valid_from, propagated_s_valid_until, t_valid_from, t_valid_until) AS orig_source_target_relation,                     COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb) as data_payload,                     md5((jsonb_strip_nulls(COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb)))::text) as data_hash,                     CASE                          WHEN s_data_payload IS NULL THEN t_ephemeral_payload                         ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb)                     END as ephemeral_payload,                     CASE WHEN 'f'::boolean                         THEN trace || jsonb_build_object( 'cte', 'ras', 'segment_stable_pk', propagated_stable_pk_payload, 'final_data_payload', COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb), 'final_ephemeral_payload', CASE WHEN s_data_payload IS NULL THEN t_ephemeral_payload ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb) END )                         ELSE NULL                     END as trace                 FROM resolved_atomic_segments_with_propagated_ids"
9e2,Process Legal Units - Batch 1,,4494928315034638917,1,22.806292,10000,453,0,0,0,0,151,17506,"CREATE TEMP TABLE island_group ON COMMIT DROP AS                 SELECT                     *,                     SUM(is_island_start) OVER (PARTITION BY grouping_key ORDER BY valid_from) as island_group_id                 FROM (                     SELECT                         *,                         CASE                             WHEN prev_valid_until IS NULL                             OR prev_valid_until <> valid_from                             OR (prev_data_hash IS DISTINCT FROM data_hash)                             THEN 1                             ELSE 0                         END as is_island_start                     FROM (                         SELECT                             *,                             LAG(valid_until) OVER w as prev_valid_until,                             LAG(data_hash) OVER w as prev_data_hash,                             LAG(data_payload) OVER w as prev_data_payload                         FROM resolved_atomic_segments ras                         WHERE ras.data_payload IS NOT NULL                         WINDOW w AS (PARTITION BY grouping_key ORDER BY valid_from)                     ) s1                 ) s2"
272,Process Legal Units - Batch 1,,-8259425963603516266,1,22.716334,0,240,0,0,0,0,57,14207,ANALYZE resolved_atomic_segments_with_payloads
305,Process Legal Units - Batch 1,,-2675794321567617346,1,22.302084,10000,361,0,0,0,0,151,17506,"CREATE TEMP TABLE island_group ON COMMIT DROP AS                 SELECT                     *,                     SUM(is_island_start) OVER (PARTITION BY grouping_key ORDER BY valid_from) as island_group_id                 FROM (                     SELECT                         *,                         CASE                             WHEN prev_valid_until IS NULL                             OR prev_valid_until <> valid_from                             OR (prev_data_hash IS DISTINCT FROM data_hash)                             THEN 1                             ELSE 0                         END as is_island_start                     FROM (                         SELECT                             *,                             LAG(valid_until) OVER w as prev_valid_until,                             LAG(data_hash) OVER w as prev_data_hash,                             LAG(data_payload) OVER w as prev_data_payload                         FROM resolved_atomic_segments ras                         WHERE ras.data_payload IS NOT NULL                         WINDOW w AS (PARTITION BY grouping_key ORDER BY valid_from)                     ) s1                 ) s2"
81e,Process Legal Units - Batch 1,,-7556227097878634121,1,21.927667,0,287,0,0,0,0,50,13970,ANALYZE temporal_merge_plan
2db,Process Legal Units - Batch 1,,4895990506256861755,10000,21.04118100000129,10000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
0e7,Process Legal Units - Batch 1,,1428552154429020267,1,19.94675,20000,342,0,0,0,0,110,12251,"CREATE TEMP TABLE time_points ON COMMIT DROP AS                 SELECT DISTINCT ON (grouping_key, point) *                 FROM time_points_with_unified_ids                 ORDER BY grouping_key, point, causal_id DESC NULLS LAST"
b0a,Process Legal Units - Batch 1,,6254436778457358929,1,19.526625,20000,280,0,0,0,0,110,12251,"CREATE TEMP TABLE time_points ON COMMIT DROP AS                 SELECT DISTINCT ON (grouping_key, point) *                 FROM time_points_with_unified_ids                 ORDER BY grouping_key, point, causal_id DESC NULLS LAST"
40b,Process Legal Units - Batch 1,,1300200293165651031,1,17.311958,10000,415,0,0,0,0,133,14670,"CREATE TEMP TABLE plan_with_op ON COMMIT DROP AS                 (                     SELECT * FROM (                         SELECT                             d.f_row_ids as row_ids, d.orig_source_target_relation, d.is_new_entity,                             CASE                                 WHEN d.is_ambiguous THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.is_new_entity AND NOT d.is_identifiable THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.t_from IS NULL THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.f_from IS NULL THEN 'DELETE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank = 1 THEN 'UPDATE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank > 1 THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank IS NULL THEN                                     CASE                                         WHEN d.unaffected_target_only_segment THEN NULL                                         ELSE 'SKIP_IDENTICAL'::sql_saga.temporal_merge_plan_action                                     END                                 ELSE 'ERROR'::sql_saga.temporal_merge_plan_action                             END as operation,                             id,                             CASE                                 WHEN d.is_new_entity AND d.canonical_nk_json IS NOT NULL                                 THEN d.canonical_nk_json || COALESCE(d.stable_pk_payload, '{}'::jsonb)                                 ELSE jsonb_build_object('id', d.id) || COALESCE(d.stable_pk_payload, '{}'::jsonb)                             END as entity_keys_json,                             jsonb_build_object('id', d.id) as identity_keys,                             jsonb_build_object() as lookup_keys,                             d.causal_id, d.t_from as old_valid_from, d.t_until as old_valid_until, d.f"
856,Process Legal Units - Batch 1,,-5024370260775748889,1,17.221459,10000,380,0,0,0,0,121,14045,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT * FROM (                     -- Path 1: Existing Entities (Window Function on Lookup Keys)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE NOT s1.lookup_columns_unavailable                      UNION ALL                      -- Path 2: New Entities (Window Function on Causal ID)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY causal_id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY causal_id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE s1.lookup_columns_unavailable                 ) t"
ecc,Process Legal Units - Batch 1,,7743831913079285872,10000,17.010049000000112,10000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
4d5,Process Legal Units - Batch 1,,7000426517880687954,1,16.878084,10000,470,0,0,0,0,131,14995,"CREATE TEMP TABLE source_rows_with_canonical_key ON COMMIT DROP AS                 SELECT *, (CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END /* v_grouping_key_expr */) as grouping_key                 FROM (                     SELECT                         s1.*,                         s2.nk_json as canonical_nk_json                     FROM source_rows_with_nk_json s1                     LEFT JOIN LATERAL (                         SELECT s2_inner.nk_json, s2_inner.nk_non_null_keys_array                         FROM source_rows_with_nk_json s2_inner                         WHERE s1.is_new_entity AND s2_inner.is_new_entity AND s2_inner.nk_json @> s1.nk_json                         ORDER BY array_length(s2_inner.nk_non_null_keys_array, 1) DESC, s2_inner.nk_non_null_keys_array::text DESC                         LIMIT 1                     ) s2 ON true                 ) s"
452,Process Legal Units - Batch 1,,3167307580342175303,1,16.561290999999997,10000,305,0,0,0,0,121,14045,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT * FROM (                     -- Path 1: Existing Entities (Window Function on Lookup Keys)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE NOT s1.lookup_columns_unavailable                      UNION ALL                      -- Path 2: New Entities (Window Function on Causal ID)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY causal_id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY causal_id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE s1.lookup_columns_unavailable                 ) t;"
7e7,Process Legal Units - Batch 1,,2006172193490038593,1,16.412458,10000,324,0,0,0,0,133,14670,"CREATE TEMP TABLE plan_with_op ON COMMIT DROP AS                 (                     SELECT * FROM (                         SELECT                             d.f_row_ids as row_ids, d.orig_source_target_relation, d.is_new_entity,                             CASE                                 WHEN d.is_ambiguous THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.is_new_entity AND NOT d.is_identifiable THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.t_from IS NULL THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.f_from IS NULL THEN 'DELETE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank = 1 THEN 'UPDATE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank > 1 THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank IS NULL THEN                                     CASE                                         WHEN d.unaffected_target_only_segment THEN NULL                                         ELSE 'SKIP_IDENTICAL'::sql_saga.temporal_merge_plan_action                                     END                                 ELSE 'ERROR'::sql_saga.temporal_merge_plan_action                             END as operation,                             id,                             CASE                                 WHEN d.is_new_entity AND d.canonical_nk_json IS NOT NULL                                 THEN d.canonical_nk_json || COALESCE(d.stable_pk_payload, '{}'::jsonb)                                 ELSE jsonb_build_object('id', d.id) || COALESCE(d.stable_pk_payload, '{}'::jsonb)                             END as entity_keys_json,                             jsonb_build_object('id', d.id) as identity_keys,                             jsonb_build_object() as lookup_keys,                             d.causal_id, d.t_from as old_valid_from, d.t_until as old_valid_until, d.f"
9d3,Process Legal Units - Batch 1,,6779487562696088383,1,16.246917,10000,366,0,0,0,0,118,13151,"CREATE TEMP TABLE atomic_segments ON COMMIT DROP AS                 SELECT grouping_key, id, causal_id, point as valid_from, next_point as valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json                 FROM (                     SELECT *, LEAD(point) OVER (PARTITION BY grouping_key ORDER BY point) as next_point                     FROM time_points                 ) with_lead                 WHERE point IS NOT NULL AND next_point IS NOT NULL AND point < next_point"
8c8,Process Legal Units - Batch 1,,5147944785677299242,1,16.24275,10000,419,0,0,0,0,139,16559,"CREATE TEMP TABLE diff_ranked ON COMMIT DROP AS                 SELECT                     d.*,                     CASE                         WHEN d.t_from IS NULL OR d.f_from IS NULL THEN NULL                         WHEN d.f_from = d.t_from AND d.f_until = d.t_until AND d.f_payload IS NOT DISTINCT FROM d.t_payload THEN NULL                         ELSE                             row_number() OVER (                                 PARTITION BY d.grouping_key, d.t_from                                 ORDER BY                                     CASE WHEN d.f_from = d.t_from THEN 1 ELSE 2 END,                                     CASE WHEN d.f_payload - '{comment}'::text[] IS NOT DISTINCT FROM d.t_payload - '{comment}'::text[] THEN 1 ELSE 2 END,                                     d.f_from,                                     d.f_until                             )                     END as update_rank                 FROM diff d"
374,Process Legal Units - Batch 1,,8118870935825291626,1,16.182333,10000,320,0,0,0,0,130,14935,"CREATE TEMP TABLE source_rows_with_canonical_key ON COMMIT DROP AS                 SELECT *, (CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END /* v_grouping_key_expr */) as grouping_key                 FROM (                     SELECT                         s1.*,                         s2.nk_json as canonical_nk_json                     FROM source_rows_with_nk_json s1                     LEFT JOIN LATERAL (                         SELECT s2_inner.nk_json, s2_inner.nk_non_null_keys_array                         FROM source_rows_with_nk_json s2_inner                         WHERE s1.is_new_entity AND s2_inner.is_new_entity AND s2_inner.nk_json @> s1.nk_json                         ORDER BY array_length(s2_inner.nk_non_null_keys_array, 1) DESC, s2_inner.nk_non_null_keys_array::text DESC                         LIMIT 1                     ) s2 ON true                 ) s"
7f3,Process Legal Units - Batch 1,,-7375841108639655790,1,15.787916999999998,10000,302,0,0,0,0,118,13151,"CREATE TEMP TABLE atomic_segments ON COMMIT DROP AS                 SELECT grouping_key, id, causal_id, point as valid_from, next_point as valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json                 FROM (                     SELECT *, LEAD(point) OVER (PARTITION BY grouping_key ORDER BY point) as next_point                     FROM time_points                 ) with_lead                 WHERE point IS NOT NULL AND next_point IS NOT NULL AND point < next_point"
93f,Process Legal Units - Batch 1,,6259880232974284115,1,15.143500000000001,10000,335,0,0,0,0,139,16559,"CREATE TEMP TABLE diff_ranked ON COMMIT DROP AS                 SELECT                     d.*,                     CASE                         WHEN d.t_from IS NULL OR d.f_from IS NULL THEN NULL                         WHEN d.f_from = d.t_from AND d.f_until = d.t_until AND d.f_payload IS NOT DISTINCT FROM d.t_payload THEN NULL                         ELSE                             row_number() OVER (                                 PARTITION BY d.grouping_key, d.t_from                                 ORDER BY                                     CASE WHEN d.f_from = d.t_from THEN 1 ELSE 2 END,                                     CASE WHEN d.f_payload - '{comment}'::text[] IS NOT DISTINCT FROM d.t_payload - '{comment}'::text[] THEN 1 ELSE 2 END,                                     d.f_from,                                     d.f_until                             )                     END as update_rank                 FROM diff d"
47a,Process Legal Units - Batch 1,,-6217490005536178219,1,15.143333,10000,519,0,0,0,0,142,19909,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     seg.*,                     seg.stable_pk_payload as propagated_stable_pk_payload                 FROM all_segments seg                 WHERE (seg.s_data_payload IS NOT NULL OR seg.t_data_payload IS NOT NULL)                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'PATCH_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'REPLACE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'DELETE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'UPDATE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     ELSE true                 END"
e29,Process Legal Units - Batch 1,,3662944893103168594,1,14.4735,10000,343,0,0,0,0,140,19787,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     seg.*,                     seg.stable_pk_payload as propagated_stable_pk_payload                 FROM all_segments seg                 WHERE (seg.s_data_payload IS NOT NULL OR seg.t_data_payload IS NOT NULL)                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'PATCH_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'REPLACE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'DELETE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'UPDATE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     ELSE true                 END"
e36,Process Legal Units - Batch 1,,5849653773365333279,1,13.074542,10000,386,0,0,0,0,121,13643,"CREATE TEMP TABLE source_rows_with_matches ON COMMIT DROP AS                 SELECT                     source_row.*,                     target_row.stable_pk_payload as discovered_stable_pk_payload,                     target_row.id AS discovered_id_1 /* v_propagated_id_cols_list */                 FROM source_with_eclipsed_flag source_row                 LEFT JOIN target_rows target_row ON (source_row.id = target_row.id /* v_source_rows_exists_join_expr */)"
045,Process Legal Units - Batch 1,,2613701250391606255,1,13.000541,10000,361,0,0,0,0,127,14423,"CREATE TEMP TABLE source_rows_with_discovery ON COMMIT DROP AS                 SELECT                     m.*,                     a.match_count,                     a.conflicting_ids,                     (a.match_count > 1) as is_ambiguous                 FROM source_rows_with_matches m                 JOIN source_rows_with_aggregates a ON m.source_row_id = a.source_row_id"
8bd,Process Legal Units - Batch 1,,8473430400440557908,1,12.428041,10000,317,0,0,0,0,127,14423,"CREATE TEMP TABLE source_rows_with_discovery ON COMMIT DROP AS                 SELECT                     m.*,                     a.match_count,                     a.conflicting_ids,                     (a.match_count > 1) as is_ambiguous                 FROM source_rows_with_matches m                 JOIN source_rows_with_aggregates a ON m.source_row_id = a.source_row_id"
117,Process Legal Units - Batch 1,,1995507501247956172,1,12.315458,10000,305,0,0,0,0,121,13643,"CREATE TEMP TABLE source_rows_with_matches ON COMMIT DROP AS                 SELECT                     source_row.*,                     target_row.stable_pk_payload as discovered_stable_pk_payload,                     target_row.id AS discovered_id_1 /* v_propagated_id_cols_list */                 FROM source_with_eclipsed_flag source_row                 LEFT JOIN target_rows target_row ON (source_row.id = target_row.id /* v_source_rows_exists_join_expr */)"
c49,Process Legal Units - Batch 1,,5012345967240423926,1,11.667958,10000,411,0,0,0,0,133,15217,"CREATE TEMP TABLE source_rows_with_early_feedback ON COMMIT DROP AS                 SELECT                     s.*,                     CASE                         WHEN s.is_ambiguous                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is ambiguous. It matches multiple distinct target entities: ' || s.conflicting_ids::text )                         WHEN NOT s.is_identifiable AND s.is_new_entity                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is unidentifiable. It has NULL for all stable identity columns ' || replace('{id}'::text, '""', '') || ' and all natural keys ' || replace(NULL::text, '""', '') )                         WHEN NOT s.temporal_columns_are_consistent                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row has inconsistent temporal columns. Column ""' || 'valid_until' || '"" must be equal to column ""' || NULL || '"" + ' || NULL || '.' )                         WHEN s.is_eclipsed                         THEN jsonb_build_object( 'operation', 'SKIP_ECLIPSED'::text, 'message', 'Source row was eclipsed by row_ids=' || s.eclipsed_by::text || ' in the same batch.' )                         ELSE NULL                     END as early_feedback                 FROM source_rows_with_canonical_key s"
033,Process Legal Units - Batch 1,,-1318097777820228,1,11.453958,10000,376,0,0,0,0,120,13561,"CREATE TEMP TABLE source_rows ON COMMIT DROP AS                 SELECT DISTINCT ON (p.source_row_id)                     p.source_row_id, p.causal_id, p.valid_from, p.valid_until, p.data_payload, p.ephemeral_payload,                     (p.stable_identity_columns_are_null AND p.discovered_stable_pk_payload IS NULL) as stable_identity_columns_are_null,                     p.lookup_columns_unavailable, p.is_identifiable,                     p.is_ambiguous, p.conflicting_ids, p.is_eclipsed, p.eclipsed_by,                     p.temporal_columns_are_consistent,                     COALESCE(p.stable_pk_payload, p.discovered_stable_pk_payload) as stable_pk_payload,                     (p.discovered_stable_pk_payload IS NOT NULL) /* v_target_entity_exists_expr */ as target_entity_exists,                     COALESCE(p.id, p.discovered_id_1) AS id /* v_coalesced_id_cols_list */                 FROM source_rows_with_discovery p                 ORDER BY p.source_row_id, p.discovered_stable_pk_payload"
2ae,Process Legal Units - Batch 1,,-72630411978071912,1,11.225917,10000,329,0,0,0,0,133,15217,"CREATE TEMP TABLE source_rows_with_early_feedback ON COMMIT DROP AS                 SELECT                     s.*,                     CASE                         WHEN s.is_ambiguous                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is ambiguous. It matches multiple distinct target entities: ' || s.conflicting_ids::text )                         WHEN NOT s.is_identifiable AND s.is_new_entity                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is unidentifiable. It has NULL for all stable identity columns ' || replace('{id}'::text, '""', '') || ' and all natural keys ' || replace(NULL::text, '""', '') )                         WHEN NOT s.temporal_columns_are_consistent                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row has inconsistent temporal columns. Column ""' || 'valid_until' || '"" must be equal to column ""' || NULL || '"" + ' || NULL || '.' )                         WHEN s.is_eclipsed                         THEN jsonb_build_object( 'operation', 'SKIP_ECLIPSED'::text, 'message', 'Source row was eclipsed by row_ids=' || s.eclipsed_by::text || ' in the same batch.' )                         ELSE NULL                     END as early_feedback                 FROM source_rows_with_canonical_key s"
83b,Process Legal Units - Batch 1,,-957741634502868070,1,11.122709,10000,394,0,0,0,0,129,15497,"CREATE TEMP TABLE source_rows_with_nk_json ON COMMIT DROP AS                 SELECT source_row.*, jsonb_strip_nulls(jsonb_build_object()) /* v_lookup_keys_as_jsonb_expr */ as nk_json, ARRAY(SELECT e FROM unnest(ARRAY[]::TEXT[]) e WHERE e IS NOT NULL ORDER BY e) /* v_lookup_keys_as_array_expr */ as nk_non_null_keys_array                 FROM source_rows_with_new_flag source_row"
97d,Process Legal Units - Batch 1,,2284106485190769639,1,10.991375,10000,300,0,0,0,0,120,13561,"CREATE TEMP TABLE source_rows ON COMMIT DROP AS                 SELECT DISTINCT ON (p.source_row_id)                     p.source_row_id, p.causal_id, p.valid_from, p.valid_until, p.data_payload, p.ephemeral_payload,                     (p.stable_identity_columns_are_null AND p.discovered_stable_pk_payload IS NULL) as stable_identity_columns_are_null,                     p.lookup_columns_unavailable, p.is_identifiable,                     p.is_ambiguous, p.conflicting_ids, p.is_eclipsed, p.eclipsed_by,                     p.temporal_columns_are_consistent,                     COALESCE(p.stable_pk_payload, p.discovered_stable_pk_payload) as stable_pk_payload,                     (p.discovered_stable_pk_payload IS NOT NULL) /* v_target_entity_exists_expr */ as target_entity_exists,                     COALESCE(p.id, p.discovered_id_1) AS id /* v_coalesced_id_cols_list */                 FROM source_rows_with_discovery p                 ORDER BY p.source_row_id, p.discovered_stable_pk_payload"
e89,Process Legal Units - Batch 1,,7625827313856663095,1,10.674875,10000,320,0,0,0,0,129,15497,"CREATE TEMP TABLE source_rows_with_nk_json ON COMMIT DROP AS                 SELECT source_row.*, jsonb_strip_nulls(jsonb_build_object()) /* v_lookup_keys_as_jsonb_expr */ as nk_json, ARRAY(SELECT e FROM unnest(ARRAY[]::TEXT[]) e WHERE e IS NOT NULL ORDER BY e) /* v_lookup_keys_as_array_expr */ as nk_non_null_keys_array                 FROM source_rows_with_new_flag source_row"
706,Process Legal Units - Batch 1,,-6771234532898534008,1,10.277,10000,415,0,0,0,0,139,19127,"CREATE TEMP TABLE diff ON COMMIT DROP AS                 SELECT                     final_seg.grouping_key, COALESCE(final_seg.id, target_seg.id) as id, COALESCE(final_seg.causal_id, target_seg.causal_id) as causal_id,                     COALESCE(final_seg.is_new_entity, false) as is_new_entity,                     COALESCE(final_seg.is_identifiable, true) as is_identifiable,                     COALESCE(final_seg.is_ambiguous, false) as is_ambiguous,                     final_seg.conflicting_ids,                     final_seg.canonical_nk_json,                     COALESCE(final_seg.stable_identity_columns_are_null, false) as stable_identity_columns_are_null,                     COALESCE(final_seg.lookup_columns_unavailable, false) as lookup_columns_unavailable,                     final_seg.valid_from AS f_from, final_seg.valid_until AS f_until, final_seg.final_payload AS f_payload, final_seg.row_ids AS f_row_ids, final_seg.stable_pk_payload, final_seg.orig_source_target_relation,                     CASE WHEN 'f'::boolean                         THEN final_seg.trace || jsonb_build_object('cte', 'diff', 'diff_stable_pk', final_seg.stable_pk_payload, 'final_seg_causal_id', final_seg.causal_id, 'final_payload_vs_target_payload', jsonb_build_object('f', final_seg.final_payload, 't', target_seg.data_payload))                         ELSE NULL                     END as trace,                     final_seg.unaffected_target_only_segment,                     target_seg.valid_from as t_from, target_seg.valid_until as t_until, (target_seg.data_payload || target_seg.ephemeral_payload) as t_payload,                     sql_saga.get_allen_relation(target_seg.valid_from, target_seg.valid_until, final_seg.valid_from, final_seg.valid_until) as b_a_relation                 FROM coalesced_final_segments AS final_seg                 FULL OUTER JOIN target_rows AS target_seg ON final_seg.grouping_key = ('existing_entity__' || COALESCE(target_seg.id::text, '_NULL_')) AND final_seg.ancestor_valid_from = target_seg.valid_from"
14f,Process Legal Units - Batch 1,,8689595743856886431,1,10.149333,0,124,0,0,0,0,15,1597,CREATE INDEX ON active_source_rows (grouping_key)
a03,Process Legal Units - Batch 2,,3443075950889914394,1,3283.927375,0,519225,0,3066,3071,0,186933,17382419,CALL etl_bench.process_legal_units(v_batch_id)
f33,Process Legal Units - Batch 2,,-1695124423541234323,1,3161.983666,0,418647,0,3066,3071,0,146756,14675150,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
5f3,Process Legal Units - Batch 2,,3348120163733767422,1,2262.921,10000,26125,0,3066,3071,0,5745,640955,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
ee3,Process Legal Units - Batch 2,,7921083691356368490,1,892.990208,0,391611,0,0,0,0,140746,14009467,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
bab,Process Legal Units - Batch 2,,2265356661347698759,1,570.286251,10000,220603,0,0,0,0,80368,7702592,"UPDATE etl_bench.legal_unit t SET valid_range = p.new_valid_range::daterange, name = CASE WHEN p.data ? 'name' THEN (p.data->>'name')::text ELSE t.name END, comment = CASE WHEN p.data ? 'comment' THEN (p.data->>'comment')::text ELSE t.comment END                                 FROM (SELECT *, (entity_keys->>'id')::integer AS id_ek FROM temporal_merge_plan WHERE operation = 'UPDATE' AND statement_seq = 1 ORDER BY plan_op_seq) p                                 WHERE t.id = p.id_ek AND t.valid_range = p.old_valid_range::daterange"
000,Process Legal Units - Batch 2,,-8259425963603516266,1,253.389916,0,247,0,0,0,0,57,25579,ANALYZE resolved_atomic_segments_with_payloads
071,Process Legal Units - Batch 2,,-7186451687768528831,1,239.3005,20000,503,0,747,748,0,153,18707,"CREATE TEMP TABLE resolved_atomic_segments_with_propagated_ids ON COMMIT DROP AS                 SELECT                     *,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY grouping_key ORDER BY valid_from) as unified_canonical_nk_json,                     COALESCE(                         contributing_row_ids,                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as causal_source_row_ids,                     COALESCE(                         s_valid_from,                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_from,                     COALESCE(                         s_valid_until,                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_until                 FROM (                     SELECT                         *,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from) AS look_behind_grp,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from DESC) AS look_ahead_grp                     FROM resolved_atomic_segments_with_payloads /* v_resolver_from */                 ) with_grp"
aac,Process Legal Units - Batch 2,,7218594984218514853,1,237.216376,20000,370,0,747,748,0,153,18707,"CREATE TEMP TABLE resolved_atomic_segments_with_propagated_ids ON COMMIT DROP AS                 SELECT                     *,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY grouping_key ORDER BY valid_from) as unified_canonical_nk_json,                     COALESCE(                         contributing_row_ids,                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as causal_source_row_ids,                     COALESCE(                         s_valid_from,                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_from,                     COALESCE(                         s_valid_until,                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_until                 FROM (                     SELECT                         *,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from) AS look_behind_grp,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from DESC) AS look_ahead_grp                     FROM resolved_atomic_segments_with_payloads /* v_resolver_from */                 ) with_grp"
891,Process Legal Units - Batch 2,,-6251707813684716315,1,213.04958299999998,10000,165320,0,0,0,0,60196,6279166,"UPDATE source_view_lu s             SET merge_statuses = COALESCE(s.merge_statuses, '{}'::jsonb) || jsonb_build_object('legal_unit', f.status), merge_errors = CASE WHEN f.error_message IS NOT NULL THEN COALESCE(s.merge_errors, '{}'::jsonb) || jsonb_build_object('legal_unit', f.error_message) ELSE COALESCE(s.merge_errors, '{}'::jsonb) - 'legal_unit' END             FROM pg_temp.temporal_merge_feedback f             WHERE s.row_id = f.source_row_id"
e51,Process Legal Units - Batch 2,,-5685077514497051452,1,201.92825,0,241,0,0,0,0,55,23934,ANALYZE existing_segments_with_target
7ff,Process Legal Units - Batch 2,,8679993553546922744,1,130.960167,40000,368,0,494,495,0,116,13077,"CREATE TEMP TABLE time_points_unified ON COMMIT DROP AS                 SELECT                     *,                     CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END AS grouping_key,                     CASE                         WHEN is_new_entity THEN causal_id                         ELSE FIRST_VALUE(causal_id) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS LAST)                     END as unified_causal_id,                     FIRST_VALUE(stable_pk_payload) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_stable_pk_payload,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_canonical_nk_json                 FROM time_points_raw"
477,Process Legal Units - Batch 2,,2335399437257891460,1,129.55945799999998,40000,297,0,494,495,0,116,13077,"CREATE TEMP TABLE time_points_unified ON COMMIT DROP AS                 SELECT                     *,                     CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END AS grouping_key,                     CASE                         WHEN is_new_entity THEN causal_id                         ELSE FIRST_VALUE(causal_id) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS LAST)                     END as unified_causal_id,                     FIRST_VALUE(stable_pk_payload) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_stable_pk_payload,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_canonical_nk_json                 FROM time_points_raw"
3f5,Process Legal Units - Batch 2,,-4462245821754466351,1,113.488083,10000,451,0,556,557,0,133,14982,"CREATE TEMP TABLE coalesced_final_segments ON COMMIT DROP AS                 SELECT                     grouping_key, max(id) as id,                     sql_saga.first(causal_id ORDER BY valid_from) as causal_id,                     sql_saga.first(stable_identity_columns_are_null ORDER BY valid_from) as stable_identity_columns_are_null,                     sql_saga.first(lookup_columns_unavailable ORDER BY valid_from) as lookup_columns_unavailable,                     sql_saga.first(is_new_entity ORDER BY valid_from) as is_new_entity,                     sql_saga.first(is_identifiable ORDER BY valid_from) as is_identifiable,                     sql_saga.first(is_ambiguous ORDER BY valid_from) as is_ambiguous,                     sql_saga.first(conflicting_ids ORDER BY valid_from) as conflicting_ids,                     sql_saga.first(unified_canonical_nk_json ORDER BY valid_from) as canonical_nk_json,                     sql_saga.first(orig_source_target_relation ORDER BY valid_from) as orig_source_target_relation,                     sql_saga.first(t_valid_from ORDER BY valid_from) as ancestor_valid_from,                     MIN(valid_from) as valid_from,                     MAX(valid_until) as valid_until,                     (sql_saga.first(data_payload ORDER BY valid_from DESC) || sql_saga.first(ephemeral_payload ORDER BY valid_from DESC)) as final_payload,                     sql_saga.first(stable_pk_payload ORDER BY valid_from DESC) as stable_pk_payload,                     bool_and(unaffected_target_only_segment) as unaffected_target_only_segment,                     (SELECT array_agg(DISTINCT e) FROM unnest(array_concat_agg(causal_source_row_ids)) e WHERE e IS NOT NULL) as row_ids,                     CASE WHEN 'f'::boolean                         THEN jsonb_build_object( 'cte', 'coalesced', 'island_group_id', island_group_id, 'coalesced_stable_pk', sql_saga.first(stable_pk_payload ORDER BY valid_from DESC), 'final_payload', sql_saga.first(data_payload ORDER BY valid_from DESC), 'final_payload_sans_epheme"
f98,Process Legal Units - Batch 2,,-6040831410118454259,1,111.982417,10000,336,0,556,557,0,133,14982,"CREATE TEMP TABLE coalesced_final_segments ON COMMIT DROP AS                 SELECT                     grouping_key, max(id) as id,                     sql_saga.first(causal_id ORDER BY valid_from) as causal_id,                     sql_saga.first(stable_identity_columns_are_null ORDER BY valid_from) as stable_identity_columns_are_null,                     sql_saga.first(lookup_columns_unavailable ORDER BY valid_from) as lookup_columns_unavailable,                     sql_saga.first(is_new_entity ORDER BY valid_from) as is_new_entity,                     sql_saga.first(is_identifiable ORDER BY valid_from) as is_identifiable,                     sql_saga.first(is_ambiguous ORDER BY valid_from) as is_ambiguous,                     sql_saga.first(conflicting_ids ORDER BY valid_from) as conflicting_ids,                     sql_saga.first(unified_canonical_nk_json ORDER BY valid_from) as canonical_nk_json,                     sql_saga.first(orig_source_target_relation ORDER BY valid_from) as orig_source_target_relation,                     sql_saga.first(t_valid_from ORDER BY valid_from) as ancestor_valid_from,                     MIN(valid_from) as valid_from,                     MAX(valid_until) as valid_until,                     (sql_saga.first(data_payload ORDER BY valid_from DESC) || sql_saga.first(ephemeral_payload ORDER BY valid_from DESC)) as final_payload,                     sql_saga.first(stable_pk_payload ORDER BY valid_from DESC) as stable_pk_payload,                     bool_and(unaffected_target_only_segment) as unaffected_target_only_segment,                     (SELECT array_agg(DISTINCT e) FROM unnest(array_concat_agg(causal_source_row_ids)) e WHERE e IS NOT NULL) as row_ids,                     CASE WHEN 'f'::boolean                         THEN jsonb_build_object( 'cte', 'coalesced', 'island_group_id', island_group_id, 'coalesced_stable_pk', sql_saga.first(stable_pk_payload ORDER BY valid_from DESC), 'final_payload', sql_saga.first(data_payload ORDER BY valid_from DESC), 'final_payload_sans_epheme"
707,Process Legal Units - Batch 2,,2241213764000402520,1,108.832666,20000,451,0,0,0,0,136,15721,"CREATE TEMP TABLE existing_segments_with_target ON COMMIT DROP AS                 SELECT                     seg.grouping_key, seg.canonical_nk_json, seg.id, seg.causal_id, seg.is_new_entity, seg.is_identifiable, seg.is_ambiguous, seg.conflicting_ids, seg.stable_identity_columns_are_null, seg.lookup_columns_unavailable, seg.valid_from, seg.valid_until,                     target_row.valid_from as t_valid_from, target_row.valid_until as t_valid_until,                     target_row.data_payload as t_data_payload, target_row.ephemeral_payload as t_ephemeral_payload, seg.stable_pk_payload,                      target_row.stable_pk_payload as target_stable_pk_payload,                     source_payloads.source_row_id, source_payloads.contributing_row_ids,                     source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                     source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until,                     NULL::jsonb as trace                 FROM atomic_segments seg                 LEFT JOIN target_rows target_row                      ON target_row.id = seg.id                      AND daterange(seg.valid_from, seg.valid_until) <@ daterange(target_row.valid_from, target_row.valid_until)                                          LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE source_row.id = seg.id                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_un"
37b,Process Legal Units - Batch 2,,8733302361466077115,1,107.56787499999999,20000,337,0,0,0,0,136,15721,"CREATE TEMP TABLE existing_segments_with_target ON COMMIT DROP AS                 SELECT                     seg.grouping_key, seg.canonical_nk_json, seg.id, seg.causal_id, seg.is_new_entity, seg.is_identifiable, seg.is_ambiguous, seg.conflicting_ids, seg.stable_identity_columns_are_null, seg.lookup_columns_unavailable, seg.valid_from, seg.valid_until,                     target_row.valid_from as t_valid_from, target_row.valid_until as t_valid_until,                     target_row.data_payload as t_data_payload, target_row.ephemeral_payload as t_ephemeral_payload, seg.stable_pk_payload,                      target_row.stable_pk_payload as target_stable_pk_payload,                     source_payloads.source_row_id, source_payloads.contributing_row_ids,                     source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                     source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until,                     NULL::jsonb as trace                 FROM atomic_segments seg                 LEFT JOIN target_rows target_row                      ON target_row.id = seg.id                      AND daterange(seg.valid_from, seg.valid_until) <@ daterange(target_row.valid_from, target_row.valid_until)                                          LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE source_row.id = seg.id                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_un"
b17,Process Legal Units - Batch 2,,7295163325594009324,1,106.296499,10000,95222,0,0,0,0,40135,2703984,"INSERT INTO etl_bench.identity_resolution (identity_correlation, legal_unit_id, resolved_batch)     SELECT DISTINCT          identity_correlation,         legal_unit_id,         p_batch_id     FROM etl_bench.data_table     WHERE batch = p_batch_id AND legal_unit_id IS NOT NULL     ON CONFLICT (identity_correlation) DO UPDATE SET         legal_unit_id = EXCLUDED.legal_unit_id,         resolved_batch = EXCLUDED.resolved_batch"
ecf,Process Legal Units - Batch 2,,-6771234532898534008,1,97.335917,10000,430,0,0,0,0,138,19073,"CREATE TEMP TABLE diff ON COMMIT DROP AS                 SELECT                     final_seg.grouping_key, COALESCE(final_seg.id, target_seg.id) as id, COALESCE(final_seg.causal_id, target_seg.causal_id) as causal_id,                     COALESCE(final_seg.is_new_entity, false) as is_new_entity,                     COALESCE(final_seg.is_identifiable, true) as is_identifiable,                     COALESCE(final_seg.is_ambiguous, false) as is_ambiguous,                     final_seg.conflicting_ids,                     final_seg.canonical_nk_json,                     COALESCE(final_seg.stable_identity_columns_are_null, false) as stable_identity_columns_are_null,                     COALESCE(final_seg.lookup_columns_unavailable, false) as lookup_columns_unavailable,                     final_seg.valid_from AS f_from, final_seg.valid_until AS f_until, final_seg.final_payload AS f_payload, final_seg.row_ids AS f_row_ids, final_seg.stable_pk_payload, final_seg.orig_source_target_relation,                     CASE WHEN 'f'::boolean                         THEN final_seg.trace || jsonb_build_object('cte', 'diff', 'diff_stable_pk', final_seg.stable_pk_payload, 'final_seg_causal_id', final_seg.causal_id, 'final_payload_vs_target_payload', jsonb_build_object('f', final_seg.final_payload, 't', target_seg.data_payload))                         ELSE NULL                     END as trace,                     final_seg.unaffected_target_only_segment,                     target_seg.valid_from as t_from, target_seg.valid_until as t_until, (target_seg.data_payload || target_seg.ephemeral_payload) as t_payload,                     sql_saga.get_allen_relation(target_seg.valid_from, target_seg.valid_until, final_seg.valid_from, final_seg.valid_until) as b_a_relation                 FROM coalesced_final_segments AS final_seg                 FULL OUTER JOIN target_rows AS target_seg ON final_seg.grouping_key = ('existing_entity__' || COALESCE(target_seg.id::text, '_NULL_')) AND final_seg.ancestor_valid_from = target_seg.valid_from"
70f,Process Legal Units - Batch 2,,-3204223827806995791,1,96.683375,10000,339,0,0,0,0,138,19073,"CREATE TEMP TABLE diff ON COMMIT DROP AS                 SELECT                     final_seg.grouping_key, COALESCE(final_seg.id, target_seg.id) as id, COALESCE(final_seg.causal_id, target_seg.causal_id) as causal_id,                     COALESCE(final_seg.is_new_entity, false) as is_new_entity,                     COALESCE(final_seg.is_identifiable, true) as is_identifiable,                     COALESCE(final_seg.is_ambiguous, false) as is_ambiguous,                     final_seg.conflicting_ids,                     final_seg.canonical_nk_json,                     COALESCE(final_seg.stable_identity_columns_are_null, false) as stable_identity_columns_are_null,                     COALESCE(final_seg.lookup_columns_unavailable, false) as lookup_columns_unavailable,                     final_seg.valid_from AS f_from, final_seg.valid_until AS f_until, final_seg.final_payload AS f_payload, final_seg.row_ids AS f_row_ids, final_seg.stable_pk_payload, final_seg.orig_source_target_relation,                     CASE WHEN 'f'::boolean                         THEN final_seg.trace || jsonb_build_object('cte', 'diff', 'diff_stable_pk', final_seg.stable_pk_payload, 'final_seg_causal_id', final_seg.causal_id, 'final_payload_vs_target_payload', jsonb_build_object('f', final_seg.final_payload, 't', target_seg.data_payload))                         ELSE NULL                     END as trace,                     final_seg.unaffected_target_only_segment,                     target_seg.valid_from as t_from, target_seg.valid_until as t_until, (target_seg.data_payload || target_seg.ephemeral_payload) as t_payload,                     sql_saga.get_allen_relation(target_seg.valid_from, target_seg.valid_until, final_seg.valid_from, final_seg.valid_until) as b_a_relation                 FROM coalesced_final_segments AS final_seg                 FULL OUTER JOIN target_rows AS target_seg ON final_seg.grouping_key = ('existing_entity__' || COALESCE(target_seg.id::text, '_NULL_')) AND final_seg.ancestor_valid_from = target_seg.valid_from"
b14,Process Legal Units - Batch 2,,5432145740772416088,1,85.724625,0,214,0,0,0,0,48,11420,ANALYZE active_source_rows
c19,Process Legal Units - Batch 2,,0,5,73.379541,0,1207,0,0,0,0,349,48433,CALL sql_saga.benchmark_reset()
505,Process Legal Units - Batch 2,,-518691661278450688,1,70.339041,0,183,0,0,0,0,40,9072,ANALYZE source_rows_with_nk_json
4ca,Process Legal Units - Batch 2,,4494928315034638917,1,69.832916,20000,467,0,771,772,0,152,17570,"CREATE TEMP TABLE island_group ON COMMIT DROP AS                 SELECT                     *,                     SUM(is_island_start) OVER (PARTITION BY grouping_key ORDER BY valid_from) as island_group_id                 FROM (                     SELECT                         *,                         CASE                             WHEN prev_valid_until IS NULL                             OR prev_valid_until <> valid_from                             OR (prev_data_hash IS DISTINCT FROM data_hash)                             THEN 1                             ELSE 0                         END as is_island_start                     FROM (                         SELECT                             *,                             LAG(valid_until) OVER w as prev_valid_until,                             LAG(data_hash) OVER w as prev_data_hash,                             LAG(data_payload) OVER w as prev_data_payload                         FROM resolved_atomic_segments ras                         WHERE ras.data_payload IS NOT NULL                         WINDOW w AS (PARTITION BY grouping_key ORDER BY valid_from)                     ) s1                 ) s2"
793,Process Legal Units - Batch 2,,5509065722832958482,1,69.142583,20000,463,0,0,0,0,142,16268,"CREATE TEMP TABLE resolved_atomic_segments ON COMMIT DROP AS                 SELECT                     grouping_key, id,  stable_identity_columns_are_null, lookup_columns_unavailable, is_new_entity, is_identifiable, is_ambiguous, conflicting_ids, unified_canonical_nk_json,                     valid_from, valid_until, t_valid_from, t_valid_until, propagated_s_valid_from, propagated_s_valid_until, causal_source_row_ids, causal_id, propagated_stable_pk_payload as stable_pk_payload,                     causal_source_row_ids IS NULL AS unaffected_target_only_segment,                     s_data_payload, t_data_payload,                     sql_saga.get_allen_relation(propagated_s_valid_from, propagated_s_valid_until, t_valid_from, t_valid_until) AS orig_source_target_relation,                     COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb) as data_payload,                     md5((jsonb_strip_nulls(COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb)))::text) as data_hash,                     CASE                          WHEN s_data_payload IS NULL THEN t_ephemeral_payload                         ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb)                     END as ephemeral_payload,                     CASE WHEN 'f'::boolean                         THEN trace || jsonb_build_object( 'cte', 'ras', 'segment_stable_pk', propagated_stable_pk_payload, 'final_data_payload', COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb), 'final_ephemeral_payload', CASE WHEN s_data_payload IS NULL THEN t_ephemeral_payload ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb) END )                         ELSE NULL                     END as trace                 FROM resolved_atomic_segments_with_propagated_ids"
d1c,Process Legal Units - Batch 2,,-2930989428870476669,1,68.489042,20000,350,0,0,0,0,142,16268,"CREATE TEMP TABLE resolved_atomic_segments ON COMMIT DROP AS                 SELECT                     grouping_key, id,  stable_identity_columns_are_null, lookup_columns_unavailable, is_new_entity, is_identifiable, is_ambiguous, conflicting_ids, unified_canonical_nk_json,                     valid_from, valid_until, t_valid_from, t_valid_until, propagated_s_valid_from, propagated_s_valid_until, causal_source_row_ids, causal_id, propagated_stable_pk_payload as stable_pk_payload,                     causal_source_row_ids IS NULL AS unaffected_target_only_segment,                     s_data_payload, t_data_payload,                     sql_saga.get_allen_relation(propagated_s_valid_from, propagated_s_valid_until, t_valid_from, t_valid_until) AS orig_source_target_relation,                     COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb) as data_payload,                     md5((jsonb_strip_nulls(COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb)))::text) as data_hash,                     CASE                          WHEN s_data_payload IS NULL THEN t_ephemeral_payload                         ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb)                     END as ephemeral_payload,                     CASE WHEN 'f'::boolean                         THEN trace || jsonb_build_object( 'cte', 'ras', 'segment_stable_pk', propagated_stable_pk_payload, 'final_data_payload', COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb), 'final_ephemeral_payload', CASE WHEN s_data_payload IS NULL THEN t_ephemeral_payload ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb) END )                         ELSE NULL                     END as trace                 FROM resolved_atomic_segments_with_propagated_ids"
d4e,Process Legal Units - Batch 2,,-2675794321567617346,1,68.218,20000,366,0,771,772,0,152,17570,"CREATE TEMP TABLE island_group ON COMMIT DROP AS                 SELECT                     *,                     SUM(is_island_start) OVER (PARTITION BY grouping_key ORDER BY valid_from) as island_group_id                 FROM (                     SELECT                         *,                         CASE                             WHEN prev_valid_until IS NULL                             OR prev_valid_until <> valid_from                             OR (prev_data_hash IS DISTINCT FROM data_hash)                             THEN 1                             ELSE 0                         END as is_island_start                     FROM (                         SELECT                             *,                             LAG(valid_until) OVER w as prev_valid_until,                             LAG(data_hash) OVER w as prev_data_hash,                             LAG(data_payload) OVER w as prev_data_payload                         FROM resolved_atomic_segments ras                         WHERE ras.data_payload IS NOT NULL                         WINDOW w AS (PARTITION BY grouping_key ORDER BY valid_from)                     ) s1                 ) s2"
fd8,Process Legal Units - Batch 2,,1965474688105448427,1,61.719583,10000,5037,0,0,0,0,112,12503,"CREATE TEMP TABLE source_initial ON COMMIT DROP AS                 WITH source_data AS (                     SELECT                         source_table.row_id /* row_id_column */ as source_row_id,                         COALESCE(source_table.founding_id, source_table.row_id::integer) /* v_causal_select_expr */ as causal_id,                         source_table.id,  -- v_non_temporal_lookup_cols_select_list_prefix                         source_table.valid_from as valid_from, source_table.valid_until as valid_until, /* v_source_temporal_cols_expr */                         jsonb_strip_nulls(jsonb_build_object('name', source_table.name)) /* v_source_data_payload_expr */ AS data_payload,                         jsonb_strip_nulls(jsonb_build_object('comment', source_table.comment)) /* v_source_ephemeral_payload_expr */ AS ephemeral_payload,                         jsonb_build_object('id', source_table.id) /* v_stable_pk_cols_jsonb_build_source */ as stable_pk_payload,                         source_table.id IS NULL /* v_entity_id_check_is_null_expr */ as stable_identity_columns_are_null,                         (true) /* v_lookup_cols_are_null_expr */ as lookup_columns_unavailable,                         true /* v_is_identifiable_expr */ as is_identifiable,                         true /* v_consistency_check_expr */ as temporal_columns_are_consistent                     FROM source_view_lu /* v_source_table_ident */ source_table                 )                 SELECT                      *,                     -- OPTIMIZATION: Pre-compute range column to avoid repeated daterange() calls                     -- This provides ~10-15% performance improvement in eclipse detection                     daterange(valid_from, valid_until) as valid_range                 FROM source_data"
622,Process Legal Units - Batch 2,,2115514670139824758,1,61.236917000000005,10000,4994,0,0,0,0,112,12503,"CREATE TEMP TABLE source_initial ON COMMIT DROP AS                 WITH source_data AS (                     SELECT                         source_table.row_id /* row_id_column */ as source_row_id,                         COALESCE(source_table.founding_id, source_table.row_id::integer) /* v_causal_select_expr */ as causal_id,                         source_table.id,  -- v_non_temporal_lookup_cols_select_list_prefix                         source_table.valid_from as valid_from, source_table.valid_until as valid_until, /* v_source_temporal_cols_expr */                         jsonb_strip_nulls(jsonb_build_object('name', source_table.name)) /* v_source_data_payload_expr */ AS data_payload,                         jsonb_strip_nulls(jsonb_build_object('comment', source_table.comment)) /* v_source_ephemeral_payload_expr */ AS ephemeral_payload,                         jsonb_build_object('id', source_table.id) /* v_stable_pk_cols_jsonb_build_source */ as stable_pk_payload,                         source_table.id IS NULL /* v_entity_id_check_is_null_expr */ as stable_identity_columns_are_null,                         (true) /* v_lookup_cols_are_null_expr */ as lookup_columns_unavailable,                         true /* v_is_identifiable_expr */ as is_identifiable,                         true /* v_consistency_check_expr */ as temporal_columns_are_consistent                     FROM source_view_lu /* v_source_table_ident */ source_table                 )                 SELECT                      *,                     -- OPTIMIZATION: Pre-compute range column to avoid repeated daterange() calls                     -- This provides ~10-15% performance improvement in eclipse detection                     daterange(valid_from, valid_until) as valid_range                 FROM source_data;"
096,Process Legal Units - Batch 2,,-5024370260775748889,1,59.719167,10000,384,0,0,0,0,117,13791,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT * FROM (                     -- Path 1: Existing Entities (Window Function on Lookup Keys)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE NOT s1.lookup_columns_unavailable                      UNION ALL                      -- Path 2: New Entities (Window Function on Causal ID)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY causal_id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY causal_id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE s1.lookup_columns_unavailable                 ) t"
6f8,Process Legal Units - Batch 2,,1525269309137858814,1,59.19175,0,126,0,0,0,0,26,9453,ANALYZE atomic_segments
e73,Process Legal Units - Batch 2,,3167307580342175303,1,58.538542,10000,300,0,0,0,0,117,13791,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT * FROM (                     -- Path 1: Existing Entities (Window Function on Lookup Keys)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE NOT s1.lookup_columns_unavailable                      UNION ALL                      -- Path 2: New Entities (Window Function on Causal ID)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY causal_id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY causal_id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE s1.lookup_columns_unavailable                 ) t;"
631,Process Legal Units - Batch 2,,5039860120774769872,1,57.370333,0,128,0,0,0,0,26,7165,ANALYZE source_initial
abb,Process Legal Units - Batch 2,,2568094112886783045,1,50.126125,10000,0,0,0,0,0,0,0,"WITH RECURSIVE ordered_plan AS (                     SELECT                         row_number() OVER ( ORDER BY p.grouping_key, p.id, CASE p.operation WHEN 'DELETE' THEN 1 WHEN 'UPDATE' THEN 2 WHEN 'INSERT' THEN 3 ELSE 4 END, p.update_effect NULLS FIRST, CASE WHEN p.update_effect = 'MOVE' THEN 1 ELSE 0 END, CASE WHEN p.update_effect = 'MOVE' THEN COALESCE(p.old_valid_from, p.new_valid_from) END DESC NULLS LAST, COALESCE(p.old_valid_from, p.new_valid_from), (p.row_ids[1]) )::BIGINT as plan_op_seq,                         p.*                     FROM plan p                 ),                 -- For MOVE operations, group into the largest possible batches that can execute together.                 -- Within a single UPDATE statement, all rows see the pre-update state (MVCC snapshot).                 -- So if MOVE A's new_range overlaps MOVE B's old_range, they cannot be in the same statement.                 --                 -- Algorithm: Process MOVEs in plan_op_seq order (which is old_valid_from DESC).                 -- Track a multirange of old_ranges in the current batch. For each MOVE:                 -- - If new_range overlaps the batch's multirange, start a new batch                 -- - Add this MOVE's old_range to the batch's multirange                 --                 -- We use a recursive CTE to accumulate the multirange with reset-on-conflict logic.                 moves_ordered AS (                     SELECT                         o.plan_op_seq,                         o.grouping_key,                         o.old_valid_from,                         o.old_valid_until,                         o.new_valid_from,                         o.new_valid_until,                         row_number() OVER (PARTITION BY o.grouping_key ORDER BY o.plan_op_seq) AS move_seq                     FROM ordered_plan o                     WHERE o.operation = 'UPDATE' AND o.update_effect = 'MOVE'                 ),                 moves_with_batch AS (                     -- Base case: first MOVE in each entity starts b"
833,Process Legal Units - Batch 2,,1428552154429020267,1,39.973125,30000,358,0,498,499,0,110,12251,"CREATE TEMP TABLE time_points ON COMMIT DROP AS                 SELECT DISTINCT ON (grouping_key, point) *                 FROM time_points_with_unified_ids                 ORDER BY grouping_key, point, causal_id DESC NULLS LAST"
972,Process Legal Units - Batch 2,,-957741634502868070,1,39.204083,10000,404,0,0,0,0,128,15483,"CREATE TEMP TABLE source_rows_with_nk_json ON COMMIT DROP AS                 SELECT source_row.*, jsonb_strip_nulls(jsonb_build_object()) /* v_lookup_keys_as_jsonb_expr */ as nk_json, ARRAY(SELECT e FROM unnest(ARRAY[]::TEXT[]) e WHERE e IS NOT NULL ORDER BY e) /* v_lookup_keys_as_array_expr */ as nk_non_null_keys_array                 FROM source_rows_with_new_flag source_row"
81c,Process Legal Units - Batch 2,,7625827313856663095,1,38.797792,10000,321,0,0,0,0,128,15483,"CREATE TEMP TABLE source_rows_with_nk_json ON COMMIT DROP AS                 SELECT source_row.*, jsonb_strip_nulls(jsonb_build_object()) /* v_lookup_keys_as_jsonb_expr */ as nk_json, ARRAY(SELECT e FROM unnest(ARRAY[]::TEXT[]) e WHERE e IS NOT NULL ORDER BY e) /* v_lookup_keys_as_array_expr */ as nk_non_null_keys_array                 FROM source_rows_with_new_flag source_row"
ce7,Process Legal Units - Batch 2,,6254436778457358929,1,38.586624,30000,285,0,498,499,0,110,12251,"CREATE TEMP TABLE time_points ON COMMIT DROP AS                 SELECT DISTINCT ON (grouping_key, point) *                 FROM time_points_with_unified_ids                 ORDER BY grouping_key, point, causal_id DESC NULLS LAST"
3e3,Process Legal Units - Batch 2,,0,1,35.61,0,6328,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
068,Process Legal Units - Batch 2,,-6189425232530816533,1,35.020292,10000,434,0,0,0,0,102,11171,"CREATE TEMP TABLE target_rows ON COMMIT DROP AS                 SELECT                     id,  /* v_non_temporal_lookup_cols_select_list_no_alias_prefix */ -- (non-temporal identity columns)                     lower(t.valid_range) as valid_from, -- The temporal identity column (e.g., valid_from)                     NULL::integer /* v_causal_column_type */ as causal_id, -- Target rows do not originate from a source row, so causal_id is NULL. Type is introspected.                     jsonb_build_object('id', id) /* v_stable_pk_cols_jsonb_build_bare */ as stable_pk_payload,                     upper(t.valid_range) as valid_until,                     jsonb_build_object('name', name) /* v_target_data_cols_jsonb_build_bare */ AS data_payload,                     jsonb_build_object('comment', comment) /* v_target_ephemeral_cols_jsonb_build_bare */ AS ephemeral_payload,                     jsonb_strip_nulls(jsonb_build_object()) /* v_target_nk_json_expr */ AS canonical_nk_json                 FROM (                         SELECT * FROM (                             SELECT DISTINCT ON (u.id, u.valid_from) * FROM (                                 (                                     SELECT * FROM etl_bench.legal_unit inner_t                                     WHERE (inner_t.id) IN (SELECT DISTINCT si.id FROM source_initial si WHERE (si.id) IS NOT NULL)                                 )                             ) u                         )                     ) AS t  /* v_target_rows_filter */"
b4e,Process Legal Units - Batch 2,,-4193415169867768194,1,34.457207,10000,391,0,0,0,0,102,11171,"CREATE TEMP TABLE target_rows ON COMMIT DROP AS                 SELECT                     id,  /* v_non_temporal_lookup_cols_select_list_no_alias_prefix */ -- (non-temporal identity columns)                     lower(t.valid_range) as valid_from, -- The temporal identity column (e.g., valid_from)                     NULL::integer /* v_causal_column_type */ as causal_id, -- Target rows do not originate from a source row, so causal_id is NULL. Type is introspected.                     jsonb_build_object('id', id) /* v_stable_pk_cols_jsonb_build_bare */ as stable_pk_payload,                     upper(t.valid_range) as valid_until,                     jsonb_build_object('name', name) /* v_target_data_cols_jsonb_build_bare */ AS data_payload,                     jsonb_build_object('comment', comment) /* v_target_ephemeral_cols_jsonb_build_bare */ AS ephemeral_payload,                     jsonb_strip_nulls(jsonb_build_object()) /* v_target_nk_json_expr */ AS canonical_nk_json                 FROM (                         SELECT * FROM (                             SELECT DISTINCT ON (u.id, u.valid_from) * FROM (                                 (                                     SELECT * FROM etl_bench.legal_unit inner_t                                     WHERE (inner_t.id) IN (SELECT DISTINCT si.id FROM source_initial si WHERE (si.id) IS NOT NULL)                                 )                             ) u                         )                     ) AS t  /* v_target_rows_filter */"
49e,Process Legal Units - Batch 2,,-1407412071598267173,1,28.587417000000002,10000,4703,0,0,0,0,0,0,"WITH             all_source_rows AS (                 SELECT t.row_id AS source_row_id FROM source_view_lu t             ),             plan_unnested AS (                 SELECT unnest(p.row_ids) as source_row_id, p.plan_op_seq, p.entity_keys, p.operation, p.data, p.feedback                 FROM temporal_merge_plan p             ),             feedback_groups AS (                 SELECT                     asr.source_row_id,                     -- Aggregate all distinct operations for this source row.                     array_agg(DISTINCT pu.operation) FILTER (WHERE pu.operation IS NOT NULL) as operations,                     -- Aggregate all distinct entity IDs this source row touched.                     COALESCE(jsonb_agg(DISTINCT pu.entity_keys) FILTER (WHERE pu.entity_keys IS NOT NULL), '[]'::jsonb) AS target_entity_keys,                     -- Extract the specific error message from the plan's feedback payload if present.                     (array_agg(pu.feedback->>'error') FILTER (WHERE pu.operation = 'ERROR' AND pu.feedback ? 'error'))[1] as error_message_from_plan                 FROM all_source_rows asr                 LEFT JOIN plan_unnested pu ON asr.source_row_id = pu.source_row_id                 GROUP BY asr.source_row_id             )             INSERT INTO temporal_merge_feedback                 SELECT                     fg.source_row_id,                     fg.target_entity_keys,                     CASE                         -- This CASE statement must be ordered from most to least specific to correctly classify outcomes.                         -- This CASE statement directly translates the plan's actions into a final feedback status.                         -- It is ordered from most to least specific to ensure correctness.                         WHEN 'ERROR'::sql_saga.temporal_merge_plan_action = ANY(fg.operations) THEN 'ERROR'                         WHEN 'INSERT'::sql_saga.temporal_merge_plan_action = ANY(fg.operations)                           OR 'UPDATE'::sql_saga.temporal_merge_"
dfc,Process Legal Units - Batch 2,,6779487562696088383,1,27.324667,20000,369,0,0,0,0,113,12567,"CREATE TEMP TABLE atomic_segments ON COMMIT DROP AS                 SELECT grouping_key, id, causal_id, point as valid_from, next_point as valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json                 FROM (                     SELECT *, LEAD(point) OVER (PARTITION BY grouping_key ORDER BY point) as next_point                     FROM time_points                 ) with_lead                 WHERE point IS NOT NULL AND next_point IS NOT NULL AND point < next_point"
cd3,Process Legal Units - Batch 2,,1300200293165651031,1,27.179,10000,430,0,0,0,0,134,18260,"CREATE TEMP TABLE plan_with_op ON COMMIT DROP AS                 (                     SELECT * FROM (                         SELECT                             d.f_row_ids as row_ids, d.orig_source_target_relation, d.is_new_entity,                             CASE                                 WHEN d.is_ambiguous THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.is_new_entity AND NOT d.is_identifiable THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.t_from IS NULL THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.f_from IS NULL THEN 'DELETE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank = 1 THEN 'UPDATE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank > 1 THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank IS NULL THEN                                     CASE                                         WHEN d.unaffected_target_only_segment THEN NULL                                         ELSE 'SKIP_IDENTICAL'::sql_saga.temporal_merge_plan_action                                     END                                 ELSE 'ERROR'::sql_saga.temporal_merge_plan_action                             END as operation,                             id,                             CASE                                 WHEN d.is_new_entity AND d.canonical_nk_json IS NOT NULL                                 THEN d.canonical_nk_json || COALESCE(d.stable_pk_payload, '{}'::jsonb)                                 ELSE jsonb_build_object('id', d.id) || COALESCE(d.stable_pk_payload, '{}'::jsonb)                             END as entity_keys_json,                             jsonb_build_object('id', d.id) as identity_keys,                             jsonb_build_object() as lookup_keys,                             d.causal_id, d.t_from as old_valid_from, d.t_until as old_valid_until, d.f"
6bc,Process Legal Units - Batch 2,,-7375841108639655790,1,26.855207999999998,20000,295,0,0,0,0,113,12567,"CREATE TEMP TABLE atomic_segments ON COMMIT DROP AS                 SELECT grouping_key, id, causal_id, point as valid_from, next_point as valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json                 FROM (                     SELECT *, LEAD(point) OVER (PARTITION BY grouping_key ORDER BY point) as next_point                     FROM time_points                 ) with_lead                 WHERE point IS NOT NULL AND next_point IS NOT NULL AND point < next_point"
024,Process Legal Units - Batch 2,,2006172193490038593,1,25.803165999999997,10000,331,0,0,0,0,134,18260,"CREATE TEMP TABLE plan_with_op ON COMMIT DROP AS                 (                     SELECT * FROM (                         SELECT                             d.f_row_ids as row_ids, d.orig_source_target_relation, d.is_new_entity,                             CASE                                 WHEN d.is_ambiguous THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.is_new_entity AND NOT d.is_identifiable THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.t_from IS NULL THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.f_from IS NULL THEN 'DELETE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank = 1 THEN 'UPDATE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank > 1 THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank IS NULL THEN                                     CASE                                         WHEN d.unaffected_target_only_segment THEN NULL                                         ELSE 'SKIP_IDENTICAL'::sql_saga.temporal_merge_plan_action                                     END                                 ELSE 'ERROR'::sql_saga.temporal_merge_plan_action                             END as operation,                             id,                             CASE                                 WHEN d.is_new_entity AND d.canonical_nk_json IS NOT NULL                                 THEN d.canonical_nk_json || COALESCE(d.stable_pk_payload, '{}'::jsonb)                                 ELSE jsonb_build_object('id', d.id) || COALESCE(d.stable_pk_payload, '{}'::jsonb)                             END as entity_keys_json,                             jsonb_build_object('id', d.id) as identity_keys,                             jsonb_build_object() as lookup_keys,                             d.causal_id, d.t_from as old_valid_from, d.t_until as old_valid_until, d.f"
dcd,Process Legal Units - Batch 2,,5147944785677299242,1,25.481541,10000,435,0,0,0,0,139,16559,"CREATE TEMP TABLE diff_ranked ON COMMIT DROP AS                 SELECT                     d.*,                     CASE                         WHEN d.t_from IS NULL OR d.f_from IS NULL THEN NULL                         WHEN d.f_from = d.t_from AND d.f_until = d.t_until AND d.f_payload IS NOT DISTINCT FROM d.t_payload THEN NULL                         ELSE                             row_number() OVER (                                 PARTITION BY d.grouping_key, d.t_from                                 ORDER BY                                     CASE WHEN d.f_from = d.t_from THEN 1 ELSE 2 END,                                     CASE WHEN d.f_payload - '{comment}'::text[] IS NOT DISTINCT FROM d.t_payload - '{comment}'::text[] THEN 1 ELSE 2 END,                                     d.f_from,                                     d.f_until                             )                     END as update_rank                 FROM diff d"
168,Process Legal Units - Batch 2,,6259880232974284115,1,24.97325,10000,340,0,0,0,0,139,16559,"CREATE TEMP TABLE diff_ranked ON COMMIT DROP AS                 SELECT                     d.*,                     CASE                         WHEN d.t_from IS NULL OR d.f_from IS NULL THEN NULL                         WHEN d.f_from = d.t_from AND d.f_until = d.t_until AND d.f_payload IS NOT DISTINCT FROM d.t_payload THEN NULL                         ELSE                             row_number() OVER (                                 PARTITION BY d.grouping_key, d.t_from                                 ORDER BY                                     CASE WHEN d.f_from = d.t_from THEN 1 ELSE 2 END,                                     CASE WHEN d.f_payload - '{comment}'::text[] IS NOT DISTINCT FROM d.t_payload - '{comment}'::text[] THEN 1 ELSE 2 END,                                     d.f_from,                                     d.f_until                             )                     END as update_rank                 FROM diff d"
b01,Process Legal Units - Batch 2,,2346888588666524139,1,24.489708,40000,376,0,0,0,0,113,12457,"CREATE TEMP TABLE time_points_raw ON COMMIT DROP AS                 SELECT id, causal_id, valid_from AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows                 UNION ALL                 SELECT id, causal_id, valid_until AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows"
fce,Process Legal Units - Batch 2,,5849653773365333279,1,24.166625,10000,411,0,0,0,0,126,14121,"CREATE TEMP TABLE source_rows_with_matches ON COMMIT DROP AS                 SELECT                     source_row.*,                     target_row.stable_pk_payload as discovered_stable_pk_payload,                     target_row.id AS discovered_id_1 /* v_propagated_id_cols_list */                 FROM source_with_eclipsed_flag source_row                 LEFT JOIN target_rows target_row ON (source_row.id = target_row.id /* v_source_rows_exists_join_expr */)"
e5d,Process Legal Units - Batch 2,,3254511572182529394,1,23.962416,40000,303,0,0,0,0,113,12457,"CREATE TEMP TABLE time_points_raw ON COMMIT DROP AS                 SELECT id, causal_id, valid_from AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows                 UNION ALL                 SELECT id, causal_id, valid_until AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows"
759,Process Legal Units - Batch 2,,1995507501247956172,1,23.414,10000,322,0,0,0,0,125,14059,"CREATE TEMP TABLE source_rows_with_matches ON COMMIT DROP AS                 SELECT                     source_row.*,                     target_row.stable_pk_payload as discovered_stable_pk_payload,                     target_row.id AS discovered_id_1 /* v_propagated_id_cols_list */                 FROM source_with_eclipsed_flag source_row                 LEFT JOIN target_rows target_row ON (source_row.id = target_row.id /* v_source_rows_exists_join_expr */)"
f61,Process Legal Units - Batch 2,,-2522301903109079185,1,22.923958,40000,371,0,0,0,0,112,14149,"CREATE TEMP TABLE time_points_with_unified_ids ON COMMIT DROP AS                 SELECT                     tpu.grouping_key,                     tpu.id,                     tpu.unified_causal_id as causal_id,                     tpu.point,                     tpu.is_new_entity,                     tpu.unified_stable_pk_payload as stable_pk_payload,                     tpu.stable_identity_columns_are_null,                     tpu.lookup_columns_unavailable,                     tpu.is_identifiable,                     tpu.is_ambiguous,                     tpu.conflicting_ids,                     tpu.unified_canonical_nk_json as canonical_nk_json                 FROM time_points_unified tpu"
2bb,Process Legal Units - Batch 2,,-6217490005536178219,1,22.701375,20000,531,0,0,0,0,142,17037,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     seg.*,                     seg.stable_pk_payload as propagated_stable_pk_payload                 FROM all_segments seg                 WHERE (seg.s_data_payload IS NOT NULL OR seg.t_data_payload IS NOT NULL)                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'PATCH_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'REPLACE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'DELETE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'UPDATE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     ELSE true                 END"
88b,Process Legal Units - Batch 2,,-2381107599654639950,1,22.506791000000003,40000,292,0,0,0,0,112,14149,"CREATE TEMP TABLE time_points_with_unified_ids ON COMMIT DROP AS                 SELECT                     tpu.grouping_key,                     tpu.id,                     tpu.unified_causal_id as causal_id,                     tpu.point,                     tpu.is_new_entity,                     tpu.unified_stable_pk_payload as stable_pk_payload,                     tpu.stable_identity_columns_are_null,                     tpu.lookup_columns_unavailable,                     tpu.is_identifiable,                     tpu.is_ambiguous,                     tpu.conflicting_ids,                     tpu.unified_canonical_nk_json as canonical_nk_json                 FROM time_points_unified tpu"
611,Process Legal Units - Batch 2,,3662944893103168594,1,22.09875,20000,347,0,0,0,0,141,16897,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     seg.*,                     seg.stable_pk_payload as propagated_stable_pk_payload                 FROM all_segments seg                 WHERE (seg.s_data_payload IS NOT NULL OR seg.t_data_payload IS NOT NULL)                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'PATCH_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'REPLACE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'DELETE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'UPDATE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     ELSE true                 END"
51e,Process Legal Units - Batch 2,,8021558608045147396,1,21.028917,10000,431,0,0,0,0,138,15033,"CREATE TEMP TABLE plan ON COMMIT DROP AS                 SELECT                     p.row_ids, p.operation, p.causal_id, p.is_new_entity,                     p.id,                     p.entity_keys_json as entity_keys,                     p.identity_keys, p.lookup_keys,                     p.orig_source_target_relation, p.b_a_relation, p.old_valid_from, p.old_valid_until,                     p.new_valid_from, p.new_valid_until, p.data, p.feedback, p.trace,                     p.grouping_key,                     CASE                         WHEN p.operation <> 'UPDATE' THEN NULL::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from = p.old_valid_from AND p.new_valid_until = p.old_valid_until THEN 'NONE'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from <= p.old_valid_from AND p.new_valid_until >= p.old_valid_until THEN 'GROW'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from >= p.old_valid_from AND p.new_valid_until <= p.old_valid_until THEN 'SHRINK'::sql_saga.temporal_merge_update_effect                         ELSE 'MOVE'::sql_saga.temporal_merge_update_effect                     END AS update_effect                 FROM plan_with_op p                 LEFT JOIN source_rows_with_new_flag source_row ON source_row.source_row_id = p.row_ids[1]"
595,Process Legal Units - Batch 2,,8010399271587590855,1,20.412625,10000,337,0,0,0,0,138,15033,"CREATE TEMP TABLE plan ON COMMIT DROP AS                 SELECT                     p.row_ids, p.operation, p.causal_id, p.is_new_entity,                     p.id,                     p.entity_keys_json as entity_keys,                     p.identity_keys, p.lookup_keys,                     p.orig_source_target_relation, p.b_a_relation, p.old_valid_from, p.old_valid_until,                     p.new_valid_from, p.new_valid_until, p.data, p.feedback, p.trace,                     p.grouping_key,                     CASE                         WHEN p.operation <> 'UPDATE' THEN NULL::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from = p.old_valid_from AND p.new_valid_until = p.old_valid_until THEN 'NONE'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from <= p.old_valid_from AND p.new_valid_until >= p.old_valid_until THEN 'GROW'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from >= p.old_valid_from AND p.new_valid_until <= p.old_valid_until THEN 'SHRINK'::sql_saga.temporal_merge_update_effect                         ELSE 'MOVE'::sql_saga.temporal_merge_update_effect                     END AS update_effect                 FROM plan_with_op p                 LEFT JOIN source_rows_with_new_flag source_row ON source_row.source_row_id = p.row_ids[1]"
bdf,Process Legal Units - Batch 2,,2613701250391606255,1,16.232916,10000,375,0,0,0,0,127,14425,"CREATE TEMP TABLE source_rows_with_discovery ON COMMIT DROP AS                 SELECT                     m.*,                     a.match_count,                     a.conflicting_ids,                     (a.match_count > 1) as is_ambiguous                 FROM source_rows_with_matches m                 JOIN source_rows_with_aggregates a ON m.source_row_id = a.source_row_id"
6fd,Process Legal Units - Batch 2,,8473430400440557908,1,15.779708,10000,320,0,0,0,0,127,14425,"CREATE TEMP TABLE source_rows_with_discovery ON COMMIT DROP AS                 SELECT                     m.*,                     a.match_count,                     a.conflicting_ids,                     (a.match_count > 1) as is_ambiguous                 FROM source_rows_with_matches m                 JOIN source_rows_with_aggregates a ON m.source_row_id = a.source_row_id"
d08,Process Legal Units - Batch 2,,-1318097777820228,1,13.400333,10000,392,0,0,0,0,120,13561,"CREATE TEMP TABLE source_rows ON COMMIT DROP AS                 SELECT DISTINCT ON (p.source_row_id)                     p.source_row_id, p.causal_id, p.valid_from, p.valid_until, p.data_payload, p.ephemeral_payload,                     (p.stable_identity_columns_are_null AND p.discovered_stable_pk_payload IS NULL) as stable_identity_columns_are_null,                     p.lookup_columns_unavailable, p.is_identifiable,                     p.is_ambiguous, p.conflicting_ids, p.is_eclipsed, p.eclipsed_by,                     p.temporal_columns_are_consistent,                     COALESCE(p.stable_pk_payload, p.discovered_stable_pk_payload) as stable_pk_payload,                     (p.discovered_stable_pk_payload IS NOT NULL) /* v_target_entity_exists_expr */ as target_entity_exists,                     COALESCE(p.id, p.discovered_id_1) AS id /* v_coalesced_id_cols_list */                 FROM source_rows_with_discovery p                 ORDER BY p.source_row_id, p.discovered_stable_pk_payload"
14b,Process Legal Units - Batch 2,,2284106485190769639,1,12.955166,10000,305,0,0,0,0,120,13561,"CREATE TEMP TABLE source_rows ON COMMIT DROP AS                 SELECT DISTINCT ON (p.source_row_id)                     p.source_row_id, p.causal_id, p.valid_from, p.valid_until, p.data_payload, p.ephemeral_payload,                     (p.stable_identity_columns_are_null AND p.discovered_stable_pk_payload IS NULL) as stable_identity_columns_are_null,                     p.lookup_columns_unavailable, p.is_identifiable,                     p.is_ambiguous, p.conflicting_ids, p.is_eclipsed, p.eclipsed_by,                     p.temporal_columns_are_consistent,                     COALESCE(p.stable_pk_payload, p.discovered_stable_pk_payload) as stable_pk_payload,                     (p.discovered_stable_pk_payload IS NOT NULL) /* v_target_entity_exists_expr */ as target_entity_exists,                     COALESCE(p.id, p.discovered_id_1) AS id /* v_coalesced_id_cols_list */                 FROM source_rows_with_discovery p                 ORDER BY p.source_row_id, p.discovered_stable_pk_payload"
72b,Process Legal Units - Batch 2,,-3169870935594387745,1,12.390126,0,5216,0,0,0,0,0,0,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
c5b,Process Legal Units - Batch 2,,5494611821061557908,1,12.239667,20000,380,0,0,0,0,110,12235,"CREATE TEMP TABLE all_rows ON COMMIT DROP AS                 SELECT id,  /* v_non_temporal_lookup_cols_select_list_no_alias_prefix */ causal_id, valid_from, valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM active_source_rows                 UNION ALL                 SELECT                     target_row.id,  /* v_non_temporal_tr_qualified_lookup_cols_prefix */                     target_row.causal_id,                     target_row.valid_from,                     target_row.valid_until,                     false as is_new_entity,                     target_row.stable_pk_payload,                     false as stable_identity_columns_are_null,                     false as lookup_columns_unavailable,                     true as is_identifiable,                     false as is_ambiguous,                     NULL::jsonb as conflicting_ids,                     target_row.canonical_nk_json                 FROM target_rows target_row"
2a1,Process Legal Units - Batch 2,,-9206132846856941068,1,12.194125,10000,427,0,0,0,0,134,19109,CREATE TEMP TABLE active_source_rows ON COMMIT DROP AS                 SELECT source_row.*                 FROM source_rows_with_early_feedback source_row                 WHERE source_row.early_feedback IS NULL                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'MERGE_ENTITY_PATCH' THEN true                     WHEN 'MERGE_ENTITY_REPLACE' THEN true                     WHEN 'MERGE_ENTITY_UPSERT' THEN true                     WHEN 'INSERT_NEW_ENTITIES' THEN NOT source_row.target_entity_exists                     WHEN 'PATCH_FOR_PORTION_OF' THEN source_row.target_entity_exists                     WHEN 'REPLACE_FOR_PORTION_OF' THEN source_row.target_entity_exists                     WHEN 'DELETE_FOR_PORTION_OF' THEN source_row.target_entity_exists                     WHEN 'UPDATE_FOR_PORTION_OF' THEN source_row.target_entity_exists                     ELSE false                 END
91b,Process Legal Units - Batch 2,,8689595743856886431,1,11.77575,0,134,0,0,0,0,15,1597,CREATE INDEX ON active_source_rows (grouping_key)
e00,Process Legal Units - Batch 2,,311967624403052027,1,11.733875,10000,334,0,0,0,0,134,19109,CREATE TEMP TABLE active_source_rows ON COMMIT DROP AS                 SELECT source_row.*                 FROM source_rows_with_early_feedback source_row                 WHERE source_row.early_feedback IS NULL                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'MERGE_ENTITY_PATCH' THEN true                     WHEN 'MERGE_ENTITY_REPLACE' THEN true                     WHEN 'MERGE_ENTITY_UPSERT' THEN true                     WHEN 'INSERT_NEW_ENTITIES' THEN NOT source_row.target_entity_exists                     WHEN 'PATCH_FOR_PORTION_OF' THEN source_row.target_entity_exists                     WHEN 'REPLACE_FOR_PORTION_OF' THEN source_row.target_entity_exists                     WHEN 'DELETE_FOR_PORTION_OF' THEN source_row.target_entity_exists                     WHEN 'UPDATE_FOR_PORTION_OF' THEN source_row.target_entity_exists                     ELSE false                 END
c45,Process Legal Units - Batch 2,,-8525577533969057774,1,11.72425,20000,285,0,0,0,0,110,12235,"CREATE TEMP TABLE all_rows ON COMMIT DROP AS                 SELECT id,  /* v_non_temporal_lookup_cols_select_list_no_alias_prefix */ causal_id, valid_from, valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM active_source_rows                 UNION ALL                 SELECT                     target_row.id,  /* v_non_temporal_tr_qualified_lookup_cols_prefix */                     target_row.causal_id,                     target_row.valid_from,                     target_row.valid_until,                     false as is_new_entity,                     target_row.stable_pk_payload,                     false as stable_identity_columns_are_null,                     false as lookup_columns_unavailable,                     true as is_identifiable,                     false as is_ambiguous,                     NULL::jsonb as conflicting_ids,                     target_row.canonical_nk_json                 FROM target_rows target_row"
517,Process Legal Units - Batch 2,,-4549662675158664316,1,11.695916,10000,335,0,0,0,0,92,17539,"CREATE TEMP TABLE source_rows_with_aggregates ON COMMIT DROP AS                 SELECT                     source_row_id,                     count(DISTINCT discovered_stable_pk_payload) as match_count,                     -- Filter out NULL to avoid [null] result for new entities with no matches                     COALESCE(jsonb_agg(DISTINCT discovered_stable_pk_payload) FILTER (WHERE discovered_stable_pk_payload IS NOT NULL), '[]'::jsonb) as conflicting_ids                 FROM source_rows_with_matches                 GROUP BY source_row_id"
b61,Process Legal Units - Batch 2,,7000426517880687954,1,11.420708,10000,434,0,0,0,0,131,14995,"CREATE TEMP TABLE source_rows_with_canonical_key ON COMMIT DROP AS                 SELECT *, (CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END /* v_grouping_key_expr */) as grouping_key                 FROM (                     SELECT                         s1.*,                         s2.nk_json as canonical_nk_json                     FROM source_rows_with_nk_json s1                     LEFT JOIN LATERAL (                         SELECT s2_inner.nk_json, s2_inner.nk_non_null_keys_array                         FROM source_rows_with_nk_json s2_inner                         WHERE s1.is_new_entity AND s2_inner.is_new_entity AND s2_inner.nk_json @> s1.nk_json                         ORDER BY array_length(s2_inner.nk_non_null_keys_array, 1) DESC, s2_inner.nk_non_null_keys_array::text DESC                         LIMIT 1                     ) s2 ON true                 ) s"
f6f,Process Legal Units - Batch 2,,3044517159719483727,1,11.246333,10000,252,0,0,0,0,92,17539,"CREATE TEMP TABLE source_rows_with_aggregates ON COMMIT DROP AS                 SELECT                     source_row_id,                     count(DISTINCT discovered_stable_pk_payload) as match_count,                     -- Filter out NULL to avoid [null] result for new entities with no matches                     COALESCE(jsonb_agg(DISTINCT discovered_stable_pk_payload) FILTER (WHERE discovered_stable_pk_payload IS NOT NULL), '[]'::jsonb) as conflicting_ids                 FROM source_rows_with_matches                 GROUP BY source_row_id"
779,Process Legal Units - Batch 2,,8118870935825291626,1,10.420041999999999,10000,325,0,0,0,0,130,14935,"CREATE TEMP TABLE source_rows_with_canonical_key ON COMMIT DROP AS                 SELECT *, (CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END /* v_grouping_key_expr */) as grouping_key                 FROM (                     SELECT                         s1.*,                         s2.nk_json as canonical_nk_json                     FROM source_rows_with_nk_json s1                     LEFT JOIN LATERAL (                         SELECT s2_inner.nk_json, s2_inner.nk_non_null_keys_array                         FROM source_rows_with_nk_json s2_inner                         WHERE s1.is_new_entity AND s2_inner.is_new_entity AND s2_inner.nk_json @> s1.nk_json                         ORDER BY array_length(s2_inner.nk_non_null_keys_array, 1) DESC, s2_inner.nk_non_null_keys_array::text DESC                         LIMIT 1                     ) s2 ON true                 ) s"
8ac,Process Legal Units - Batch 2,,5012345967240423926,1,10.352083,10000,427,0,0,0,0,135,16847,"CREATE TEMP TABLE source_rows_with_early_feedback ON COMMIT DROP AS                 SELECT                     s.*,                     CASE                         WHEN s.is_ambiguous                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is ambiguous. It matches multiple distinct target entities: ' || s.conflicting_ids::text )                         WHEN NOT s.is_identifiable AND s.is_new_entity                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is unidentifiable. It has NULL for all stable identity columns ' || replace('{id}'::text, '""', '') || ' and all natural keys ' || replace(NULL::text, '""', '') )                         WHEN NOT s.temporal_columns_are_consistent                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row has inconsistent temporal columns. Column ""' || 'valid_until' || '"" must be equal to column ""' || NULL || '"" + ' || NULL || '.' )                         WHEN s.is_eclipsed                         THEN jsonb_build_object( 'operation', 'SKIP_ECLIPSED'::text, 'message', 'Source row was eclipsed by row_ids=' || s.eclipsed_by::text || ' in the same batch.' )                         ELSE NULL                     END as early_feedback                 FROM source_rows_with_canonical_key s"
761,Process Legal Units - Batch 2,,4895990506256861755,10000,10.163881000000103,10000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
460,Process Legal Units - Batch 2,,7743831913079285872,10000,7.982484000000141,10000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
6ed,Process Legal Units - Batch 2,,725758841111022991,150,6.771381999999999,150,2058,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
cba,Process Legal Units - Batch 2,,1464568031695687146,150,0.984873,150,49,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
6a9,Process Legal Units - Batch 2,,-8708312726399770535,155,0.4704969999999996,155,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
9ab,Process Legal Units - Batch 2,,8008625629997484951,150,0.28779699999999986,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
4bd,Process Legal Units - Batch 2,,-1465262961312880621,155,0.2819069999999997,155,465,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
292,Process Legal Units - Batch 2,,-8889318315713072803,155,0.034992,155,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
486,Process Legal Units - Batch 3,,3443075950889914394,1,3035.351,0,560638,0,3066,3071,0,187322,17935870,CALL etl_bench.process_legal_units(v_batch_id)
cbf,Process Legal Units - Batch 3,,-1695124423541234323,1,2904.883542,0,439552,0,3066,3071,0,146983,15210133,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
8cd,Process Legal Units - Batch 3,,3348120163733767422,1,1917.098543,10000,26779,0,3066,3071,0,5739,630901,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
0da,Process Legal Units - Batch 3,,7921083691356368490,1,983.836042,0,411865,0,0,0,0,140977,14554461,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
acc,Process Legal Units - Batch 3,,2265356661347698759,1,659.473917,10000,240677,0,0,0,0,80577,8194534,"UPDATE etl_bench.legal_unit t SET valid_range = p.new_valid_range::daterange, name = CASE WHEN p.data ? 'name' THEN (p.data->>'name')::text ELSE t.name END, comment = CASE WHEN p.data ? 'comment' THEN (p.data->>'comment')::text ELSE t.comment END                                 FROM (SELECT *, (entity_keys->>'id')::integer AS id_ek FROM temporal_merge_plan WHERE operation = 'UPDATE' AND statement_seq = 1 ORDER BY plan_op_seq) p                                 WHERE t.id = p.id_ek AND t.valid_range = p.old_valid_range::daterange"
c9e,Process Legal Units - Batch 3,,-5685077514497051452,1,255.646209,0,236,0,0,0,0,55,23936,ANALYZE existing_segments_with_target
8ef,Process Legal Units - Batch 3,,-6251707813684716315,1,226.563125,10000,165437,0,0,0,0,60218,6332216,"UPDATE source_view_lu s             SET merge_statuses = COALESCE(s.merge_statuses, '{}'::jsonb) || jsonb_build_object('legal_unit', f.status), merge_errors = CASE WHEN f.error_message IS NOT NULL THEN COALESCE(s.merge_errors, '{}'::jsonb) || jsonb_build_object('legal_unit', f.error_message) ELSE COALESCE(s.merge_errors, '{}'::jsonb) - 'legal_unit' END             FROM pg_temp.temporal_merge_feedback f             WHERE s.row_id = f.source_row_id"
f94,Process Legal Units - Batch 3,,-8259425963603516266,1,225.602416,0,254,0,0,0,0,57,25581,ANALYZE resolved_atomic_segments_with_payloads
3a3,Process Legal Units - Batch 3,,-7186451687768528831,1,139.444208,20000,514,0,747,748,0,151,17691,"CREATE TEMP TABLE resolved_atomic_segments_with_propagated_ids ON COMMIT DROP AS                 SELECT                     *,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY grouping_key ORDER BY valid_from) as unified_canonical_nk_json,                     COALESCE(                         contributing_row_ids,                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as causal_source_row_ids,                     COALESCE(                         s_valid_from,                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_from,                     COALESCE(                         s_valid_until,                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_until                 FROM (                     SELECT                         *,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from) AS look_behind_grp,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from DESC) AS look_ahead_grp                     FROM resolved_atomic_segments_with_payloads /* v_resolver_from */                 ) with_grp"
875,Process Legal Units - Batch 3,,7218594984218514853,1,137.793208,20000,375,0,747,748,0,151,17691,"CREATE TEMP TABLE resolved_atomic_segments_with_propagated_ids ON COMMIT DROP AS                 SELECT                     *,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY grouping_key ORDER BY valid_from) as unified_canonical_nk_json,                     COALESCE(                         contributing_row_ids,                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (array_concat_agg(contributing_row_ids) FILTER (WHERE contributing_row_ids IS NOT NULL) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as causal_source_row_ids,                     COALESCE(                         s_valid_from,                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_from) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_from,                     COALESCE(                         s_valid_until,                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_behind_grp)),                         (max(s_valid_until) OVER (PARTITION BY grouping_key, t_valid_from, look_ahead_grp))                     ) as propagated_s_valid_until                 FROM (                     SELECT                         *,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from) AS look_behind_grp,                         sum(CASE WHEN source_row_id IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY grouping_key, t_valid_from ORDER BY valid_from DESC) AS look_ahead_grp                     FROM resolved_atomic_segments_with_payloads /* v_resolver_from */                 ) with_grp"
1e0,Process Legal Units - Batch 3,,7295163325594009324,1,117.84879099999999,10000,115467,0,0,0,0,40297,2722452,"INSERT INTO etl_bench.identity_resolution (identity_correlation, legal_unit_id, resolved_batch)     SELECT DISTINCT          identity_correlation,         legal_unit_id,         p_batch_id     FROM etl_bench.data_table     WHERE batch = p_batch_id AND legal_unit_id IS NOT NULL     ON CONFLICT (identity_correlation) DO UPDATE SET         legal_unit_id = EXCLUDED.legal_unit_id,         resolved_batch = EXCLUDED.resolved_batch"
b4b,Process Legal Units - Batch 3,,8679993553546922744,1,117.492708,40000,380,0,494,495,0,116,13077,"CREATE TEMP TABLE time_points_unified ON COMMIT DROP AS                 SELECT                     *,                     CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END AS grouping_key,                     CASE                         WHEN is_new_entity THEN causal_id                         ELSE FIRST_VALUE(causal_id) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS LAST)                     END as unified_causal_id,                     FIRST_VALUE(stable_pk_payload) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_stable_pk_payload,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_canonical_nk_json                 FROM time_points_raw"
a05,Process Legal Units - Batch 3,,2335399437257891460,1,116.237167,40000,302,0,494,495,0,116,13077,"CREATE TEMP TABLE time_points_unified ON COMMIT DROP AS                 SELECT                     *,                     CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END AS grouping_key,                     CASE                         WHEN is_new_entity THEN causal_id                         ELSE FIRST_VALUE(causal_id) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS LAST)                     END as unified_causal_id,                     FIRST_VALUE(stable_pk_payload) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_stable_pk_payload,                     FIRST_VALUE(canonical_nk_json) OVER (PARTITION BY CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END ORDER BY causal_id ASC NULLS FIRST) as unified_canonical_nk_json                 FROM time_points_raw"
288,Process Legal Units - Batch 3,,-4462245821754466351,1,113.58725,10000,454,0,556,557,0,129,14552,"CREATE TEMP TABLE coalesced_final_segments ON COMMIT DROP AS                 SELECT                     grouping_key, max(id) as id,                     sql_saga.first(causal_id ORDER BY valid_from) as causal_id,                     sql_saga.first(stable_identity_columns_are_null ORDER BY valid_from) as stable_identity_columns_are_null,                     sql_saga.first(lookup_columns_unavailable ORDER BY valid_from) as lookup_columns_unavailable,                     sql_saga.first(is_new_entity ORDER BY valid_from) as is_new_entity,                     sql_saga.first(is_identifiable ORDER BY valid_from) as is_identifiable,                     sql_saga.first(is_ambiguous ORDER BY valid_from) as is_ambiguous,                     sql_saga.first(conflicting_ids ORDER BY valid_from) as conflicting_ids,                     sql_saga.first(unified_canonical_nk_json ORDER BY valid_from) as canonical_nk_json,                     sql_saga.first(orig_source_target_relation ORDER BY valid_from) as orig_source_target_relation,                     sql_saga.first(t_valid_from ORDER BY valid_from) as ancestor_valid_from,                     MIN(valid_from) as valid_from,                     MAX(valid_until) as valid_until,                     (sql_saga.first(data_payload ORDER BY valid_from DESC) || sql_saga.first(ephemeral_payload ORDER BY valid_from DESC)) as final_payload,                     sql_saga.first(stable_pk_payload ORDER BY valid_from DESC) as stable_pk_payload,                     bool_and(unaffected_target_only_segment) as unaffected_target_only_segment,                     (SELECT array_agg(DISTINCT e) FROM unnest(array_concat_agg(causal_source_row_ids)) e WHERE e IS NOT NULL) as row_ids,                     CASE WHEN 'f'::boolean                         THEN jsonb_build_object( 'cte', 'coalesced', 'island_group_id', island_group_id, 'coalesced_stable_pk', sql_saga.first(stable_pk_payload ORDER BY valid_from DESC), 'final_payload', sql_saga.first(data_payload ORDER BY valid_from DESC), 'final_payload_sans_epheme"
bc7,Process Legal Units - Batch 3,,-6040831410118454259,1,112.17875,10000,331,0,556,557,0,129,14552,"CREATE TEMP TABLE coalesced_final_segments ON COMMIT DROP AS                 SELECT                     grouping_key, max(id) as id,                     sql_saga.first(causal_id ORDER BY valid_from) as causal_id,                     sql_saga.first(stable_identity_columns_are_null ORDER BY valid_from) as stable_identity_columns_are_null,                     sql_saga.first(lookup_columns_unavailable ORDER BY valid_from) as lookup_columns_unavailable,                     sql_saga.first(is_new_entity ORDER BY valid_from) as is_new_entity,                     sql_saga.first(is_identifiable ORDER BY valid_from) as is_identifiable,                     sql_saga.first(is_ambiguous ORDER BY valid_from) as is_ambiguous,                     sql_saga.first(conflicting_ids ORDER BY valid_from) as conflicting_ids,                     sql_saga.first(unified_canonical_nk_json ORDER BY valid_from) as canonical_nk_json,                     sql_saga.first(orig_source_target_relation ORDER BY valid_from) as orig_source_target_relation,                     sql_saga.first(t_valid_from ORDER BY valid_from) as ancestor_valid_from,                     MIN(valid_from) as valid_from,                     MAX(valid_until) as valid_until,                     (sql_saga.first(data_payload ORDER BY valid_from DESC) || sql_saga.first(ephemeral_payload ORDER BY valid_from DESC)) as final_payload,                     sql_saga.first(stable_pk_payload ORDER BY valid_from DESC) as stable_pk_payload,                     bool_and(unaffected_target_only_segment) as unaffected_target_only_segment,                     (SELECT array_agg(DISTINCT e) FROM unnest(array_concat_agg(causal_source_row_ids)) e WHERE e IS NOT NULL) as row_ids,                     CASE WHEN 'f'::boolean                         THEN jsonb_build_object( 'cte', 'coalesced', 'island_group_id', island_group_id, 'coalesced_stable_pk', sql_saga.first(stable_pk_payload ORDER BY valid_from DESC), 'final_payload', sql_saga.first(data_payload ORDER BY valid_from DESC), 'final_payload_sans_epheme"
e30,Process Legal Units - Batch 3,,2241213764000402520,1,108.959083,20000,463,0,0,0,0,137,15767,"CREATE TEMP TABLE existing_segments_with_target ON COMMIT DROP AS                 SELECT                     seg.grouping_key, seg.canonical_nk_json, seg.id, seg.causal_id, seg.is_new_entity, seg.is_identifiable, seg.is_ambiguous, seg.conflicting_ids, seg.stable_identity_columns_are_null, seg.lookup_columns_unavailable, seg.valid_from, seg.valid_until,                     target_row.valid_from as t_valid_from, target_row.valid_until as t_valid_until,                     target_row.data_payload as t_data_payload, target_row.ephemeral_payload as t_ephemeral_payload, seg.stable_pk_payload,                      target_row.stable_pk_payload as target_stable_pk_payload,                     source_payloads.source_row_id, source_payloads.contributing_row_ids,                     source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                     source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until,                     NULL::jsonb as trace                 FROM atomic_segments seg                 LEFT JOIN target_rows target_row                      ON target_row.id = seg.id                      AND daterange(seg.valid_from, seg.valid_until) <@ daterange(target_row.valid_from, target_row.valid_until)                                          LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE source_row.id = seg.id                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_un"
309,Process Legal Units - Batch 3,,8733302361466077115,1,108.031166,20000,345,0,0,0,0,137,15767,"CREATE TEMP TABLE existing_segments_with_target ON COMMIT DROP AS                 SELECT                     seg.grouping_key, seg.canonical_nk_json, seg.id, seg.causal_id, seg.is_new_entity, seg.is_identifiable, seg.is_ambiguous, seg.conflicting_ids, seg.stable_identity_columns_are_null, seg.lookup_columns_unavailable, seg.valid_from, seg.valid_until,                     target_row.valid_from as t_valid_from, target_row.valid_until as t_valid_until,                     target_row.data_payload as t_data_payload, target_row.ephemeral_payload as t_ephemeral_payload, seg.stable_pk_payload,                      target_row.stable_pk_payload as target_stable_pk_payload,                     source_payloads.source_row_id, source_payloads.contributing_row_ids,                     source_payloads.data_payload as s_data_payload, source_payloads.ephemeral_payload as s_ephemeral_payload,                     source_payloads.valid_from AS s_valid_from, source_payloads.valid_until AS s_valid_until,                     NULL::jsonb as trace                 FROM atomic_segments seg                 LEFT JOIN target_rows target_row                      ON target_row.id = seg.id                      AND daterange(seg.valid_from, seg.valid_until) <@ daterange(target_row.valid_from, target_row.valid_until)                                          LEFT JOIN LATERAL (                             WITH RECURSIVE ordered_sources AS (                                 SELECT                                     source_row.source_row_id, source_row.data_payload, source_row.ephemeral_payload,                                     source_row.valid_from, source_row.valid_until, source_row.causal_id,                                     row_number() OVER (ORDER BY source_row.source_row_id) as rn                                 FROM active_source_rows source_row                                 WHERE source_row.id = seg.id                                 AND daterange(seg.valid_from, seg.valid_until) <@ daterange(source_row.valid_from, source_row.valid_un"
fda,Process Legal Units - Batch 3,,0,36,96.553834,0,8073,0,0,0,0,2088,142276,CALL sql_saga.benchmark_reset()
a9f,Process Legal Units - Batch 3,,5432145740772416088,1,81.788875,0,210,0,0,0,0,49,12244,ANALYZE active_source_rows
f5b,Process Legal Units - Batch 3,,-518691661278450688,1,80.179667,0,184,0,0,0,0,40,9072,ANALYZE source_rows_with_nk_json
450,Process Legal Units - Batch 3,,1525269309137858814,1,63.891458,0,129,0,0,0,0,26,9453,ANALYZE atomic_segments
323,Process Legal Units - Batch 3,,4494928315034638917,1,61.443333,20000,479,0,771,772,0,151,17506,"CREATE TEMP TABLE island_group ON COMMIT DROP AS                 SELECT                     *,                     SUM(is_island_start) OVER (PARTITION BY grouping_key ORDER BY valid_from) as island_group_id                 FROM (                     SELECT                         *,                         CASE                             WHEN prev_valid_until IS NULL                             OR prev_valid_until <> valid_from                             OR (prev_data_hash IS DISTINCT FROM data_hash)                             THEN 1                             ELSE 0                         END as is_island_start                     FROM (                         SELECT                             *,                             LAG(valid_until) OVER w as prev_valid_until,                             LAG(data_hash) OVER w as prev_data_hash,                             LAG(data_payload) OVER w as prev_data_payload                         FROM resolved_atomic_segments ras                         WHERE ras.data_payload IS NOT NULL                         WINDOW w AS (PARTITION BY grouping_key ORDER BY valid_from)                     ) s1                 ) s2"
3b4,Process Legal Units - Batch 3,,-2675794321567617346,1,59.848126,20000,371,0,771,772,0,151,17506,"CREATE TEMP TABLE island_group ON COMMIT DROP AS                 SELECT                     *,                     SUM(is_island_start) OVER (PARTITION BY grouping_key ORDER BY valid_from) as island_group_id                 FROM (                     SELECT                         *,                         CASE                             WHEN prev_valid_until IS NULL                             OR prev_valid_until <> valid_from                             OR (prev_data_hash IS DISTINCT FROM data_hash)                             THEN 1                             ELSE 0                         END as is_island_start                     FROM (                         SELECT                             *,                             LAG(valid_until) OVER w as prev_valid_until,                             LAG(data_hash) OVER w as prev_data_hash,                             LAG(data_payload) OVER w as prev_data_payload                         FROM resolved_atomic_segments ras                         WHERE ras.data_payload IS NOT NULL                         WINDOW w AS (PARTITION BY grouping_key ORDER BY valid_from)                     ) s1                 ) s2"
575,Process Legal Units - Batch 3,,5039860120774769872,1,49.946791,0,128,0,0,0,0,26,7165,ANALYZE source_initial
bcb,Process Legal Units - Batch 3,,5509065722832958482,1,48.889875,20000,475,0,0,0,0,143,16763,"CREATE TEMP TABLE resolved_atomic_segments ON COMMIT DROP AS                 SELECT                     grouping_key, id,  stable_identity_columns_are_null, lookup_columns_unavailable, is_new_entity, is_identifiable, is_ambiguous, conflicting_ids, unified_canonical_nk_json,                     valid_from, valid_until, t_valid_from, t_valid_until, propagated_s_valid_from, propagated_s_valid_until, causal_source_row_ids, causal_id, propagated_stable_pk_payload as stable_pk_payload,                     causal_source_row_ids IS NULL AS unaffected_target_only_segment,                     s_data_payload, t_data_payload,                     sql_saga.get_allen_relation(propagated_s_valid_from, propagated_s_valid_until, t_valid_from, t_valid_until) AS orig_source_target_relation,                     COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb) as data_payload,                     md5((jsonb_strip_nulls(COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb)))::text) as data_hash,                     CASE                          WHEN s_data_payload IS NULL THEN t_ephemeral_payload                         ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb)                     END as ephemeral_payload,                     CASE WHEN 'f'::boolean                         THEN trace || jsonb_build_object( 'cte', 'ras', 'segment_stable_pk', propagated_stable_pk_payload, 'final_data_payload', COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb), 'final_ephemeral_payload', CASE WHEN s_data_payload IS NULL THEN t_ephemeral_payload ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb) END )                         ELSE NULL                     END as trace                 FROM resolved_atomic_segments_with_propagated_ids"
9b5,Process Legal Units - Batch 3,,2568094112886783045,1,48.365708,10000,0,0,0,0,0,0,0,"WITH RECURSIVE ordered_plan AS (                     SELECT                         row_number() OVER ( ORDER BY p.grouping_key, p.id, CASE p.operation WHEN 'DELETE' THEN 1 WHEN 'UPDATE' THEN 2 WHEN 'INSERT' THEN 3 ELSE 4 END, p.update_effect NULLS FIRST, CASE WHEN p.update_effect = 'MOVE' THEN 1 ELSE 0 END, CASE WHEN p.update_effect = 'MOVE' THEN COALESCE(p.old_valid_from, p.new_valid_from) END DESC NULLS LAST, COALESCE(p.old_valid_from, p.new_valid_from), (p.row_ids[1]) )::BIGINT as plan_op_seq,                         p.*                     FROM plan p                 ),                 -- For MOVE operations, group into the largest possible batches that can execute together.                 -- Within a single UPDATE statement, all rows see the pre-update state (MVCC snapshot).                 -- So if MOVE A's new_range overlaps MOVE B's old_range, they cannot be in the same statement.                 --                 -- Algorithm: Process MOVEs in plan_op_seq order (which is old_valid_from DESC).                 -- Track a multirange of old_ranges in the current batch. For each MOVE:                 -- - If new_range overlaps the batch's multirange, start a new batch                 -- - Add this MOVE's old_range to the batch's multirange                 --                 -- We use a recursive CTE to accumulate the multirange with reset-on-conflict logic.                 moves_ordered AS (                     SELECT                         o.plan_op_seq,                         o.grouping_key,                         o.old_valid_from,                         o.old_valid_until,                         o.new_valid_from,                         o.new_valid_until,                         row_number() OVER (PARTITION BY o.grouping_key ORDER BY o.plan_op_seq) AS move_seq                     FROM ordered_plan o                     WHERE o.operation = 'UPDATE' AND o.update_effect = 'MOVE'                 ),                 moves_with_batch AS (                     -- Base case: first MOVE in each entity starts b"
a95,Process Legal Units - Batch 3,,-2930989428870476669,1,48.334542,20000,355,0,0,0,0,143,16763,"CREATE TEMP TABLE resolved_atomic_segments ON COMMIT DROP AS                 SELECT                     grouping_key, id,  stable_identity_columns_are_null, lookup_columns_unavailable, is_new_entity, is_identifiable, is_ambiguous, conflicting_ids, unified_canonical_nk_json,                     valid_from, valid_until, t_valid_from, t_valid_until, propagated_s_valid_from, propagated_s_valid_until, causal_source_row_ids, causal_id, propagated_stable_pk_payload as stable_pk_payload,                     causal_source_row_ids IS NULL AS unaffected_target_only_segment,                     s_data_payload, t_data_payload,                     sql_saga.get_allen_relation(propagated_s_valid_from, propagated_s_valid_until, t_valid_from, t_valid_until) AS orig_source_target_relation,                     COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb) as data_payload,                     md5((jsonb_strip_nulls(COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb)))::text) as data_hash,                     CASE                          WHEN s_data_payload IS NULL THEN t_ephemeral_payload                         ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb)                     END as ephemeral_payload,                     CASE WHEN 'f'::boolean                         THEN trace || jsonb_build_object( 'cte', 'ras', 'segment_stable_pk', propagated_stable_pk_payload, 'final_data_payload', COALESCE(t_data_payload, '{}'::jsonb) || COALESCE(s_data_payload, '{}'::jsonb), 'final_ephemeral_payload', CASE WHEN s_data_payload IS NULL THEN t_ephemeral_payload ELSE COALESCE(t_ephemeral_payload, '{}'::jsonb) || COALESCE(s_ephemeral_payload, '{}'::jsonb) END )                         ELSE NULL                     END as trace                 FROM resolved_atomic_segments_with_propagated_ids"
cd9,Process Legal Units - Batch 3,,1428552154429020267,1,44.928458,30000,371,0,498,499,0,111,13091,"CREATE TEMP TABLE time_points ON COMMIT DROP AS                 SELECT DISTINCT ON (grouping_key, point) *                 FROM time_points_with_unified_ids                 ORDER BY grouping_key, point, causal_id DESC NULLS LAST"
fed,Process Legal Units - Batch 3,,6254436778457358929,1,42.505624999999995,30000,291,0,498,499,0,111,13091,"CREATE TEMP TABLE time_points ON COMMIT DROP AS                 SELECT DISTINCT ON (grouping_key, point) *                 FROM time_points_with_unified_ids                 ORDER BY grouping_key, point, causal_id DESC NULLS LAST"
cd2,Process Legal Units - Batch 3,,-6771234532898534008,1,31.328042,10000,441,0,0,0,0,137,15333,"CREATE TEMP TABLE diff ON COMMIT DROP AS                 SELECT                     final_seg.grouping_key, COALESCE(final_seg.id, target_seg.id) as id, COALESCE(final_seg.causal_id, target_seg.causal_id) as causal_id,                     COALESCE(final_seg.is_new_entity, false) as is_new_entity,                     COALESCE(final_seg.is_identifiable, true) as is_identifiable,                     COALESCE(final_seg.is_ambiguous, false) as is_ambiguous,                     final_seg.conflicting_ids,                     final_seg.canonical_nk_json,                     COALESCE(final_seg.stable_identity_columns_are_null, false) as stable_identity_columns_are_null,                     COALESCE(final_seg.lookup_columns_unavailable, false) as lookup_columns_unavailable,                     final_seg.valid_from AS f_from, final_seg.valid_until AS f_until, final_seg.final_payload AS f_payload, final_seg.row_ids AS f_row_ids, final_seg.stable_pk_payload, final_seg.orig_source_target_relation,                     CASE WHEN 'f'::boolean                         THEN final_seg.trace || jsonb_build_object('cte', 'diff', 'diff_stable_pk', final_seg.stable_pk_payload, 'final_seg_causal_id', final_seg.causal_id, 'final_payload_vs_target_payload', jsonb_build_object('f', final_seg.final_payload, 't', target_seg.data_payload))                         ELSE NULL                     END as trace,                     final_seg.unaffected_target_only_segment,                     target_seg.valid_from as t_from, target_seg.valid_until as t_until, (target_seg.data_payload || target_seg.ephemeral_payload) as t_payload,                     sql_saga.get_allen_relation(target_seg.valid_from, target_seg.valid_until, final_seg.valid_from, final_seg.valid_until) as b_a_relation                 FROM coalesced_final_segments AS final_seg                 FULL OUTER JOIN target_rows AS target_seg ON final_seg.grouping_key = ('existing_entity__' || COALESCE(target_seg.id::text, '_NULL_')) AND final_seg.ancestor_valid_from = target_seg.valid_from"
4ae,Process Legal Units - Batch 3,,0,1,31.264417,0,6334,0,0,0,0,1614,87156,CALL sql_saga.temporal_merge_drop_temp_tables()
b74,Process Legal Units - Batch 3,,-3204223827806995791,1,30.710792,10000,343,0,0,0,0,137,15333,"CREATE TEMP TABLE diff ON COMMIT DROP AS                 SELECT                     final_seg.grouping_key, COALESCE(final_seg.id, target_seg.id) as id, COALESCE(final_seg.causal_id, target_seg.causal_id) as causal_id,                     COALESCE(final_seg.is_new_entity, false) as is_new_entity,                     COALESCE(final_seg.is_identifiable, true) as is_identifiable,                     COALESCE(final_seg.is_ambiguous, false) as is_ambiguous,                     final_seg.conflicting_ids,                     final_seg.canonical_nk_json,                     COALESCE(final_seg.stable_identity_columns_are_null, false) as stable_identity_columns_are_null,                     COALESCE(final_seg.lookup_columns_unavailable, false) as lookup_columns_unavailable,                     final_seg.valid_from AS f_from, final_seg.valid_until AS f_until, final_seg.final_payload AS f_payload, final_seg.row_ids AS f_row_ids, final_seg.stable_pk_payload, final_seg.orig_source_target_relation,                     CASE WHEN 'f'::boolean                         THEN final_seg.trace || jsonb_build_object('cte', 'diff', 'diff_stable_pk', final_seg.stable_pk_payload, 'final_seg_causal_id', final_seg.causal_id, 'final_payload_vs_target_payload', jsonb_build_object('f', final_seg.final_payload, 't', target_seg.data_payload))                         ELSE NULL                     END as trace,                     final_seg.unaffected_target_only_segment,                     target_seg.valid_from as t_from, target_seg.valid_until as t_until, (target_seg.data_payload || target_seg.ephemeral_payload) as t_payload,                     sql_saga.get_allen_relation(target_seg.valid_from, target_seg.valid_until, final_seg.valid_from, final_seg.valid_until) as b_a_relation                 FROM coalesced_final_segments AS final_seg                 FULL OUTER JOIN target_rows AS target_seg ON final_seg.grouping_key = ('existing_entity__' || COALESCE(target_seg.id::text, '_NULL_')) AND final_seg.ancestor_valid_from = target_seg.valid_from"
0f3,Process Legal Units - Batch 3,,1965474688105448427,1,29.5375,10000,5109,0,0,0,0,113,12593,"CREATE TEMP TABLE source_initial ON COMMIT DROP AS                 WITH source_data AS (                     SELECT                         source_table.row_id /* row_id_column */ as source_row_id,                         COALESCE(source_table.founding_id, source_table.row_id::integer) /* v_causal_select_expr */ as causal_id,                         source_table.id,  -- v_non_temporal_lookup_cols_select_list_prefix                         source_table.valid_from as valid_from, source_table.valid_until as valid_until, /* v_source_temporal_cols_expr */                         jsonb_strip_nulls(jsonb_build_object('name', source_table.name)) /* v_source_data_payload_expr */ AS data_payload,                         jsonb_strip_nulls(jsonb_build_object('comment', source_table.comment)) /* v_source_ephemeral_payload_expr */ AS ephemeral_payload,                         jsonb_build_object('id', source_table.id) /* v_stable_pk_cols_jsonb_build_source */ as stable_pk_payload,                         source_table.id IS NULL /* v_entity_id_check_is_null_expr */ as stable_identity_columns_are_null,                         (true) /* v_lookup_cols_are_null_expr */ as lookup_columns_unavailable,                         true /* v_is_identifiable_expr */ as is_identifiable,                         true /* v_consistency_check_expr */ as temporal_columns_are_consistent                     FROM source_view_lu /* v_source_table_ident */ source_table                 )                 SELECT                      *,                     -- OPTIMIZATION: Pre-compute range column to avoid repeated daterange() calls                     -- This provides ~10-15% performance improvement in eclipse detection                     daterange(valid_from, valid_until) as valid_range                 FROM source_data"
cc8,Process Legal Units - Batch 3,,2115514670139824758,1,29.089334,10000,5059,0,0,0,0,113,12593,"CREATE TEMP TABLE source_initial ON COMMIT DROP AS                 WITH source_data AS (                     SELECT                         source_table.row_id /* row_id_column */ as source_row_id,                         COALESCE(source_table.founding_id, source_table.row_id::integer) /* v_causal_select_expr */ as causal_id,                         source_table.id,  -- v_non_temporal_lookup_cols_select_list_prefix                         source_table.valid_from as valid_from, source_table.valid_until as valid_until, /* v_source_temporal_cols_expr */                         jsonb_strip_nulls(jsonb_build_object('name', source_table.name)) /* v_source_data_payload_expr */ AS data_payload,                         jsonb_strip_nulls(jsonb_build_object('comment', source_table.comment)) /* v_source_ephemeral_payload_expr */ AS ephemeral_payload,                         jsonb_build_object('id', source_table.id) /* v_stable_pk_cols_jsonb_build_source */ as stable_pk_payload,                         source_table.id IS NULL /* v_entity_id_check_is_null_expr */ as stable_identity_columns_are_null,                         (true) /* v_lookup_cols_are_null_expr */ as lookup_columns_unavailable,                         true /* v_is_identifiable_expr */ as is_identifiable,                         true /* v_consistency_check_expr */ as temporal_columns_are_consistent                     FROM source_view_lu /* v_source_table_ident */ source_table                 )                 SELECT                      *,                     -- OPTIMIZATION: Pre-compute range column to avoid repeated daterange() calls                     -- This provides ~10-15% performance improvement in eclipse detection                     daterange(valid_from, valid_until) as valid_range                 FROM source_data;"
604,Process Legal Units - Batch 3,,-1407412071598267173,1,28.759082,10000,4765,0,0,0,0,0,0,"WITH             all_source_rows AS (                 SELECT t.row_id AS source_row_id FROM source_view_lu t             ),             plan_unnested AS (                 SELECT unnest(p.row_ids) as source_row_id, p.plan_op_seq, p.entity_keys, p.operation, p.data, p.feedback                 FROM temporal_merge_plan p             ),             feedback_groups AS (                 SELECT                     asr.source_row_id,                     -- Aggregate all distinct operations for this source row.                     array_agg(DISTINCT pu.operation) FILTER (WHERE pu.operation IS NOT NULL) as operations,                     -- Aggregate all distinct entity IDs this source row touched.                     COALESCE(jsonb_agg(DISTINCT pu.entity_keys) FILTER (WHERE pu.entity_keys IS NOT NULL), '[]'::jsonb) AS target_entity_keys,                     -- Extract the specific error message from the plan's feedback payload if present.                     (array_agg(pu.feedback->>'error') FILTER (WHERE pu.operation = 'ERROR' AND pu.feedback ? 'error'))[1] as error_message_from_plan                 FROM all_source_rows asr                 LEFT JOIN plan_unnested pu ON asr.source_row_id = pu.source_row_id                 GROUP BY asr.source_row_id             )             INSERT INTO temporal_merge_feedback                 SELECT                     fg.source_row_id,                     fg.target_entity_keys,                     CASE                         -- This CASE statement must be ordered from most to least specific to correctly classify outcomes.                         -- This CASE statement directly translates the plan's actions into a final feedback status.                         -- It is ordered from most to least specific to ensure correctness.                         WHEN 'ERROR'::sql_saga.temporal_merge_plan_action = ANY(fg.operations) THEN 'ERROR'                         WHEN 'INSERT'::sql_saga.temporal_merge_plan_action = ANY(fg.operations)                           OR 'UPDATE'::sql_saga.temporal_merge_"
0ae,Process Legal Units - Batch 3,,6779487562696088383,1,26.858917,20000,381,0,0,0,0,113,12567,"CREATE TEMP TABLE atomic_segments ON COMMIT DROP AS                 SELECT grouping_key, id, causal_id, point as valid_from, next_point as valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json                 FROM (                     SELECT *, LEAD(point) OVER (PARTITION BY grouping_key ORDER BY point) as next_point                     FROM time_points                 ) with_lead                 WHERE point IS NOT NULL AND next_point IS NOT NULL AND point < next_point"
7e3,Process Legal Units - Batch 3,,-7375841108639655790,1,26.243665999999997,20000,300,0,0,0,0,113,12567,"CREATE TEMP TABLE atomic_segments ON COMMIT DROP AS                 SELECT grouping_key, id, causal_id, point as valid_from, next_point as valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json                 FROM (                     SELECT *, LEAD(point) OVER (PARTITION BY grouping_key ORDER BY point) as next_point                     FROM time_points                 ) with_lead                 WHERE point IS NOT NULL AND next_point IS NOT NULL AND point < next_point"
3b2,Process Legal Units - Batch 3,,-6217490005536178219,1,25.031666,20000,545,0,0,0,0,141,16777,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     seg.*,                     seg.stable_pk_payload as propagated_stable_pk_payload                 FROM all_segments seg                 WHERE (seg.s_data_payload IS NOT NULL OR seg.t_data_payload IS NOT NULL)                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'PATCH_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'REPLACE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'DELETE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'UPDATE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     ELSE true                 END"
4ef,Process Legal Units - Batch 3,,3662944893103168594,1,24.423209,20000,353,0,0,0,0,141,16777,"CREATE TEMP TABLE resolved_atomic_segments_with_payloads ON COMMIT DROP AS                 WITH all_segments AS (                     SELECT * FROM existing_segments_with_target                     UNION ALL                     SELECT * FROM new_segments_no_target                 )                 SELECT                     seg.*,                     seg.stable_pk_payload as propagated_stable_pk_payload                 FROM all_segments seg                 WHERE (seg.s_data_payload IS NOT NULL OR seg.t_data_payload IS NOT NULL)                 AND CASE 'MERGE_ENTITY_PATCH'::sql_saga.temporal_merge_mode                     WHEN 'PATCH_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'REPLACE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'DELETE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     WHEN 'UPDATE_FOR_PORTION_OF' THEN seg.t_data_payload IS NOT NULL                     ELSE true                 END"
605,Process Legal Units - Batch 3,,1300200293165651031,1,23.767333,10000,442,0,0,0,0,134,18220,"CREATE TEMP TABLE plan_with_op ON COMMIT DROP AS                 (                     SELECT * FROM (                         SELECT                             d.f_row_ids as row_ids, d.orig_source_target_relation, d.is_new_entity,                             CASE                                 WHEN d.is_ambiguous THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.is_new_entity AND NOT d.is_identifiable THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.t_from IS NULL THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.f_from IS NULL THEN 'DELETE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank = 1 THEN 'UPDATE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank > 1 THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank IS NULL THEN                                     CASE                                         WHEN d.unaffected_target_only_segment THEN NULL                                         ELSE 'SKIP_IDENTICAL'::sql_saga.temporal_merge_plan_action                                     END                                 ELSE 'ERROR'::sql_saga.temporal_merge_plan_action                             END as operation,                             id,                             CASE                                 WHEN d.is_new_entity AND d.canonical_nk_json IS NOT NULL                                 THEN d.canonical_nk_json || COALESCE(d.stable_pk_payload, '{}'::jsonb)                                 ELSE jsonb_build_object('id', d.id) || COALESCE(d.stable_pk_payload, '{}'::jsonb)                             END as entity_keys_json,                             jsonb_build_object('id', d.id) as identity_keys,                             jsonb_build_object() as lookup_keys,                             d.causal_id, d.t_from as old_valid_from, d.t_until as old_valid_until, d.f"
c4c,Process Legal Units - Batch 3,,2006172193490038593,1,23.103584,10000,336,0,0,0,0,134,18220,"CREATE TEMP TABLE plan_with_op ON COMMIT DROP AS                 (                     SELECT * FROM (                         SELECT                             d.f_row_ids as row_ids, d.orig_source_target_relation, d.is_new_entity,                             CASE                                 WHEN d.is_ambiguous THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.is_new_entity AND NOT d.is_identifiable THEN 'ERROR'::sql_saga.temporal_merge_plan_action                                 WHEN d.t_from IS NULL THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.f_from IS NULL THEN 'DELETE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank = 1 THEN 'UPDATE'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank > 1 THEN 'INSERT'::sql_saga.temporal_merge_plan_action                                 WHEN d.update_rank IS NULL THEN                                     CASE                                         WHEN d.unaffected_target_only_segment THEN NULL                                         ELSE 'SKIP_IDENTICAL'::sql_saga.temporal_merge_plan_action                                     END                                 ELSE 'ERROR'::sql_saga.temporal_merge_plan_action                             END as operation,                             id,                             CASE                                 WHEN d.is_new_entity AND d.canonical_nk_json IS NOT NULL                                 THEN d.canonical_nk_json || COALESCE(d.stable_pk_payload, '{}'::jsonb)                                 ELSE jsonb_build_object('id', d.id) || COALESCE(d.stable_pk_payload, '{}'::jsonb)                             END as entity_keys_json,                             jsonb_build_object('id', d.id) as identity_keys,                             jsonb_build_object() as lookup_keys,                             d.causal_id, d.t_from as old_valid_from, d.t_until as old_valid_until, d.f"
abd,Process Legal Units - Batch 3,,-6189425232530816533,1,22.280458,10000,568,0,0,0,0,102,11171,"CREATE TEMP TABLE target_rows ON COMMIT DROP AS                 SELECT                     id,  /* v_non_temporal_lookup_cols_select_list_no_alias_prefix */ -- (non-temporal identity columns)                     lower(t.valid_range) as valid_from, -- The temporal identity column (e.g., valid_from)                     NULL::integer /* v_causal_column_type */ as causal_id, -- Target rows do not originate from a source row, so causal_id is NULL. Type is introspected.                     jsonb_build_object('id', id) /* v_stable_pk_cols_jsonb_build_bare */ as stable_pk_payload,                     upper(t.valid_range) as valid_until,                     jsonb_build_object('name', name) /* v_target_data_cols_jsonb_build_bare */ AS data_payload,                     jsonb_build_object('comment', comment) /* v_target_ephemeral_cols_jsonb_build_bare */ AS ephemeral_payload,                     jsonb_strip_nulls(jsonb_build_object()) /* v_target_nk_json_expr */ AS canonical_nk_json                 FROM (                         SELECT * FROM (                             SELECT DISTINCT ON (u.id, u.valid_from) * FROM (                                 (                                     SELECT * FROM etl_bench.legal_unit inner_t                                     WHERE (inner_t.id) IN (SELECT DISTINCT si.id FROM source_initial si WHERE (si.id) IS NOT NULL)                                 )                             ) u                         )                     ) AS t  /* v_target_rows_filter */"
9da,Process Legal Units - Batch 3,,-2522301903109079185,1,22.143916,40000,381,0,0,0,0,111,12363,"CREATE TEMP TABLE time_points_with_unified_ids ON COMMIT DROP AS                 SELECT                     tpu.grouping_key,                     tpu.id,                     tpu.unified_causal_id as causal_id,                     tpu.point,                     tpu.is_new_entity,                     tpu.unified_stable_pk_payload as stable_pk_payload,                     tpu.stable_identity_columns_are_null,                     tpu.lookup_columns_unavailable,                     tpu.is_identifiable,                     tpu.is_ambiguous,                     tpu.conflicting_ids,                     tpu.unified_canonical_nk_json as canonical_nk_json                 FROM time_points_unified tpu"
f00,Process Legal Units - Batch 3,,-4193415169867768194,1,21.732417,10000,518,0,0,0,0,102,11171,"CREATE TEMP TABLE target_rows ON COMMIT DROP AS                 SELECT                     id,  /* v_non_temporal_lookup_cols_select_list_no_alias_prefix */ -- (non-temporal identity columns)                     lower(t.valid_range) as valid_from, -- The temporal identity column (e.g., valid_from)                     NULL::integer /* v_causal_column_type */ as causal_id, -- Target rows do not originate from a source row, so causal_id is NULL. Type is introspected.                     jsonb_build_object('id', id) /* v_stable_pk_cols_jsonb_build_bare */ as stable_pk_payload,                     upper(t.valid_range) as valid_until,                     jsonb_build_object('name', name) /* v_target_data_cols_jsonb_build_bare */ AS data_payload,                     jsonb_build_object('comment', comment) /* v_target_ephemeral_cols_jsonb_build_bare */ AS ephemeral_payload,                     jsonb_strip_nulls(jsonb_build_object()) /* v_target_nk_json_expr */ AS canonical_nk_json                 FROM (                         SELECT * FROM (                             SELECT DISTINCT ON (u.id, u.valid_from) * FROM (                                 (                                     SELECT * FROM etl_bench.legal_unit inner_t                                     WHERE (inner_t.id) IN (SELECT DISTINCT si.id FROM source_initial si WHERE (si.id) IS NOT NULL)                                 )                             ) u                         )                     ) AS t  /* v_target_rows_filter */"
88a,Process Legal Units - Batch 3,,-2381107599654639950,1,21.399792,40000,295,0,0,0,0,111,12363,"CREATE TEMP TABLE time_points_with_unified_ids ON COMMIT DROP AS                 SELECT                     tpu.grouping_key,                     tpu.id,                     tpu.unified_causal_id as causal_id,                     tpu.point,                     tpu.is_new_entity,                     tpu.unified_stable_pk_payload as stable_pk_payload,                     tpu.stable_identity_columns_are_null,                     tpu.lookup_columns_unavailable,                     tpu.is_identifiable,                     tpu.is_ambiguous,                     tpu.conflicting_ids,                     tpu.unified_canonical_nk_json as canonical_nk_json                 FROM time_points_unified tpu"
815,Process Legal Units - Batch 3,,5147944785677299242,1,21.334708,10000,446,0,0,0,0,139,15743,"CREATE TEMP TABLE diff_ranked ON COMMIT DROP AS                 SELECT                     d.*,                     CASE                         WHEN d.t_from IS NULL OR d.f_from IS NULL THEN NULL                         WHEN d.f_from = d.t_from AND d.f_until = d.t_until AND d.f_payload IS NOT DISTINCT FROM d.t_payload THEN NULL                         ELSE                             row_number() OVER (                                 PARTITION BY d.grouping_key, d.t_from                                 ORDER BY                                     CASE WHEN d.f_from = d.t_from THEN 1 ELSE 2 END,                                     CASE WHEN d.f_payload - '{comment}'::text[] IS NOT DISTINCT FROM d.t_payload - '{comment}'::text[] THEN 1 ELSE 2 END,                                     d.f_from,                                     d.f_until                             )                     END as update_rank                 FROM diff d"
f75,Process Legal Units - Batch 3,,6259880232974284115,1,20.807833000000002,10000,344,0,0,0,0,139,15743,"CREATE TEMP TABLE diff_ranked ON COMMIT DROP AS                 SELECT                     d.*,                     CASE                         WHEN d.t_from IS NULL OR d.f_from IS NULL THEN NULL                         WHEN d.f_from = d.t_from AND d.f_until = d.t_until AND d.f_payload IS NOT DISTINCT FROM d.t_payload THEN NULL                         ELSE                             row_number() OVER (                                 PARTITION BY d.grouping_key, d.t_from                                 ORDER BY                                     CASE WHEN d.f_from = d.t_from THEN 1 ELSE 2 END,                                     CASE WHEN d.f_payload - '{comment}'::text[] IS NOT DISTINCT FROM d.t_payload - '{comment}'::text[] THEN 1 ELSE 2 END,                                     d.f_from,                                     d.f_until                             )                     END as update_rank                 FROM diff d"
31f,Process Legal Units - Batch 3,,-957741634502868070,1,18.6635,10000,419,0,0,0,0,127,14435,"CREATE TEMP TABLE source_rows_with_nk_json ON COMMIT DROP AS                 SELECT source_row.*, jsonb_strip_nulls(jsonb_build_object()) /* v_lookup_keys_as_jsonb_expr */ as nk_json, ARRAY(SELECT e FROM unnest(ARRAY[]::TEXT[]) e WHERE e IS NOT NULL ORDER BY e) /* v_lookup_keys_as_array_expr */ as nk_non_null_keys_array                 FROM source_rows_with_new_flag source_row"
ea1,Process Legal Units - Batch 3,,2346888588666524139,1,18.168667,40000,373,0,0,0,0,109,12047,"CREATE TEMP TABLE time_points_raw ON COMMIT DROP AS                 SELECT id, causal_id, valid_from AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows                 UNION ALL                 SELECT id, causal_id, valid_until AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows"
3ed,Process Legal Units - Batch 3,,7625827313856663095,1,18.162834,10000,329,0,0,0,0,127,14435,"CREATE TEMP TABLE source_rows_with_nk_json ON COMMIT DROP AS                 SELECT source_row.*, jsonb_strip_nulls(jsonb_build_object()) /* v_lookup_keys_as_jsonb_expr */ as nk_json, ARRAY(SELECT e FROM unnest(ARRAY[]::TEXT[]) e WHERE e IS NOT NULL ORDER BY e) /* v_lookup_keys_as_array_expr */ as nk_non_null_keys_array                 FROM source_rows_with_new_flag source_row"
a1f,Process Legal Units - Batch 3,,3254511572182529394,1,17.732708,40000,292,0,0,0,0,109,12047,"CREATE TEMP TABLE time_points_raw ON COMMIT DROP AS                 SELECT id, causal_id, valid_from AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows                 UNION ALL                 SELECT id, causal_id, valid_until AS point, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM all_rows"
b63,Process Legal Units - Batch 3,,8021558608045147396,1,16.304166,10000,448,0,0,0,0,139,19817,"CREATE TEMP TABLE plan ON COMMIT DROP AS                 SELECT                     p.row_ids, p.operation, p.causal_id, p.is_new_entity,                     p.id,                     p.entity_keys_json as entity_keys,                     p.identity_keys, p.lookup_keys,                     p.orig_source_target_relation, p.b_a_relation, p.old_valid_from, p.old_valid_until,                     p.new_valid_from, p.new_valid_until, p.data, p.feedback, p.trace,                     p.grouping_key,                     CASE                         WHEN p.operation <> 'UPDATE' THEN NULL::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from = p.old_valid_from AND p.new_valid_until = p.old_valid_until THEN 'NONE'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from <= p.old_valid_from AND p.new_valid_until >= p.old_valid_until THEN 'GROW'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from >= p.old_valid_from AND p.new_valid_until <= p.old_valid_until THEN 'SHRINK'::sql_saga.temporal_merge_update_effect                         ELSE 'MOVE'::sql_saga.temporal_merge_update_effect                     END AS update_effect                 FROM plan_with_op p                 LEFT JOIN source_rows_with_new_flag source_row ON source_row.source_row_id = p.row_ids[1]"
194,Process Legal Units - Batch 3,,8010399271587590855,1,15.769042,10000,349,0,0,0,0,139,19817,"CREATE TEMP TABLE plan ON COMMIT DROP AS                 SELECT                     p.row_ids, p.operation, p.causal_id, p.is_new_entity,                     p.id,                     p.entity_keys_json as entity_keys,                     p.identity_keys, p.lookup_keys,                     p.orig_source_target_relation, p.b_a_relation, p.old_valid_from, p.old_valid_until,                     p.new_valid_from, p.new_valid_until, p.data, p.feedback, p.trace,                     p.grouping_key,                     CASE                         WHEN p.operation <> 'UPDATE' THEN NULL::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from = p.old_valid_from AND p.new_valid_until = p.old_valid_until THEN 'NONE'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from <= p.old_valid_from AND p.new_valid_until >= p.old_valid_until THEN 'GROW'::sql_saga.temporal_merge_update_effect                         WHEN p.new_valid_from >= p.old_valid_from AND p.new_valid_until <= p.old_valid_until THEN 'SHRINK'::sql_saga.temporal_merge_update_effect                         ELSE 'MOVE'::sql_saga.temporal_merge_update_effect                     END AS update_effect                 FROM plan_with_op p                 LEFT JOIN source_rows_with_new_flag source_row ON source_row.source_row_id = p.row_ids[1]"
7c5,Process Legal Units - Batch 3,,-1318097777820228,1,14.565625,10000,405,0,0,0,0,122,13729,"CREATE TEMP TABLE source_rows ON COMMIT DROP AS                 SELECT DISTINCT ON (p.source_row_id)                     p.source_row_id, p.causal_id, p.valid_from, p.valid_until, p.data_payload, p.ephemeral_payload,                     (p.stable_identity_columns_are_null AND p.discovered_stable_pk_payload IS NULL) as stable_identity_columns_are_null,                     p.lookup_columns_unavailable, p.is_identifiable,                     p.is_ambiguous, p.conflicting_ids, p.is_eclipsed, p.eclipsed_by,                     p.temporal_columns_are_consistent,                     COALESCE(p.stable_pk_payload, p.discovered_stable_pk_payload) as stable_pk_payload,                     (p.discovered_stable_pk_payload IS NOT NULL) /* v_target_entity_exists_expr */ as target_entity_exists,                     COALESCE(p.id, p.discovered_id_1) AS id /* v_coalesced_id_cols_list */                 FROM source_rows_with_discovery p                 ORDER BY p.source_row_id, p.discovered_stable_pk_payload"
992,Process Legal Units - Batch 3,,2284106485190769639,1,14.093167,10000,311,0,0,0,0,122,13729,"CREATE TEMP TABLE source_rows ON COMMIT DROP AS                 SELECT DISTINCT ON (p.source_row_id)                     p.source_row_id, p.causal_id, p.valid_from, p.valid_until, p.data_payload, p.ephemeral_payload,                     (p.stable_identity_columns_are_null AND p.discovered_stable_pk_payload IS NULL) as stable_identity_columns_are_null,                     p.lookup_columns_unavailable, p.is_identifiable,                     p.is_ambiguous, p.conflicting_ids, p.is_eclipsed, p.eclipsed_by,                     p.temporal_columns_are_consistent,                     COALESCE(p.stable_pk_payload, p.discovered_stable_pk_payload) as stable_pk_payload,                     (p.discovered_stable_pk_payload IS NOT NULL) /* v_target_entity_exists_expr */ as target_entity_exists,                     COALESCE(p.id, p.discovered_id_1) AS id /* v_coalesced_id_cols_list */                 FROM source_rows_with_discovery p                 ORDER BY p.source_row_id, p.discovered_stable_pk_payload"
890,Process Legal Units - Batch 3,,5849653773365333279,1,12.784417,10000,414,0,0,0,0,122,14461,"CREATE TEMP TABLE source_rows_with_matches ON COMMIT DROP AS                 SELECT                     source_row.*,                     target_row.stable_pk_payload as discovered_stable_pk_payload,                     target_row.id AS discovered_id_1 /* v_propagated_id_cols_list */                 FROM source_with_eclipsed_flag source_row                 LEFT JOIN target_rows target_row ON (source_row.id = target_row.id /* v_source_rows_exists_join_expr */)"
552,Process Legal Units - Batch 3,,2613701250391606255,1,12.705959,10000,391,0,0,0,0,128,18129,"CREATE TEMP TABLE source_rows_with_discovery ON COMMIT DROP AS                 SELECT                     m.*,                     a.match_count,                     a.conflicting_ids,                     (a.match_count > 1) as is_ambiguous                 FROM source_rows_with_matches m                 JOIN source_rows_with_aggregates a ON m.source_row_id = a.source_row_id"
d4e,Process Legal Units - Batch 3,,-4549662675158664316,1,12.369459,10000,344,0,0,0,0,92,9941,"CREATE TEMP TABLE source_rows_with_aggregates ON COMMIT DROP AS                 SELECT                     source_row_id,                     count(DISTINCT discovered_stable_pk_payload) as match_count,                     -- Filter out NULL to avoid [null] result for new entities with no matches                     COALESCE(jsonb_agg(DISTINCT discovered_stable_pk_payload) FILTER (WHERE discovered_stable_pk_payload IS NOT NULL), '[]'::jsonb) as conflicting_ids                 FROM source_rows_with_matches                 GROUP BY source_row_id"
6e6,Process Legal Units - Batch 3,,8473430400440557908,1,12.252126,10000,329,0,0,0,0,128,18129,"CREATE TEMP TABLE source_rows_with_discovery ON COMMIT DROP AS                 SELECT                     m.*,                     a.match_count,                     a.conflicting_ids,                     (a.match_count > 1) as is_ambiguous                 FROM source_rows_with_matches m                 JOIN source_rows_with_aggregates a ON m.source_row_id = a.source_row_id"
4c4,Process Legal Units - Batch 3,,1995507501247956172,1,12.218583,10000,317,0,0,0,0,122,14461,"CREATE TEMP TABLE source_rows_with_matches ON COMMIT DROP AS                 SELECT                     source_row.*,                     target_row.stable_pk_payload as discovered_stable_pk_payload,                     target_row.id AS discovered_id_1 /* v_propagated_id_cols_list */                 FROM source_with_eclipsed_flag source_row                 LEFT JOIN target_rows target_row ON (source_row.id = target_row.id /* v_source_rows_exists_join_expr */)"
68c,Process Legal Units - Batch 3,,3044517159719483727,1,11.919542,10000,254,0,0,0,0,92,9941,"CREATE TEMP TABLE source_rows_with_aggregates ON COMMIT DROP AS                 SELECT                     source_row_id,                     count(DISTINCT discovered_stable_pk_payload) as match_count,                     -- Filter out NULL to avoid [null] result for new entities with no matches                     COALESCE(jsonb_agg(DISTINCT discovered_stable_pk_payload) FILTER (WHERE discovered_stable_pk_payload IS NOT NULL), '[]'::jsonb) as conflicting_ids                 FROM source_rows_with_matches                 GROUP BY source_row_id"
7d3,Process Legal Units - Batch 3,,-3169870935594387745,1,11.598291999999999,0,5466,0,0,0,0,0,0,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
c93,Process Legal Units - Batch 3,,-5024370260775748889,1,11.37275,10000,395,0,0,0,0,116,13049,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT * FROM (                     -- Path 1: Existing Entities (Window Function on Lookup Keys)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE NOT s1.lookup_columns_unavailable                      UNION ALL                      -- Path 2: New Entities (Window Function on Causal ID)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY causal_id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY causal_id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE s1.lookup_columns_unavailable                 ) t"
e18,Process Legal Units - Batch 3,,8689595743856886431,1,11.293625,0,144,0,0,0,0,15,1597,CREATE INDEX ON active_source_rows (grouping_key)
c1b,Process Legal Units - Batch 3,,7000426517880687954,1,10.949542,10000,447,0,0,0,0,131,15975,"CREATE TEMP TABLE source_rows_with_canonical_key ON COMMIT DROP AS                 SELECT *, (CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END /* v_grouping_key_expr */) as grouping_key                 FROM (                     SELECT                         s1.*,                         s2.nk_json as canonical_nk_json                     FROM source_rows_with_nk_json s1                     LEFT JOIN LATERAL (                         SELECT s2_inner.nk_json, s2_inner.nk_non_null_keys_array                         FROM source_rows_with_nk_json s2_inner                         WHERE s1.is_new_entity AND s2_inner.is_new_entity AND s2_inner.nk_json @> s1.nk_json                         ORDER BY array_length(s2_inner.nk_non_null_keys_array, 1) DESC, s2_inner.nk_non_null_keys_array::text DESC                         LIMIT 1                     ) s2 ON true                 ) s"
16d,Process Legal Units - Batch 3,,3167307580342175303,1,10.774707999999999,10000,304,0,0,0,0,116,13049,"CREATE TEMP TABLE source_with_eclipsed_flag ON COMMIT DROP AS                 SELECT * FROM (                     -- Path 1: Existing Entities (Window Function on Lookup Keys)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE NOT s1.lookup_columns_unavailable                      UNION ALL                      -- Path 2: New Entities (Window Function on Causal ID)                     SELECT                         s1.*,                         COALESCE(                             range_agg(valid_range) OVER (                                 PARTITION BY causal_id                                 ORDER BY source_row_id DESC                                 ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                             ) @> valid_range,                             false                         ) as is_eclipsed,                         array_agg(source_row_id) OVER (                             PARTITION BY causal_id                             ORDER BY source_row_id DESC                             ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING                         ) as eclipsed_by                     FROM source_initial s1                     WHERE s1.lookup_columns_unavailable                 ) t;"
e9c,Process Legal Units - Batch 3,,5494611821061557908,1,10.414209,20000,392,0,0,0,0,110,12235,"CREATE TEMP TABLE all_rows ON COMMIT DROP AS                 SELECT id,  /* v_non_temporal_lookup_cols_select_list_no_alias_prefix */ causal_id, valid_from, valid_until, is_new_entity, stable_pk_payload, stable_identity_columns_are_null, lookup_columns_unavailable, is_identifiable, is_ambiguous, conflicting_ids, canonical_nk_json FROM active_source_rows                 UNION ALL                 SELECT                     target_row.id,  /* v_non_temporal_tr_qualified_lookup_cols_prefix */                     target_row.causal_id,                     target_row.valid_from,                     target_row.valid_until,                     false as is_new_entity,                     target_row.stable_pk_payload,                     false as stable_identity_columns_are_null,                     false as lookup_columns_unavailable,                     true as is_identifiable,                     false as is_ambiguous,                     NULL::jsonb as conflicting_ids,                     target_row.canonical_nk_json                 FROM target_rows target_row"
f5e,Process Legal Units - Batch 3,,8118870935825291626,1,10.235249999999999,10000,331,0,0,0,0,131,15975,"CREATE TEMP TABLE source_rows_with_canonical_key ON COMMIT DROP AS                 SELECT *, (CASE                 WHEN is_new_entity                 THEN 'new_entity__' || causal_id::text                 ELSE 'existing_entity__' || COALESCE(id::text, '_NULL_')             END /* v_grouping_key_expr */) as grouping_key                 FROM (                     SELECT                         s1.*,                         s2.nk_json as canonical_nk_json                     FROM source_rows_with_nk_json s1                     LEFT JOIN LATERAL (                         SELECT s2_inner.nk_json, s2_inner.nk_non_null_keys_array                         FROM source_rows_with_nk_json s2_inner                         WHERE s1.is_new_entity AND s2_inner.is_new_entity AND s2_inner.nk_json @> s1.nk_json                         ORDER BY array_length(s2_inner.nk_non_null_keys_array, 1) DESC, s2_inner.nk_non_null_keys_array::text DESC                         LIMIT 1                     ) s2 ON true                 ) s"
95c,Process Legal Units - Batch 3,,4895990506256861755,10000,10.089344000000148,10000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
909,Process Legal Units - Batch 3,,5012345967240423926,1,10.06625,10000,440,0,0,0,0,134,15979,"CREATE TEMP TABLE source_rows_with_early_feedback ON COMMIT DROP AS                 SELECT                     s.*,                     CASE                         WHEN s.is_ambiguous                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is ambiguous. It matches multiple distinct target entities: ' || s.conflicting_ids::text )                         WHEN NOT s.is_identifiable AND s.is_new_entity                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row is unidentifiable. It has NULL for all stable identity columns ' || replace('{id}'::text, '""', '') || ' and all natural keys ' || replace(NULL::text, '""', '') )                         WHEN NOT s.temporal_columns_are_consistent                         THEN jsonb_build_object( 'operation', 'ERROR'::text, 'message', 'Source row has inconsistent temporal columns. Column ""' || 'valid_until' || '"" must be equal to column ""' || NULL || '"" + ' || NULL || '.' )                         WHEN s.is_eclipsed                         THEN jsonb_build_object( 'operation', 'SKIP_ECLIPSED'::text, 'message', 'Source row was eclipsed by row_ids=' || s.eclipsed_by::text || ' in the same batch.' )                         ELSE NULL                     END as early_feedback                 FROM source_rows_with_canonical_key s"
a2a,Process Legal Units - Batch 3,,7743831913079285872,10000,8.614350000000039,10000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
8f4,Process Legal Units - Batch 3,,725758841111022991,150,6.840745,150,2324,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
1f9,Process Legal Units - Batch 3,,1464568031695687146,150,0.9070929999999995,150,50,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
35e,Process Legal Units - Batch 3,,-8708312726399770535,155,0.5131339999999995,155,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
d78,Process Legal Units - Batch 3,,-1465262961312880621,155,0.31916599999999967,155,465,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
026,Process Legal Units - Batch 3,,8008625629997484951,150,0.2813069999999997,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
402,Process Legal Units - Batch 3,,-8889318315713072803,155,0.04112500000000002,155,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
