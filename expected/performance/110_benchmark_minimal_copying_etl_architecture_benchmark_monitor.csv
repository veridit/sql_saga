log_id,event,label,queryid,calls,total_exec_time,rows,shared_blks_hit,shared_blks_read,temp_blks_read,temp_blks_written,total_plan_time,wal_records,wal_bytes,query
c4c,Generate Test Data - 10000 entities,,6811526824939518768,1,694.9738749999999,1,549771,4,0,0,0,296662,27684158,"SELECT etl_bench.generate_test_data(         p_total_entities => v_dataset_size,         p_entities_per_batch => 2000,         p_rows_per_new_entity => 5,         p_rows_per_update => 1,         p_new_entity_pct => 50     )"
268,Generate Test Data - 10000 entities,,-5564909837039849191,1,604.29,59000,548034,4,0,0,0,296560,27661007,"INSERT INTO etl_bench.data_table (         row_id, batch, identity_correlation, comment,         tax_ident, lu_name, physical_address, postal_address,         activity_code, employees, turnover, valid_from, valid_until     )     WITH batch_info AS (         SELECT              batch_num,             ((batch_num - 1) * v_new_per_batch + 1) as new_start,             LEAST(batch_num * v_new_per_batch, p_total_entities) as new_end,             GREATEST(1, (batch_num - 1) * v_new_per_batch) as update_pool_size         FROM generate_series(1, v_num_batches) as batch_num     ),     -- NEW entities: full data rows (name, address, activity, stats)     new_entity_rows AS (         SELECT              bi.batch_num as batch,             entity_num as identity_correlation,             row_in_entity,             'new' as row_type         FROM batch_info bi,              generate_series(bi.new_start, bi.new_end) as entity_num,              generate_series(1, p_rows_per_new_entity) as row_in_entity         WHERE bi.new_start <= bi.new_end     ),     -- UPDATE entities: minimal rows (typically just stat updates)     update_entity_rows AS (         SELECT              bi.batch_num as batch,             ((update_idx - 1) % bi.update_pool_size) + 1 as identity_correlation,             row_in_entity,             'update' as row_type         FROM batch_info bi,              generate_series(1, v_updates_per_batch) as update_idx,              generate_series(1, p_rows_per_update) as row_in_entity         WHERE bi.batch_num > 1           AND bi.update_pool_size > 0     ),     all_rows AS (         SELECT batch, identity_correlation, row_in_entity, row_type FROM new_entity_rows         UNION ALL         SELECT batch, identity_correlation, row_in_entity, row_type FROM update_entity_rows     )     SELECT          row_number() OVER (ORDER BY batch, identity_correlation, row_in_entity) as row_id,         batch,         identity_correlation,         format('Entity %s (%s)', identity_correlation, row_type) as comment,         -- New entities: f"
525,Generate Test Data - 10000 entities,,760596586349204572,1,87.875875,0,1125,0,0,0,0,41,18667,ANALYZE etl_bench.data_table
f68,Process Legal Units - Batch 1,,-9072011849815902944,1,378.386208,0,237330,6,0,0,0,105699,9953067,CALL etl_bench.process_legal_units(v_batch_id)
6a9,Process Legal Units - Batch 1,,8328983687720608052,1,216.2395,0,60930,5,0,0,0,23906,2611261,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
3ae,Process Legal Units - Batch 1,,-3169870935594387745,1,158.860084,13000,170847,0,0,0,0,78719,7152626,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
03b,Process Legal Units - Batch 1,,3695296514158988325,1,125.84416700000001,1000,16433,2,0,0,0,4257,532762,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
982,Process Legal Units - Batch 1,,-1012970831589493243,1,87.84275,0,43770,3,0,0,0,19471,2059183,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
c16,Process Legal Units - Batch 1,,-5921528884174901831,1,33.518542,1000,13397,3,0,0,0,6824,666753,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
db1,Process Legal Units - Batch 1,,1015950519091360496,1,16.725583,1000,13263,0,0,0,0,6143,692700,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
331,Process Legal Units - Batch 1,,-6251707813684716315,1,11.640457999999999,1000,14158,0,0,0,0,6017,640546,"UPDATE source_view_lu s             SET merge_statuses = COALESCE(s.merge_statuses, '{}'::jsonb) || jsonb_build_object('legal_unit', f.status), merge_errors = CASE WHEN f.error_message IS NOT NULL THEN COALESCE(s.merge_errors, '{}'::jsonb) || jsonb_build_object('legal_unit', f.error_message) ELSE COALESCE(s.merge_errors, '{}'::jsonb) - 'legal_unit' END             FROM pg_temp.temporal_merge_feedback f             WHERE s.row_id = f.source_row_id"
5ee,Process Legal Units - Batch 1,,4895990506256861755,1000,1.6860799999999927,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
847,Process Legal Units - Batch 1,,7743831913079285872,1000,1.3559459999999959,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
13e,Process Legal Units - Batch 10,,-9072011849815902944,1,348.008542,0,165361,0,0,0,0,56705,5262286,CALL etl_bench.process_legal_units(v_batch_id)
250,Process Legal Units - Batch 10,,8328983687720608052,1,308.065292,0,76200,0,0,0,0,25676,2748427,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
507,Process Legal Units - Batch 10,,3695296514158988325,1,168.117583,1000,25564,0,0,0,0,5730,606542,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
f62,Process Legal Units - Batch 10,,-1012970831589493243,1,134.692583,0,49570,0,0,0,0,19680,2117831,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
be6,Process Legal Units - Batch 10,,-5921528884174901831,1,76.58833299999999,1000,15033,0,0,0,0,7063,755997,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
635,Process Legal Units - Batch 10,,0,39,41.618542,0,9313,0,0,0,0,2275,157654,CALL sql_saga.benchmark_reset()
d91,Process Legal Units - Batch 10,,-3169870935594387745,1,31.396709,4000,57718,0,0,0,0,23975,2067106,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
37a,Process Legal Units - Batch 10,,0,1,26.199791,0,6232,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
24b,Process Legal Units - Batch 10,,1015950519091360496,1,24.357249,1000,17228,0,0,0,0,6213,662436,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
0ee,Process Legal Units - Batch 10,,-6251707813684716315,1,14.999167,1000,15213,0,0,0,0,6051,657828,"UPDATE source_view_lu s             SET merge_statuses = COALESCE(s.merge_statuses, '{}'::jsonb) || jsonb_build_object('legal_unit', f.status), merge_errors = CASE WHEN f.error_message IS NOT NULL THEN COALESCE(s.merge_errors, '{}'::jsonb) || jsonb_build_object('legal_unit', f.error_message) ELSE COALESCE(s.merge_errors, '{}'::jsonb) - 'legal_unit' END             FROM pg_temp.temporal_merge_feedback f             WHERE s.row_id = f.source_row_id"
349,Process Legal Units - Batch 10,,725758841111022991,154,7.523668000000002,154,4426,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
1b5,Process Legal Units - Batch 10,,4895990506256861755,1000,1.8524449999999903,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
ec8,Process Legal Units - Batch 10,,7743831913079285872,1000,1.4466019999999948,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
895,Process Legal Units - Batch 10,,1464568031695687146,154,0.5986249999999999,154,63,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
d1a,Process Legal Units - Batch 10,,-8708312726399770535,160,0.5006849999999996,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
83e,Process Legal Units - Batch 10,,-1465262961312880621,160,0.32111699999999965,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
079,Process Legal Units - Batch 10,,8008625629997484951,154,0.25812599999999963,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
5cc,Process Legal Units - Batch 10,,-8889318315713072803,160,0.03691800000000002,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
b76,Process Legal Units - Batch 2,,-9072011849815902944,1,259.018875,0,135444,0,0,0,0,56714,5364536,CALL etl_bench.process_legal_units(v_batch_id)
838,Process Legal Units - Batch 2,,8328983687720608052,1,226.041,0,67059,0,0,0,0,25657,2768581,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
518,Process Legal Units - Batch 2,,3695296514158988325,1,143.62275,1000,21346,0,0,0,0,5726,602277,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
456,Process Legal Units - Batch 2,,-1012970831589493243,1,78.241791,0,44806,0,0,0,0,19667,2142336,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
519,Process Legal Units - Batch 2,,-5921528884174901831,1,38.139041999999996,1000,15032,0,0,0,0,7062,757011,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
1d0,Process Legal Units - Batch 2,,-3169870935594387745,1,26.876667,4000,53038,0,0,0,0,23996,2142990,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
4f6,Process Legal Units - Batch 2,,0,1,23.532,0,6321,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
1a9,Process Legal Units - Batch 2,,1015950519091360496,1,11.855833,1000,13374,0,0,0,0,6206,661268,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
f5a,Process Legal Units - Batch 2,,725758841111022991,154,5.592500000000002,154,2130,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
ee0,Process Legal Units - Batch 2,,4895990506256861755,1000,1.6914979999999908,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
44f,Process Legal Units - Batch 2,,7743831913079285872,1000,1.379437999999996,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
36c,Process Legal Units - Batch 2,,1464568031695687146,154,0.5581209999999998,154,55,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
80c,Process Legal Units - Batch 2,,-8708312726399770535,160,0.4919279999999993,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
963,Process Legal Units - Batch 2,,-1465262961312880621,160,0.28162199999999965,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
de3,Process Legal Units - Batch 2,,8008625629997484951,154,0.2610849999999998,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
805,Process Legal Units - Batch 2,,-8889318315713072803,160,0.036832000000000024,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
381,Process Legal Units - Batch 3,,-9072011849815902944,1,263.615333,0,137773,0,0,0,0,56709,5374123,CALL etl_bench.process_legal_units(v_batch_id)
6ca,Process Legal Units - Batch 3,,8328983687720608052,1,223.968459,0,67276,0,0,0,0,25657,2805255,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
9af,Process Legal Units - Batch 3,,3695296514158988325,1,138.253833,1000,21787,0,0,0,0,5715,587229,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
1a9,Process Legal Units - Batch 3,,-1012970831589493243,1,80.9105,0,44533,0,0,0,0,19677,2194010,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
e50,Process Legal Units - Batch 3,,-5921528884174901831,1,41.803833,1000,15034,0,0,0,0,7070,812922,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
081,Process Legal Units - Batch 3,,0,39,36.767162,0,8914,0,0,0,0,2271,157626,CALL sql_saga.benchmark_reset()
890,Process Legal Units - Batch 3,,-3169870935594387745,1,32.886584000000006,4000,53119,0,0,0,0,23978,2109786,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
8a8,Process Legal Units - Batch 3,,0,1,23.137584,0,6234,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
b05,Process Legal Units - Batch 3,,1015950519091360496,1,12.002749999999999,1000,13363,0,0,0,0,6203,660896,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
2b5,Process Legal Units - Batch 3,,725758841111022991,154,5.991924,154,2420,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
fb6,Process Legal Units - Batch 3,,4895990506256861755,1000,1.7116929999999921,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
784,Process Legal Units - Batch 3,,7743831913079285872,1000,1.3993549999999964,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
559,Process Legal Units - Batch 3,,1464568031695687146,154,0.566215,154,56,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
492,Process Legal Units - Batch 3,,-8708312726399770535,160,0.5050099999999995,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
3be,Process Legal Units - Batch 3,,-1465262961312880621,160,0.3132419999999997,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
4e5,Process Legal Units - Batch 3,,8008625629997484951,154,0.24779699999999985,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
6a5,Process Legal Units - Batch 3,,-8889318315713072803,160,0.03597900000000003,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
0c4,Process Legal Units - Batch 4,,-9072011849815902944,1,254.142917,0,143358,0,0,0,0,56692,5256283,CALL etl_bench.process_legal_units(v_batch_id)
7e7,Process Legal Units - Batch 4,,8328983687720608052,1,220.815625,0,70751,0,0,0,0,25645,2692176,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
198,Process Legal Units - Batch 4,,3695296514158988325,1,130.671875,1000,22354,0,0,0,0,5728,596746,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
92d,Process Legal Units - Batch 4,,-1012970831589493243,1,85.173,0,47441,0,0,0,0,19653,2071506,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
3b2,Process Legal Units - Batch 4,,-5921528884174901831,1,44.558958000000004,1000,15031,0,0,0,0,7055,705341,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
025,Process Legal Units - Batch 4,,0,39,34.445828999999996,0,8981,0,0,0,0,2274,157771,CALL sql_saga.benchmark_reset()
2c3,Process Legal Units - Batch 4,,-3169870935594387745,1,26.526833,4000,53245,0,0,0,0,23989,2117166,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
782,Process Legal Units - Batch 4,,0,1,20.602542,0,6242,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
0d7,Process Legal Units - Batch 4,,1015950519091360496,1,12.089542,1000,16248,0,0,0,0,6194,638936,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
efa,Process Legal Units - Batch 4,,725758841111022991,154,5.9174169999999995,154,2706,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
ea2,Process Legal Units - Batch 4,,4895990506256861755,1000,1.7855519999999947,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
4ef,Process Legal Units - Batch 4,,7743831913079285872,1000,1.445793999999996,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
41f,Process Legal Units - Batch 4,,1464568031695687146,154,0.5207089999999999,154,58,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
bd4,Process Legal Units - Batch 4,,-8708312726399770535,160,0.4817449999999997,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
e24,Process Legal Units - Batch 4,,-1465262961312880621,160,0.2730759999999994,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
e04,Process Legal Units - Batch 4,,8008625629997484951,154,0.23837199999999975,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
741,Process Legal Units - Batch 4,,-8889318315713072803,160,0.03533200000000001,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
107,Process Legal Units - Batch 5,,-9072011849815902944,1,325.958125,0,146090,0,0,0,0,56718,5366137,CALL etl_bench.process_legal_units(v_batch_id)
fa4,Process Legal Units - Batch 5,,8328983687720608052,1,231.907916,0,71354,0,0,0,0,25659,2778956,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
0c7,Process Legal Units - Batch 5,,3695296514158988325,1,138.486501,1000,22920,0,0,0,0,5731,599599,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
4fe,Process Legal Units - Batch 5,,-1012970831589493243,1,88.90875,0,47466,0,0,0,0,19663,2154617,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
4a8,Process Legal Units - Batch 5,,-3169870935594387745,1,79.05779100000001,4000,53344,0,0,0,0,23991,2134744,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
395,Process Legal Units - Batch 5,,-5921528884174901831,1,46.969832000000004,1000,15033,0,0,0,0,7061,748770,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
07e,Process Legal Units - Batch 5,,0,39,35.230835,0,9021,0,0,0,0,2273,159709,CALL sql_saga.benchmark_reset()
13f,Process Legal Units - Batch 5,,0,1,21.486709,0,6243,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
d48,Process Legal Units - Batch 5,,7295163325594009324,1,13.887999,2000,21210,0,0,0,0,7026,449152,"INSERT INTO etl_bench.identity_resolution (identity_correlation, legal_unit_id, resolved_batch)     SELECT DISTINCT          identity_correlation,         legal_unit_id,         p_batch_id     FROM etl_bench.data_table     WHERE batch = p_batch_id AND legal_unit_id IS NOT NULL     ON CONFLICT (identity_correlation) DO UPDATE SET         legal_unit_id = EXCLUDED.legal_unit_id,         resolved_batch = EXCLUDED.resolved_batch"
9cf,Process Legal Units - Batch 5,,1015950519091360496,1,13.611375,1000,16251,0,0,0,0,6203,671276,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
6c1,Process Legal Units - Batch 5,,725758841111022991,154,6.301542,154,2992,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
f0c,Process Legal Units - Batch 5,,4895990506256861755,1000,1.7402089999999948,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
2a3,Process Legal Units - Batch 5,,7743831913079285872,1000,1.3941079999999948,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
bde,Process Legal Units - Batch 5,,1464568031695687146,154,0.5686419999999999,154,58,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
7f0,Process Legal Units - Batch 5,,-8708312726399770535,160,0.5058729999999996,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
807,Process Legal Units - Batch 5,,-1465262961312880621,160,0.3007089999999996,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
e5e,Process Legal Units - Batch 5,,8008625629997484951,154,0.2463269999999998,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
9fa,Process Legal Units - Batch 5,,-8889318315713072803,160,0.035660000000000025,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
138,Process Legal Units - Batch 6,,-9072011849815902944,1,288.21125,0,148799,0,0,0,0,56700,5365896,CALL etl_bench.process_legal_units(v_batch_id)
200,Process Legal Units - Batch 6,,8328983687720608052,1,243.055875,0,71948,0,0,0,0,25646,2760047,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
fd5,Process Legal Units - Batch 6,,3695296514158988325,1,136.700834,1000,23454,0,0,0,0,5724,592951,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
62c,Process Legal Units - Batch 6,,-1012970831589493243,1,101.254167,0,47496,0,0,0,0,19653,2135516,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
1be,Process Legal Units - Batch 6,,-5921528884174901831,1,49.173415999999996,1000,15035,0,0,0,0,7061,748770,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
831,Process Legal Units - Batch 6,,-3169870935594387745,1,37.604459,4000,53457,0,0,0,0,23995,2157212,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
964,Process Legal Units - Batch 6,,0,39,36.952794000000004,0,9088,0,0,0,0,2274,164964,CALL sql_saga.benchmark_reset()
933,Process Legal Units - Batch 6,,1015950519091360496,1,24.142875,1000,16247,0,0,0,0,6198,663752,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
254,Process Legal Units - Batch 6,,0,1,23.670708,0,6238,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
7c5,Process Legal Units - Batch 6,,725758841111022991,154,6.537784999999999,154,3274,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
33a,Process Legal Units - Batch 6,,4895990506256861755,1000,1.7186149999999938,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
d53,Process Legal Units - Batch 6,,7743831913079285872,1000,1.382446999999997,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
483,Process Legal Units - Batch 6,,1464568031695687146,154,0.5803860000000002,154,59,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
8b5,Process Legal Units - Batch 6,,-8708312726399770535,160,0.4966629999999995,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
0de,Process Legal Units - Batch 6,,-1465262961312880621,160,0.3016649999999996,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
fd1,Process Legal Units - Batch 6,,8008625629997484951,154,0.2532159999999997,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
a9e,Process Legal Units - Batch 6,,-8889318315713072803,160,0.03546500000000002,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
54d,Process Legal Units - Batch 7,,-9072011849815902944,1,292.519875,0,151450,0,0,0,0,56683,5246326,CALL etl_bench.process_legal_units(v_batch_id)
87f,Process Legal Units - Batch 7,,8328983687720608052,1,236.013208,0,72486,0,0,0,0,25641,2669736,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
51e,Process Legal Units - Batch 7,,3695296514158988325,1,142.561041,1000,23975,0,0,0,0,5725,595285,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
f98,Process Legal Units - Batch 7,,-1012970831589493243,1,89.281416,0,47500,0,0,0,0,19650,2050369,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
dce,Process Legal Units - Batch 7,,-5921528884174901831,1,52.408708,1000,15033,0,0,0,0,7058,720093,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
8a6,Process Legal Units - Batch 7,,-3169870935594387745,1,49.165625,4000,53550,0,0,0,0,23982,2127380,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
094,Process Legal Units - Batch 7,,0,39,33.77279299999999,0,9122,0,0,0,0,2271,157470,CALL sql_saga.benchmark_reset()
9b2,Process Legal Units - Batch 7,,0,1,21.006708,0,6229,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
797,Process Legal Units - Batch 7,,1015950519091360496,1,12.312958,1000,16246,0,0,0,0,6193,621152,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
8ee,Process Legal Units - Batch 7,,725758841111022991,154,6.645965999999999,154,3560,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
ba1,Process Legal Units - Batch 7,,4895990506256861755,1000,1.731771999999992,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
2cd,Process Legal Units - Batch 7,,7743831913079285872,1000,1.4204129999999937,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
b19,Process Legal Units - Batch 7,,1464568031695687146,154,0.554633,154,60,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
3ab,Process Legal Units - Batch 7,,-8708312726399770535,160,0.47933199999999937,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
eea,Process Legal Units - Batch 7,,-1465262961312880621,160,0.2770709999999996,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
ff0,Process Legal Units - Batch 7,,8008625629997484951,154,0.24342299999999983,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
498,Process Legal Units - Batch 7,,-8889318315713072803,160,0.03541600000000002,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
47a,Process Legal Units - Batch 8,,-9072011849815902944,1,270.554,0,154154,0,0,0,0,56692,5213741,CALL etl_bench.process_legal_units(v_batch_id)
946,Process Legal Units - Batch 8,,8328983687720608052,1,230.205458,0,73062,0,0,0,0,25646,2692488,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
02a,Process Legal Units - Batch 8,,3695296514158988325,1,135.771375,1000,24492,0,0,0,0,5721,591734,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
da6,Process Legal Units - Batch 8,,-1012970831589493243,1,89.440333,0,47540,0,0,0,0,19658,2073042,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
59b,Process Legal Units - Batch 8,,-5921528884174901831,1,54.441083,1000,15032,0,0,0,0,7058,733754,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
937,Process Legal Units - Batch 8,,0,39,39.551084999999986,0,9198,0,0,0,0,2276,163091,CALL sql_saga.benchmark_reset()
211,Process Legal Units - Batch 8,,-3169870935594387745,1,31.580499999999997,4000,53661,0,0,0,0,23977,2074092,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
46d,Process Legal Units - Batch 8,,0,1,25.923417,0,6234,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
2b2,Process Legal Units - Batch 8,,1015950519091360496,1,11.613167,1000,16256,0,0,0,0,6203,632912,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
2ae,Process Legal Units - Batch 8,,725758841111022991,154,6.736246,154,3846,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
c58,Process Legal Units - Batch 8,,4895990506256861755,1000,1.6964769999999958,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
899,Process Legal Units - Batch 8,,7743831913079285872,1000,1.367845999999994,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
16a,Process Legal Units - Batch 8,,1464568031695687146,154,0.519134,154,61,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
f1c,Process Legal Units - Batch 8,,-8708312726399770535,160,0.49902599999999936,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
ed9,Process Legal Units - Batch 8,,-1465262961312880621,160,0.3199179999999996,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
027,Process Legal Units - Batch 8,,8008625629997484951,154,0.2506309999999997,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
4bf,Process Legal Units - Batch 8,,-8889318315713072803,160,0.03682500000000001,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
666,Process Legal Units - Batch 9,,-9072011849815902944,1,272.394125,0,161704,0,0,0,0,56718,5289877,CALL etl_bench.process_legal_units(v_batch_id)
f0e,Process Legal Units - Batch 9,,8328983687720608052,1,232.979958,0,74489,0,0,0,0,25653,2739744,"CALL sql_saga.temporal_merge(         target_table => 'etl_bench.legal_unit',         source_table => 'source_view_lu',         primary_identity_columns => ARRAY['id'],         ephemeral_columns => ARRAY['comment'],         mode => 'MERGE_ENTITY_PATCH',         founding_id_column => 'founding_id',         update_source_with_identity => true,         update_source_with_feedback => true,         feedback_status_column => 'merge_statuses',         feedback_status_key => 'legal_unit',         feedback_error_column => 'merge_errors',         feedback_error_key => 'legal_unit'     )"
d30,Process Legal Units - Batch 9,,3695296514158988325,1,132.13216599999998,1000,25000,0,0,0,0,5720,593947,"INSERT INTO temporal_merge_plan         SELECT * FROM sql_saga.temporal_merge_plan(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             identity_columns => v_identity_cols_discovered,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             delete_mode => temporal_merge.delete_mode,             lookup_keys => v_natural_identity_keys_discovered,             ephemeral_columns => temporal_merge.ephemeral_columns,             p_log_trace => v_log_trace,             p_log_sql => v_log_sql         )"
11e,Process Legal Units - Batch 9,,-1012970831589493243,1,96.827541,0,48444,0,0,0,0,19668,2121773,"CALL sql_saga.temporal_merge_execute(             target_table => temporal_merge.target_table,             source_table => temporal_merge.source_table,             identity_columns => v_identity_cols_discovered,             mode => temporal_merge.mode,             era_name => temporal_merge.era_name,             row_id_column => temporal_merge.row_id_column,             founding_id_column => temporal_merge.founding_id_column,             update_source_with_identity => temporal_merge.update_source_with_identity,             lookup_columns => v_natural_identity_cols_discovered,             delete_mode => temporal_merge.delete_mode,             update_source_with_feedback => temporal_merge.update_source_with_feedback,             feedback_status_column => temporal_merge.feedback_status_column,             feedback_status_key => temporal_merge.feedback_status_key,             feedback_error_column => temporal_merge.feedback_error_column,             feedback_error_key => temporal_merge.feedback_error_key,             ephemeral_columns => temporal_merge.ephemeral_columns,             delay_constraints => temporal_merge.delay_constraints         )"
16e,Process Legal Units - Batch 9,,-5921528884174901831,1,59.926958,1000,15035,0,0,0,0,7063,763026,"WITH founding_plan_ops AS (                                     SELECT DISTINCT ON (p.grouping_key)                                         p.plan_op_seq,                                         p.causal_id,                                         p.grouping_key,                                         p.new_valid_range,                                         p.entity_keys || p.data as full_data                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.is_new_entity                                     ORDER BY p.grouping_key, p.plan_op_seq                                 ),                                 id_map_cte AS (                                     MERGE INTO etl_bench.legal_unit t                                     USING founding_plan_ops s ON false                                     WHEN NOT MATCHED THEN                                         INSERT (id, name, comment, valid_range)                                         VALUES (COALESCE((s.full_data->>'id')::integer, nextval('etl_bench.legal_unit_id_seq'::regclass)), (s.full_data->>'name')::text, (s.full_data->>'comment')::text, s.new_valid_range::daterange)                                     RETURNING t.*, s.causal_id, s.grouping_key                                 )                                 INSERT INTO temporal_merge_entity_id_map (grouping_key, causal_id, new_entity_keys)                                 SELECT                                     ir.grouping_key,                                     ir.causal_id,                                     jsonb_build_object('id', ir.id)                                 FROM id_map_cte ir"
cf0,Process Legal Units - Batch 9,,0,39,31.576124999999998,0,9271,0,0,0,0,2274,157829,CALL sql_saga.benchmark_reset()
5c7,Process Legal Units - Batch 9,,-3169870935594387745,1,29.089625,4000,57749,0,0,0,0,23978,2088300,UPDATE etl_bench.data_table dt     SET legal_unit_id = ir.legal_unit_id     FROM etl_bench.identity_resolution ir     WHERE dt.identity_correlation = ir.identity_correlation       AND dt.legal_unit_id IS NULL
bb2,Process Legal Units - Batch 9,,0,1,19.135083,0,6237,0,0,0,0,1605,86670,CALL sql_saga.temporal_merge_drop_temp_tables()
cd5,Process Legal Units - Batch 9,,1015950519091360496,1,12.219875,1000,16256,0,0,0,0,6207,650960,"WITH plan_with_row_ids AS (                                     SELECT p.plan_op_seq, p.entity_keys, unnest(p.row_ids) AS source_row_id                                     FROM temporal_merge_plan p                                     WHERE p.operation = 'INSERT' AND p.entity_keys IS NOT NULL                                 ),                                 map_row_to_entity AS (                                     SELECT DISTINCT ON (pr.source_row_id)                                         pr.source_row_id,                                         pr.entity_keys                                     FROM plan_with_row_ids pr                                     ORDER BY pr.source_row_id, pr.plan_op_seq                                 )                                 UPDATE source_view_lu s                                 SET id = (p.entity_keys->>'id')::integer                                 FROM map_row_to_entity p                                 WHERE s.row_id = p.source_row_id"
e21,Process Legal Units - Batch 9,,725758841111022991,154,6.980126,154,4136,0,0,0,0,0,0,"EXISTS (         SELECT 1 FROM pg_event_trigger_ddl_commands() ddl         JOIN pg_class c ON c.oid = ddl.objid         JOIN pg_namespace n ON n.oid = c.relnamespace         WHERE EXISTS (SELECT 1 FROM sql_saga.era e WHERE (e.table_schema, e.table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.updatable_view v JOIN pg_class vc ON vc.relname = v.view_name JOIN pg_namespace vn ON vn.oid = vc.relnamespace AND vn.nspname = v.view_schema WHERE vc.oid = c.oid)            -- Also check system_versioning objects (history table, view)            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.history_schema_name, sv.history_table_name) = (n.nspname, c.relname))            OR EXISTS (SELECT 1 FROM sql_saga.system_versioning sv WHERE (sv.view_schema_name, sv.view_table_name) = (n.nspname, c.relname))     )"
278,Process Legal Units - Batch 9,,4895990506256861755,1000,1.80861899999999,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                    FROM unnest(from_sources) AS v
156,Process Legal Units - Batch 9,,7743831913079285872,1000,1.4127799999999968,1000,0,0,0,0,0,0,0,SELECT array_agg(DISTINCT v)                     FROM unnest(until_sources) AS v
f6f,Process Legal Units - Batch 9,,1464568031695687146,154,0.5235389999999999,154,63,0,0,0,0,0,0,SELECT array_agg(command_tag)           FROM pg_event_trigger_ddl_commands()
bb3,Process Legal Units - Batch 9,,-8708312726399770535,160,0.49295299999999936,160,0,0,0,0,0,0,0,"EXISTS (             SELECT 1 FROM pg_event_trigger_dropped_objects() dobj             WHERE dobj.object_type = 'table'               AND (dobj.schema_name, dobj.object_name) = (r.table_schema, r.table_name)         )"
602,Process Legal Units - Batch 9,,-1465262961312880621,160,0.26357099999999967,160,480,0,0,0,0,0,0,"NOT EXISTS (                 SELECT FROM pg_catalog.pg_constraint AS c                 WHERE (c.conrelid, c.conname) = (r.table_oid, r.unique_constraint)             )"
523,Process Legal Units - Batch 9,,8008625629997484951,154,0.24066499999999985,0,0,0,0,0,0,0,0,SELECT * FROM pg_event_trigger_ddl_commands()
f25,Process Legal Units - Batch 9,,-8889318315713072803,160,0.03475200000000002,160,0,0,0,0,0,0,0,"r.exclude_constraint IS NOT NULL AND NOT EXISTS (             SELECT FROM pg_catalog.pg_constraint AS c             WHERE (c.conrelid, c.conname) = (r.table_oid, r.exclude_constraint)         )"
