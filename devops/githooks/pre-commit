#!/bin/sh
#
# This pre-commit hook prevents committing any files from scratch directories
# (e.g., 'tmp/', 'app/tmp/'). This allows these directories to be used as a
# scratch space for AI tools without polluting the main commit history.
#
# Files in them can still be tracked locally with `git add` to see diffs.
# An exception is made for `.gitkeep` and `.gitignore` files, which are allowed.

# Add your project's scratch directories to this regex.
# Example: '^(tmp|app/tmp)/'
SCRATCH_DIRECTORIES_REGEX='^(tmp)/'

STAGED_TMP_FILES=$(git diff --cached --name-only | grep -E "$SCRATCH_DIRECTORIES_REGEX" | grep -v -E '/\.(gitkeep|gitignore)$')

if [ -n "$STAGED_TMP_FILES" ]; then
    echo "COMMIT REJECTED"
    echo "-----------------"
    echo "Error: Committing files from scratch directories is not allowed."
    echo
    echo "These directories are for local scratch work and AI tool interaction."
    echo "To commit changes from files in these directories, please move them to an appropriate location."
    echo
    echo "The following staged files must be unstaged:"
    echo "$STAGED_TMP_FILES"
    echo
    exit 1
fi

exit 0
